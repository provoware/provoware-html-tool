<!doctype html>
<html lang="de" data-theme="high-contrast">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Provoware ModulTool Dashboard</title>
  <style>
    :root {
      --bg-glow: #284b9a;
      --bg-start: #020717;
      --bg-end: #061229;
      --bg: #020717;
      --surface: rgba(7, 16, 36, 0.86);
      --surface-strong: rgba(4, 11, 27, 0.95);
      --text: #f3f6ff;
      --muted: #b9c5de;
      --focus: #f8d23f;
      --border: #7fa8ff;
      --shadow: rgba(0, 0, 0, 0.5);
      --accent-a: #ff7a52;
      --accent-b: #47c2ff;
      --primary: #47c2ff;
      --accent-c: #ffd061;
      color-scheme: dark;
    }
    html[data-theme="balanced"] {
      --bg-glow: #1d4287;
      --bg-start: #081022;
      --bg-end: #162746;
      --bg: #081022;
      --surface: rgba(11, 23, 46, 0.9);
      --surface-strong: rgba(8, 18, 36, 0.96);
      --text: #f3f7ff;
      --muted: #b8c6e6;
      --focus: #ffd95a;
      --border: #79a1f7;
      --shadow: rgba(0, 0, 0, 0.48);
      --accent-a: #ff845d;
      --accent-b: #4ec8ff;
      --primary: #4ec8ff;
      --accent-c: #ffd26d;
      color-scheme: dark;
    }
    html[data-theme="high-contrast"] {
      --bg-glow: #0037a8;
      --bg-start: #000000;
      --bg-end: #0c1224;
      --bg: #000000;
      --surface: rgba(0, 0, 0, 0.96);
      --surface-strong: rgba(8, 8, 8, 0.99);
      --text: #ffffff;
      --muted: #dbe8ff;
      --focus: #ffe600;
      --border: #8bc2ff;
      --shadow: rgba(0, 0, 0, 0.7);
      --accent-a: #ff9966;
      --accent-b: #6de1ff;
      --primary: #6de1ff;
      --accent-c: #ffe47a;
      color-scheme: dark;
    }
    html[data-theme="light"] {
      --bg-start: #eaf0ff;
      --bg-end: #f7f8fb;
      --bg: #f7f8fb;
      --surface: rgba(255, 255, 255, 0.95);
      --surface-strong: rgba(247, 249, 255, 0.98);
      --text: #09152d;
      --muted: #324367;
      --focus: #1f4aff;
      --border: #314d93;
      --shadow: rgba(16, 32, 74, 0.18);
      --accent-a: #d14a22;
      --accent-b: #006cc5;
      --primary: #006cc5;
      --accent-c: #a57300;
      color-scheme: light;
    }
    html[data-theme="dark"] {
      --bg-start: #030813;
      --bg-end: #101f3a;
      --bg: #030813;
      --surface: rgba(12, 24, 47, 0.86);
      --surface-strong: rgba(7, 18, 35, 0.95);
      --text: #ecf4ff;
      --muted: #a8b8d8;
      --focus: #ffd64d;
      --border: #6f94ff;
      --shadow: rgba(0, 0, 0, 0.56);
      --accent-a: #ee6a3f;
      --accent-b: #2ec7ff;
      --primary: #2ec7ff;
      --accent-c: #f2b632;
      color-scheme: dark;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Inter", "Segoe UI", Arial, sans-serif;
      color: var(--text);
      background: radial-gradient(circle at top, var(--bg-glow) 0%, transparent 38%), linear-gradient(130deg, var(--bg-start), var(--bg-end));
    }
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation: none !important;
        transition: none !important;
        scroll-behavior: auto !important;
      }
    }
    .skip-link {
      position: absolute;
      left: -999px;
      top: 0;
      padding: .65rem .9rem;
      border: 2px solid var(--focus);
      background: var(--surface-strong);
      color: var(--text);
      border-radius: 0 0 10px 10px;
      z-index: 30;
    }
    .skip-link:focus {
      left: .7rem;
      top: .5rem;
    }
    .shell {
      width: min(1440px, calc(100% - 1.5rem));
      margin: .9rem auto;
      border-radius: 14px;
      border: 1px solid rgba(127, 168, 255, 0.35);
      background: linear-gradient(180deg, rgba(7, 17, 37, 0.92), rgba(5, 13, 31, 0.95));
      box-shadow: 0 18px 48px var(--shadow);
      overflow: hidden;
      display: grid;
      grid-template-columns: 280px minmax(0, 1fr) 320px;
      grid-template-rows: 64px minmax(0, 1fr) 52px;
      grid-template-areas:
        "top top top"
        "left main right"
        "foot foot foot";
    }
    .topbar {
      grid-area: top;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 1.1rem;
      background: linear-gradient(90deg, rgba(8, 24, 53, 0.9), rgba(8, 14, 30, 0.95));
      border-bottom: 1px solid rgba(127, 168, 255, 0.32);
      gap: .6rem;
      flex-wrap: wrap;
    }
    .topbar-log {
      min-width: 280px;
      flex: 1;
      border: 1px solid rgba(127, 168, 255, 0.35);
      border-radius: 10px;
      padding: .45rem .6rem;
      background: rgba(4, 10, 23, 0.7);
    }
    .topbar-log ol {
      margin: .35rem 0 0;
      padding-left: 1.1rem;
      max-height: 72px;
      overflow: auto;
      color: var(--muted);
    }
    .topbar-controls {
      display: grid;
      grid-template-columns: repeat(2, minmax(120px, 1fr));
      gap: .35rem;
      min-width: 250px;
    }
    .status-pill {
      font-weight: 700;
      color: #a4ffc8;
      border: 1px solid rgba(131, 250, 173, 0.5);
      border-radius: 999px;
      padding: .2rem .7rem;
      background: rgba(8, 53, 25, 0.4);
    }
    .panel {
      padding: 1rem;
      background: var(--surface);
    }
    .left {
      grid-area: left;
      border-right: 1px solid rgba(127, 168, 255, 0.35);
      display: flex;
      flex-direction: column;
      gap: .9rem;
    }
    .right {
      grid-area: right;
      border-left: 1px solid rgba(127, 168, 255, 0.35);
      display: flex;
      flex-direction: column;
      gap: .9rem;
    }
    .main {
      grid-area: main;
      padding: 1rem;
      background: linear-gradient(180deg, rgba(9, 18, 39, 0.78), rgba(6, 14, 31, 0.88));
      display: grid;
      gap: .9rem;
      align-content: start;
    }
    .headline {
      text-align: center;
      font-size: 1.85rem;
      margin: 0;
    }
    .subline {
      margin: 0;
      text-align: center;
      color: var(--muted);
    }
    .nav-list,
    .settings-list {
      list-style: none;
      margin: 0;
      padding: 0;
      display: grid;
      gap: .4rem;
    }
    .nav-item,
    .settings-item,
    .quick-help {
      border-radius: 10px;
      border: 1px solid rgba(127, 168, 255, 0.24);
      background: var(--surface-strong);
      padding: .62rem .72rem;
    }
    .nav-group-title {
      margin-top: .5rem;
      font-size: .95rem;
      color: var(--muted);
    }
    .nav-button {
      min-height: 44px;
      border-radius: 8px;
      border: 1px solid rgba(127, 168, 255, 0.42);
      background: rgba(10, 20, 43, 0.76);
      color: inherit;
      text-align: left;
      padding: .45rem .6rem;
      width: 100%;
      font-size: .97rem;
    }
    .nav-button[aria-current="page"] {
      border-color: var(--focus);
      box-shadow: inset 0 0 0 1px var(--focus);
      font-weight: 700;
    }
    .card-grid {
      display: grid;
      gap: .85rem;
      grid-template-columns: repeat(3, minmax(210px, 1fr));
    }
    .module-stage {
      border: 2px solid rgba(127, 168, 255, 0.45);
      border-radius: 12px;
      padding: .75rem;
      background: rgba(6, 14, 31, 0.9);
      min-height: 240px;
    }
    .module-empty {
      min-height: 196px;
      display: grid;
      place-items: center;
      border: 2px dashed rgba(127, 168, 255, 0.45);
      border-radius: 10px;
      color: var(--muted);
      text-align: center;
      padding: .75rem;
    }
    .module-panel { display: none; }
    .module-panel.active { display: block; }
    .main-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(120px, 1fr));
      gap: .6rem;
      margin-bottom: .6rem;
    }
    .main-grid-cell {
      min-height: 88px;
      border: 2px dashed rgba(127, 168, 255, 0.5);
      border-radius: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
      color: var(--muted);
      background: rgba(10, 18, 34, 0.45);
    }
    .window-actions {
      display: grid;
      grid-template-columns: repeat(3, minmax(130px, 1fr));
      gap: .4rem;
      margin-bottom: .6rem;
    }
    .control-bar {
      display: grid;
      grid-template-columns: minmax(220px, 1fr) minmax(180px, 1fr) 220px;
      gap: .5rem;
      align-items: end;
      padding: .65rem;
      border: 1px solid rgba(127, 168, 255, 0.4);
      border-radius: 10px;
      background: rgba(9, 20, 41, 0.8);
      margin-bottom: .6rem;
    }
    .control-bar label { display: grid; gap: .25rem; font-weight: 700; }
    .breadcrumb { display: inline-flex; align-items: center; gap: .35rem; color: var(--muted); font-size: .9rem; margin-bottom: .2rem; }
    .inspector-grid { display: grid; gap: .5rem; margin-top: .55rem; }
    .quick-overlay { border: 2px solid var(--focus); border-radius: 12px; width: min(640px, calc(100% - 1.5rem)); }
    .shortcut-list { list-style: none; padding: 0; margin: .55rem 0 0; display: grid; gap: .35rem; max-height: 270px; overflow: auto; }
    .shortcut-list li { border: 1px solid rgba(127, 168, 255, 0.35); border-radius: 8px; padding: .45rem .55rem; background: rgba(9, 20, 41, 0.72); }
    .tool-card {
      border-radius: 12px;
      border: 2px solid rgba(127, 168, 255, 0.4);
      padding: .8rem;
      background: linear-gradient(160deg, rgba(20, 33, 63, 0.94), rgba(10, 19, 36, 0.94));
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.32);
    }
    .tool-card-primary {
      border-width: 3px;
      box-shadow: 0 12px 20px rgba(0, 0, 0, 0.38);
    }
    .tool-card-secondary {
      border-style: solid;
    }
    .tool-card-utility {
      border-style: dashed;
    }
    .card-tag {
      display: inline-block;
      margin-bottom: .35rem;
      padding: .1rem .45rem;
      border-radius: 999px;
      border: 1px solid rgba(127, 168, 255, 0.55);
      color: var(--muted);
      font-size: .82rem;
    }
    .card-state {
      display: inline-flex;
      align-items: center;
      gap: .35rem;
      margin-top: .4rem;
      padding: .1rem .5rem;
      border-radius: 999px;
      border: 1px solid rgba(127, 168, 255, 0.55);
      font-size: .85rem;
      color: var(--muted);
      background: rgba(10, 21, 44, 0.72);
    }
    .card-state[data-state="ready"] { border-color: #8bf2ac; color: #8bf2ac; }
    .card-state[data-state="loading"] { border-color: #ffd26d; color: #ffd26d; }
    .card-state[data-state="error"] { border-color: #ffb487; color: #ffb487; }
    .plugin-status-list {
      margin: .4rem 0 0;
      padding: 0;
      list-style: none;
      display: grid;
      gap: .35rem;
    }
    .plugin-status-item {
      display: flex;
      justify-content: space-between;
      gap: .5rem;
      align-items: center;
      border: 1px solid rgba(127, 168, 255, 0.3);
      border-radius: 8px;
      padding: .4rem .55rem;
      background: rgba(10, 21, 44, 0.72);
    }
    .plugin-pill {
      border-radius: 999px;
      border: 1px solid rgba(127, 168, 255, 0.4);
      font-size: .8rem;
      padding: .1rem .45rem;
    }
    .plugin-pill-online {
      border-color: #8bf2ac;
      color: #8bf2ac;
    }
    .plugin-pill-offline {
      border-color: #ffb487;
      color: #ffb487;
    }
    .module-option-list {
      margin: .45rem 0 0;
      padding-left: 1.1rem;
      color: var(--muted);
      display: grid;
      gap: .3rem;
    }
    .drag-list {
      list-style: none;
      margin: .4rem 0;
      padding: 0;
      display: grid;
      gap: .35rem;
    }
    .drag-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: .5rem;
      border: 1px solid rgba(127, 168, 255, 0.35);
      border-radius: 8px;
      padding: .35rem .55rem;
      background: rgba(10, 21, 44, 0.72);
      cursor: move;
    }
    .drag-item[aria-selected="true"] {
      border-color: var(--focus);
      box-shadow: inset 0 0 0 1px var(--focus);
    }
    .drag-item button {
      min-height: 36px;
      width: auto;
      padding: .2rem .45rem;
    }
    .tool-card[data-accent="a"] { border-color: var(--accent-a); }
    .tool-card[data-accent="b"] { border-color: var(--accent-b); }
    .tool-card[data-accent="c"] { border-color: var(--accent-c); }
    h1, h2, h3, p { margin: 0; }
    h2 { font-size: 1.15rem; margin-bottom: .6rem; }
    h3 { font-size: 1.45rem; }
    .debug-log-list,
    #debug-log-list {
      margin: .6rem 0 0;
      padding-left: 1.1rem;
      color: var(--muted);
      min-height: 3.2rem;
    }
    .actions {
      display: grid;
      gap: .5rem;
      margin-top: .7rem;
    }
    button,
    select,
    input {
      min-height: 44px;
      border-radius: 8px;
      border: 2px solid rgba(127, 168, 255, 0.55);
      background: rgba(10, 22, 44, 0.86);
      color: inherit;
      font-size: 1rem;
      padding: .5rem .7rem;
      width: 100%;
    }
    button:hover,
    select:hover,
    input:hover { border-color: var(--focus); }
    button:focus-visible,
    select:focus-visible,
    input:focus-visible,
    a:focus-visible {
      outline: 3px solid var(--focus);
      outline-offset: 3px;
    }
    .result {
      margin-top: .4rem;
      color: var(--muted);
      min-height: 1.4rem;
    }
      .footer {
      grid-area: foot;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 .9rem;
      border-top: 1px solid rgba(127, 168, 255, 0.32);
      background: rgba(4, 10, 23, 0.95);
      color: var(--muted);
    }
    dialog {
      border: 3px solid var(--accent-a);
      border-radius: 12px;
      width: min(560px, calc(100% - 2rem));
      background: var(--surface-strong);
      color: var(--text);
    }
    dialog::backdrop { background: rgba(0, 0, 0, 0.7); }
    @media (max-width: 1240px) {
      .shell {
        grid-template-columns: 250px minmax(0, 1fr);
        grid-template-areas:
          "top top"
          "left main"
          "right right"
          "foot foot";
        grid-template-rows: 64px auto auto 52px;
      }
      .card-grid { grid-template-columns: repeat(2, minmax(220px, 1fr)); }
      .main-grid { grid-template-columns: repeat(3, minmax(100px, 1fr)); }
    }
    @media (max-width: 860px) {
      .shell {
        grid-template-columns: 1fr;
        grid-template-areas: "top" "left" "main" "right" "foot";
        grid-template-rows: auto;
      }
      .card-grid { grid-template-columns: 1fr; }
      .main-grid,
      .window-actions,
      .control-bar,
      .topbar-controls {
        grid-template-columns: 1fr;
      }
    }
    @media (max-width: 420px) {
      body {
        font-size: 0.96rem;
      }
      .shell {
        width: calc(100% - .7rem);
        margin: .35rem auto;
        border-radius: 10px;
      }
      .topbar,
      .panel,
      .main,
      .footer {
        padding-left: .7rem;
        padding-right: .7rem;
      }
      .topbar {
        gap: .45rem;
        flex-wrap: wrap;
        justify-content: center;
      }
      .headline {
        width: 100%;
        font-size: 1.45rem;
      }
      .status-pill {
        width: 100%;
        text-align: center;
      }
      .tool-card,
      .settings-item,
      .quick-help {
        padding: .7rem;
      }
      h2 {
        font-size: 1.04rem;
      }
      button,
      select,
      .nav-button {
        min-height: 46px;
        font-size: .96rem;
      }
      .footer {
        flex-direction: column;
        align-items: flex-start;
        gap: .2rem;
        min-height: 80px;
        padding-top: .45rem;
        padding-bottom: .45rem;
      }
    }
  </style>
</head>
<body>
  <a href="#bereich-aufgaben" class="skip-link">Direkt zum Arbeitsbereich springen</a>
  <main class="shell" role="main" aria-live="polite">
    <header class="topbar" aria-label="Obere Statusleiste">
      <span>üß© ModulTool</span>
      <h1 class="headline">ModulTool</h1>
      <span class="status-pill" id="sync-status" role="status" aria-live="polite">‚úÖ Alle √Ñnderungen gespeichert</span>
      <section class="topbar-log" aria-label="Echtzeit-Protokollkopf">
        <strong>Live-Protokoll (letzte 10 Ereignisse)</strong>
        <ol id="topbar-log-list"></ol>
      </section>
      <div class="topbar-controls">
        <button type="button" data-action="copy-log">Gesamtes Protokoll kopieren</button>
        <button type="button" id="mode-switch" data-action="switch-mode" aria-pressed="false">Modus: Laie</button>
      </div>
    </header>
    <aside class="panel left" aria-label="Navigation">
      <h2>Navigation</h2>
      <p class="nav-group-title">Arbeitsmodule</p>
      <ul class="nav-list" aria-label="Arbeitsmodule">
        <li class="nav-item"><button type="button" class="nav-button" data-module-nav="gms-suite">üß© Genres-Archiv + Zufall + Liste</button></li>
        <li class="nav-item"><button type="button" class="nav-button" data-module-nav="debug-dev">üõ†Ô∏è Debugging & Entwickleroptionen</button></li>
      </ul>
      <p class="nav-group-title">Organisation</p>
      <ul class="nav-list" aria-label="Organisation und √úberblick">
        <li class="nav-item"><button type="button" class="nav-button" data-module-nav="todo">‚úÖ To-Do-Liste</button></li>
        <li class="nav-item"><button type="button" class="nav-button" data-module-nav="dashboard" aria-current="page">üìä Dashboard</button></li>
      </ul>
      <p class="quick-help" id="shortcut-help">Tastatur-K√ºrzel (Keyboard Shortcut = Schnellbefehl): Alt+S Speichern, Alt+R Erneut versuchen, Alt+P Reparatur, Alt+L Protokoll, Alt+O Modul √∂ffnen.</p>
      <section class="quick-help" aria-label="Pluginstatus">
        <strong>Pluginstatus (sichtbar):</strong>
        <ul class="plugin-status-list" id="plugin-status-list" aria-live="polite">
          <li class="plugin-status-item"><span>Genres-Archiv + Zufall + Liste</span><span class="plugin-pill plugin-pill-offline">Wartet</span></li>
          <li class="plugin-status-item"><span>Debugging & Entwickleroptionen</span><span class="plugin-pill plugin-pill-offline">Wartet</span></li>
        </ul>
      </section>
      <section class="quick-help" aria-labelledby="module-sidebar-options-title" id="module-sidebar-options">
        <strong id="module-sidebar-options-title">Moduloptionen (abh√§ngig vom Modul):</strong>
        <ul class="module-option-list" id="module-option-list">
          <li>Bitte Modul √∂ffnen, um Optionen zu sehen.</li>
        </ul>
        <p class="subline" id="module-option-help">Hilfe: Optionen zeigen immer Text + Symbol, nicht nur Farbe.</p>
      </section>
    </aside>
    <section class="main" aria-labelledby="bereich-aufgaben">
      <p class="subline">Genrearchiv ‚Äì alle √Ñnderungen gespeichert</p>
      <h2 id="bereich-aufgaben">Werkzeug-√úbersicht</h2>
      <section class="control-bar" aria-label="Steuerleiste">
        <label>
          <span class="breadcrumb" id="project-breadcrumb">Projektpfad: noch nicht gesetzt</span>
          Projekt-Kontext
          <input id="project-switch-input" type="text" value="" placeholder="/home/name/Projektordner" aria-describedby="project-switch-help">
        </label>
        <label for="global-search-input">Globale Suche
          <input id="global-search-input" type="search" placeholder="Modul, Aktion oder Hilfe suchen" aria-describedby="global-search-status">
        </label>
        <div class="actions" style="margin-top:0;">
          <button type="button" data-action="project-switch" aria-describedby="project-switch-help">Projekt wechseln</button>
          <p class="subline" id="project-switch-help">Hilfe: Pfad eintragen, dann ‚ÄûProjekt wechseln‚Äú dr√ºcken.</p>
        </div>
      </section>
      <p class="subline" id="global-search-status" role="status" aria-live="polite">Suche bereit: Bitte Begriff eingeben.</p>
      <p class="subline">Startansicht: Leeres 3x3-Haupt-Grid mit Fensteroptionen f√ºr Ausblenden und Maximieren.</p>
      <div class="window-actions" aria-label="Fensteroptionen">
        <button type="button" data-action="window-hide">Fenster ausblenden</button>
        <button type="button" data-action="window-maximize">Fenster maximieren</button>
        <button type="button" data-action="window-reset">Volle Sicht wiederherstellen</button>
        <button type="button" data-action="window-detach">Als Einzelfenster √∂ffnen</button>
        <button type="button" data-action="layout-save">Layout speichern</button>
        <button type="button" data-action="layout-restore">Gespeichertes Layout laden</button>
      </div>
      <section class="main-grid" aria-label="Leeres Haupt-Grid 3x3">
        <div class="main-grid-cell">Feld 1 (frei)</div>
        <div class="main-grid-cell">Feld 2 (frei)</div>
        <div class="main-grid-cell">Feld 3 (frei)</div>
        <div class="main-grid-cell">Feld 4 (frei)</div>
        <div class="main-grid-cell">Feld 5 (frei)</div>
        <div class="main-grid-cell">Feld 6 (frei)</div>
        <div class="main-grid-cell">Feld 7 (frei)</div>
        <div class="main-grid-cell">Feld 8 (frei)</div>
        <div class="main-grid-cell">Feld 9 (frei)</div>
      </section>
      <div class="card-grid" hidden aria-hidden="true"></div>
      <section class="module-stage card-grid" aria-label="Aktives Modul im Hauptbereich" id="module-stage">
        <div class="module-empty" id="module-stage-empty">Noch kein Modul aktiv. √ñffnen Sie links ein Modul. Das Modul wird dann dynamisch in dieses 3x3-Grid eingebettet.</div>
        <article class="tool-card tool-card-primary module-panel" data-accent="c" aria-labelledby="modul-starter-title">
          <p class="card-tag">Startmodul</p>
          <h2 id="modul-starter-title">Modul-Starter</h2>
          <p class="card-state" id="module-card-state" data-state="ready" role="status" aria-live="polite">Status: Bereit</p>
          <label for="module-switcher"><strong>Modul w√§hlen:</strong></label>
          <select id="module-switcher" aria-describedby="module-help shortcut-help">
            <option value="">Bitte Modul ausw√§hlen</option>
            <option value="gms-suite">Genres-Archiv + Zufall + Liste</option>
            <option value="debug-dev">Debugging & Entwickleroptionen</option>
          </select>
          <div class="actions">
            <button type="button" data-action="open-module" aria-keyshortcuts="Alt+O" aria-describedby="module-help shortcut-help">Modul √∂ffnen</button>
          </div>
          <p class="result" id="module-status" role="status" aria-live="polite">Noch kein Modul ge√∂ffnet.</p>
          <p class="subline" id="module-source-preview">Kurzdetails: Bitte Modul ausw√§hlen, um Datenquelle und n√§chsten Schritt zu sehen.</p>
        </article>
        <article class="tool-card tool-card-primary module-panel" data-accent="b" id="gms-suite-view" aria-labelledby="gms-title">
          <p class="card-tag">Plugin: Hauptmodul-Ansicht</p>
          <h2 id="gms-title">Genres-Archiv + Zufall + Liste</h2>
          <p class="subline">Genres, Stimmungen und Stile als Profil-Archiv. Hilfe: Mehrere Werte per Komma eingeben.</p>
          <label for="gms-category"><strong>Kategorie:</strong></label>
          <select id="gms-category" aria-label="Kategorie f√ºr Archiv-Eintrag">
            <option value="genres">Genres</option>
            <option value="moods">Stimmungen</option>
            <option value="styles">Stile</option>
          </select>
          <label for="gms-bulk-input"><strong>Sammel-Eingabe:</strong></label>
          <input id="gms-bulk-input" type="text" placeholder="z. B. Synthwave, LoFi, Melancholisch">
          <div class="actions">
            <button type="button" data-action="gms-add">Eintr√§ge speichern</button>
          </div>
          <p class="result" id="gms-feedback" role="status" aria-live="polite">Noch keine √Ñnderung.</p>
          <p class="subline" id="gms-profile-info">Aktives Profil: default.</p>
          <label for="gms-profile-select"><strong>Archivprofil:</strong></label>
          <select id="gms-profile-select" aria-label="Profil f√ºr Genres-Archiv">
            <option value="default">default</option>
            <option value="techno">techno</option>
            <option value="hoerspiele">h√∂rspiele</option>
          </select>
          <label for="gms-new-profile"><strong>Neues Profil:</strong></label>
          <input id="gms-new-profile" type="text" placeholder="z. B. Ambient" aria-describedby="gms-profile-help">
          <p id="gms-profile-help" class="subline">Profilname bitte kurz und eindeutig eingeben.</p>
          <div class="actions">
            <button type="button" data-action="gms-profile-switch">Profil laden</button>
            <button type="button" data-action="gms-profile-create">Profil erstellen</button>
          </div>
          <p class="result" id="gms-profile-result" role="status" aria-live="polite">Profile bereit.</p>
          <label for="gms-random-count"><strong>Zufallsanzahl:</strong></label>
          <select id="gms-random-count" aria-label="Anzahl f√ºr Zufallsgenerator">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
          </select>
          <div class="actions">
            <button type="button" data-action="gms-random">Zufall erzeugen</button>
            <button type="button" data-action="gms-copy-random">Ergebnis kopieren</button>
          </div>
          <p class="result" id="gms-random-result" role="status" aria-live="polite">Noch kein Zufallsergebnis.</p>
          <h3>Verlauf</h3>
          <ul id="gms-history" aria-label="Letzte Zufallsausgaben"></ul>
          <h3>Archiv-Eintr√§ge (Drag&Drop + CRUD)</h3>
          <ul id="gms-entry-list" class="drag-list" aria-label="Eintr√§ge im aktuellen Profil"></ul>
          <div class="actions">
            <button type="button" data-action="gms-entry-rename">Eintrag umbenennen</button>
            <button type="button" data-action="gms-entry-delete">Eintrag l√∂schen</button>
            <button type="button" data-action="gms-copy-history">Verlauf kopieren</button>
            <button type="button" data-action="gms-clear-history">Verlauf l√∂schen</button>
            <button type="button" data-action="gms-export">Export f√ºr Exportzentrum</button>
            <button type="button" data-action="gms-import-demo">Demo-Import (Merge)</button>
          </div>
          <p id="gms-export-help" class="subline">Hilfe: Export-Dateiname ist Linux-kompatibel und enth√§lt den Arbeitsstatus (z. B. release-ready oder in-abstimmung).</p>
          <p id="gms-export-filename-status" class="result" role="status" aria-live="polite">Dateiname: noch nicht erstellt.</p>
        </article>
<article class="tool-card tool-card-secondary module-panel" data-accent="a" id="debug-dev-view">
          <p class="card-tag">Status und Hilfe</p>
          <h2>Debugging & Entwickleroptionen</h2>
          <p class="card-state" id="debug-card-state" data-state="ready" role="status" aria-live="polite">Status: Bereit</p>
          <p class="result" id="result" role="status" aria-live="polite">Keine Fehler.</p>
          <p class="subline" id="debug-last-event" data-debug-event>Letztes Ereignis: Startzustand um --:--:--.</p>
          <p class="subline" id="debug-next-step" data-debug-next-step>N√§chster Schritt: Aktion w√§hlen oder Alt+L f√ºr Protokoll nutzen.</p>
          <ul id="debug-log-list" aria-label="Letzte Debug-Ereignisse"></ul>
          <div class="actions">
            <button type="button" data-action="error">Beispiel-Fehler anzeigen</button>
          </div>
        </article>
<article class="tool-card tool-card-primary module-panel" data-accent="a" id="project-routine-view" aria-labelledby="projekt-routine-title">
          <p class="card-tag">Start-Routine Projektordner</p>
          <h2 id="projekt-routine-title">Projekt-Routine</h2>
          <p class="card-state" id="project-card-state" data-state="loading" role="status" aria-live="polite">Status: L√§dt</p>
          <p id="project-path-status" class="result" role="status" aria-live="polite">Projektordner: wird beim Start gepr√ºft‚Ä¶</p>
          <p class="subline" id="project-path-help">Hilfe (Help = Unterst√ºtzung): Der Pfad wird in der Start-Routine gepr√ºft und bei Bedarf automatisch erstellt.</p>
          <div class="actions">
            <button type="button" data-action="project-setup">Projektordner anpassen</button>
          </div>
        </article>
      </section>
      <section class="tool-card" data-accent="a" aria-labelledby="bereich-hilfe" id="hilfe-next-steps">
        <h2 id="bereich-hilfe">Schnellhilfe mit Next Steps</h2>
        <div class="actions" aria-label="Schnellaktionen">
          <button type="button" data-action="save" aria-keyshortcuts="Alt+S" aria-describedby="shortcut-help">Zwischenstand speichern</button>
          <button type="button" data-action="retry" aria-keyshortcuts="Alt+R" aria-describedby="shortcut-help">Aktion erneut versuchen</button>
          <button type="button" data-action="log" aria-keyshortcuts="Alt+L" aria-describedby="shortcut-help">N√§chsten Protokoll-Schritt zeigen</button>
        </div>
        <ol>
          <li>Neu starten: <code>./start.sh</code></li>
          <li>Auto-Reparatur: <code>./start.sh --repair</code></li>
          <li><button type="button" data-action="repair" aria-keyshortcuts="Alt+P" aria-describedby="shortcut-help">Reparatur jetzt erkl√§ren</button></li>
          <li>Protokoll lesen: <code>cat logs/status_summary.txt</code></li>
        </ol>
        <p class="result">Fehlerdialog zeigt immer klare Schritte: ‚ÄûErneut versuchen‚Äú, ‚ÄûReparatur‚Äú, ‚ÄûProtokoll‚Äú.</p>
        <p class="subline">Sehr kleines Display: Nutzen Sie 200% Zoom, Hochformat und den Link ‚ÄûDirekt zum Arbeitsbereich springen‚Äú, damit Fokus (aktive Tastatur-Markierung) und Texte klar bleiben.</p>
      </section>
    </section>
    <aside class="panel right" aria-label="Einstellungen und Hilfe">
      <h2>Einstellungen</h2>
      <section class="quick-help" aria-labelledby="inspector-title">
        <strong id="inspector-title">Kontext-Inspector (Details + Hilfe):</strong>
        <div class="inspector-grid">
          <p id="inspector-details">Details: Dashboard ist aktiv. Status: Bereit.</p>
          <p id="inspector-help">Hilfe: √ñffnen Sie ‚ÄûShortcut-√úbersicht‚Äú, wenn Sie nur per Tastatur arbeiten.</p>
          <p id="inspector-meta">Meta: Quelle config/module_sources.json, letzter Wechsel: Start.</p>
          <p id="inspector-shortcuts">Shortcuts: Alt+S Speichern, Alt+O Modul √∂ffnen, F1 oder ? f√ºr Overlay.</p>
        </div>
      </section>
      <ul class="settings-list">
        <li class="settings-item">
          <label for="theme-switcher"><strong>Design:</strong></label>
          <select id="theme-switcher" data-theme-switcher aria-describedby="theme-help">
            <option value="balanced">Balanced (ausgeglichen)</option>
            <option value="high-contrast">High Contrast (hoher Kontrast)</option>
            <option value="light">Light (hell)</option>
            <option value="dark">Dark (dunkel)</option>
          </select>
        </li>
        <li class="settings-item">
          <p id="theme-help">Hinweis: Status nie nur √ºber Farbe, sondern immer mit Symbol + Text. Kontrast (Helligkeits-Unterschied) bleibt in allen drei Themes gut lesbar. Daten sparen: Wenn Ihr Ger√§t reduzierte Bewegung nutzt, werden Animationen automatisch deaktiviert.</p>
          <p class="subline" id="theme-contrast-preview">Kontrast-Vorschau: balanced ‚âà 10:1, high-contrast ‚âà 17:1, light ‚âà 11:1, dark ‚âà 12:1.</p>
          <p class="subline" id="theme-status" role="status" aria-live="polite">Aktives Theme: high-contrast. Empfohlen f√ºr maximalen Kontrast.</p>
        </li>
        <li class="settings-item" id="module-help">Modulhilfe: W√§hlen Sie links ein Modul und √∂ffnen Sie es mit Alt+O. Bei Fehlern folgen Sie den Next Steps im Debug-Log.</li>
        <li class="settings-item">
          <label for="font-scale-switcher"><strong>Textgr√∂√üe:</strong></label>
          <select id="font-scale-switcher" aria-describedby="font-scale-help">
            <option value="s">S (kompakt)</option>
            <option value="m">M (standard)</option>
            <option value="l">L (gr√∂√üer)</option>
            <option value="xl">XL (sehr gro√ü)</option>
          </select>
          <p id="font-scale-help">Hilfe: Gr√∂√üere Textgr√∂√üe verbessert Lesbarkeit. Die Auswahl wird lokal gespeichert.</p>
          <p class="subline" id="font-scale-status" role="status" aria-live="polite">Textgr√∂√üe: M (standard).</p>
        </li>
        <li class="settings-item">
          <label for="backup-switcher"><strong>Auto-Backup:</strong></label>
          <input id="backup-switcher" type="checkbox" aria-describedby="backup-help backup-status" checked>
          <p id="backup-help">Hilfe: Auto-Backup sichert √Ñnderungen im Hintergrund. Empfehlung: Aktiv lassen. Wenn aus, bitte manuell speichern.</p>
          <p class="subline" id="backup-status" role="status" aria-live="polite">Auto-Backup: Aktiv (Standard).</p>
        </li>
        <li class="settings-item">Nutzerstatistik: 0 aktive Fehler, letzte Pr√ºfung erfolgreich.</li>
        <li class="settings-item">
          <button type="button" data-action="open-shortcuts">Shortcut-√úbersicht √∂ffnen (F1 oder ?)</button>
          <p class="subline">Hilfe: Die √úbersicht zeigt alle K√ºrzel und kann nach Stichwort gefiltert werden.</p>
        </li>
      </ul>
    </aside>
    <footer class="footer">
      <span id="footer-version-path">Version: wird geladen‚Ä¶ | Projektpfad: wird gepr√ºft‚Ä¶</span>
      <span id="footer-backup-status">Auto-Backup: Aktiv (Standard)</span>
      <span id="footer-sync-status">Alle √Ñnderungen gespeichert</span>
    </footer>
  </main>
  <dialog id="error-dialog" aria-labelledby="error-title" aria-describedby="error-text" aria-modal="true">
    <h2 id="error-title">‚ùå Fehler erkannt</h2>
    <p id="error-text">Die Aktion konnte nicht abgeschlossen werden. Bitte folgen Sie den n√§chsten Schritten.</p>
    <ul>
      <li>Erneut versuchen</li>
      <li>Reparatur ausf√ºhren mit <code>./start.sh --repair</code></li>
      <li>Protokoll √∂ffnen mit <code>cat logs/start.log</code></li>
    </ul>
    <div class="actions">
      <button type="button" data-action="retry">Erneut versuchen</button>
      <button type="button" data-action="repair">Reparatur</button>
      <button type="button" data-action="log">Protokoll √∂ffnen</button>
      <button type="button" data-action="close-dialog">Dialog schlie√üen</button>
    </div>
  </dialog>
  <dialog id="shortcut-overlay" class="quick-overlay" aria-labelledby="shortcut-overlay-title" aria-describedby="shortcut-overlay-help" aria-modal="true">
    <h2 id="shortcut-overlay-title">‚å®Ô∏è Shortcut-√úbersicht</h2>
    <p id="shortcut-overlay-help">Fachwort: Overlay (√ºberlagerndes Fenster). Tipp: Suchbegriff eingeben, um passende Befehle schneller zu finden.</p>
    <label for="shortcut-filter"><strong>Suche in K√ºrzeln:</strong></label>
    <input id="shortcut-filter" type="search" placeholder="z. B. speichern, reparatur, modul" autocomplete="off">
    <p id="shortcut-filter-status" class="result" role="status" aria-live="polite">6 Eintr√§ge sichtbar.</p>
    <ul id="shortcut-list" class="shortcut-list"></ul>
    <div class="actions">
      <button type="button" data-action="close-shortcuts">Schlie√üen</button>
    </div>
  </dialog>
  <dialog id="project-dialog" aria-labelledby="project-title" aria-describedby="project-text" aria-modal="true">
    <h2 id="project-title">üìÅ Projekt-Routine</h2>
    <p id="project-text">Bitte Projektordner eingeben und best√§tigen. Es gibt keinen Standardordner mehr. Die Start-Routine pr√ºft den Ordner beim n√§chsten Start und erstellt ihn bei Bedarf automatisch.</p>
    <label for="project-path-input"><strong>Projektordner (absoluter Pfad):</strong></label>
    <input id="project-path-input" type="text" autocomplete="off" spellcheck="false" aria-describedby="project-hint">
    <p class="subline" id="project-hint">Beispiel: /home/name/Provoware-Projekte/MeinProjekt</p>
    <p class="result" id="project-dialog-result" role="status" aria-live="polite">Bitte Pfad pr√ºfen und speichern.</p>
    <div class="actions">
      <button type="button" data-action="project-save">Pfad speichern</button>
      <button type="button" data-action="project-close">Sp√§ter</button>
    </div>
  </dialog>
  <script>
    (function () {
      const html = document.documentElement;
      const resultNode = document.getElementById('result');
      const dialog = document.getElementById('error-dialog');
      const themeSelector = document.getElementById('theme-switcher');
      const syncStatusNode = document.getElementById('sync-status');
      const footerSyncStatusNode = document.getElementById('footer-sync-status');
      const footerVersionPathNode = document.getElementById('footer-version-path');
      const footerBackupStatusNode = document.getElementById('footer-backup-status');
      const debugEventNode = document.getElementById('debug-last-event');
      const debugNextStepNode = document.getElementById('debug-next-step');
      const themeStatusNode = document.getElementById('theme-status');
      const fontScaleSelector = document.getElementById('font-scale-switcher');
      const fontScaleStatusNode = document.getElementById('font-scale-status');
      const backupToggleNode = document.getElementById('backup-switcher');
      const backupStatusNode = document.getElementById('backup-status');
      const moduleCardStateNode = document.getElementById('module-card-state');
      const debugCardStateNode = document.getElementById('debug-card-state');
      const projectCardStateNode = document.getElementById('project-card-state');
      const moduleSelector = document.getElementById('module-switcher');
      const moduleStatusNode = document.getElementById('module-status');
      const gmsExportFilenameStatusNode = document.getElementById('gms-export-filename-status');
      const projectStatusNode = document.getElementById('project-path-status');
      const projectDialog = document.getElementById('project-dialog');
      const shortcutOverlay = document.getElementById('shortcut-overlay');
      const shortcutFilterInput = document.getElementById('shortcut-filter');
      const shortcutFilterStatusNode = document.getElementById('shortcut-filter-status');
      const shortcutListNode = document.getElementById('shortcut-list');
      const projectPathInput = document.getElementById('project-path-input');
      const projectSwitchInput = document.getElementById('project-switch-input');
      const projectBreadcrumbNode = document.getElementById('project-breadcrumb');
      const globalSearchInput = document.getElementById('global-search-input');
      const globalSearchStatusNode = document.getElementById('global-search-status');
      const inspectorDetailsNode = document.getElementById('inspector-details');
      const inspectorHelpNode = document.getElementById('inspector-help');
      const inspectorMetaNode = document.getElementById('inspector-meta');
      const projectDialogResultNode = document.getElementById('project-dialog-result');
      const debugLogListNode = document.getElementById('debug-log-list');
      const topbarLogListNode = document.getElementById('topbar-log-list');
      const modeSwitchNode = document.getElementById('mode-switch');
      const shellNode = document.querySelector('.shell');
      const pluginStatusListNode = document.getElementById('plugin-status-list');
      const moduleOptionListNode = document.getElementById('module-option-list');
      const navButtonNodes = Array.from(document.querySelectorAll('[data-module-nav]'));
      const moduleStageNode = document.getElementById('module-stage');
      const moduleStageEmptyNode = document.getElementById('module-stage-empty');
      const modulePanelNodes = Array.from(document.querySelectorAll('.module-panel'));
      const LAYOUT_STORAGE_KEY = 'provoware-layout-profile';
      const FONT_SCALE_STORAGE_KEY = 'provoware-font-scale';
      const BACKUP_STORAGE_KEY = 'provoware-backup-enabled';
      const APP_VERSION = '13.2';
      const shortcutEntries = [{ key: 'Alt+S', title: 'Speichern', detail: 'Speichert √Ñnderungen im aktiven Modul.' }, { key: 'Alt+R', title: 'Erneut versuchen', detail: 'Startet die letzte Aktion neu.' }, { key: 'Alt+P', title: 'Reparatur', detail: '√ñffnet die Reparatur-Hilfe mit Befehlen.' }, { key: 'Alt+L', title: 'Protokoll', detail: 'Zeigt den n√§chsten Log-Schritt.' }, { key: 'Alt+O', title: 'Modul √∂ffnen', detail: '√ñffnet das gew√§hlte Modul.' }, { key: 'F1 / ?', title: 'Shortcut-√úbersicht', detail: '√ñffnet das Overlay mit Filter.' }];
      let lastDialogTrigger = null;
      const serverProjectPath = '__PROJECT_PATH__';
      const injectedModuleSources = typeof __MODULE_SOURCES__ !== 'undefined' ? __MODULE_SOURCES__ : null;
      const serverModuleSources = normalizeModuleSources(injectedModuleSources);
      const detachedWindows = {};
      let isProMode = false;
      let activeModuleKey = '';
      const gmsPlugin = (function createGmsArchivPlugin() {
        const MODULE_ID = 'gms-archiv';
        const HISTORY_LIMIT = 8;
        const state = {
          currentProfile: 'default',
          profiles: {
            default: { genres: ['Synthwave', 'Lo-Fi'], moods: ['Ruhig'], styles: ['Cinematic'], history: [] },
            techno: { genres: ['Techno'], moods: ['Energie'], styles: ['Peak-Time'], history: [] },
            hoerspiele: { genres: ['H√∂rspiel'], moods: ['Spannung'], styles: ['Erz√§hlerisch'], history: [] }
          },
          mounted: false,
          lastRandomResult: '',
          selectedEntryIndex: -1
        };
        function getProfileData() {
          if (!state.profiles[state.currentProfile]) {
            state.profiles[state.currentProfile] = { genres: [], moods: [], styles: [], history: [] };
          }
          return state.profiles[state.currentProfile];
        }
        function normalizeEntries(value) {
          if (typeof value !== 'string') {
            return [];
          }
          return value.split(',').map(function (item) { return item.trim(); }).filter(Boolean);
        }
        function addUniqueByCategory(category, entries) {
          const profileData = getProfileData();
          if (!['genres', 'moods', 'styles'].includes(category) || !Array.isArray(entries)) {
            return { added: 0, duplicates: 0 };
          }
          const known = new Set(profileData[category].map(function (item) { return item.toLowerCase(); }));
          let added = 0;
          let duplicates = 0;
          entries.forEach(function (entry) {
            const low = entry.toLowerCase();
            if (known.has(low)) {
              duplicates += 1;
              return;
            }
            known.add(low);
            profileData[category].push(entry);
            added += 1;
          });
          return { added: added, duplicates: duplicates };
        }
        function addHistoryItem(text) {
          const profileData = getProfileData();
          if (typeof text !== 'string' || text.trim().length === 0) {
            return false;
          }
          profileData.history.unshift(text.trim());
          if (profileData.history.length > HISTORY_LIMIT) {
            profileData.history.length = HISTORY_LIMIT;
          }
          return true;
        }
        function chooseRandom(items, count) {
          if (!Array.isArray(items) || items.length === 0) {
            return [];
          }
          const safeCount = Math.max(1, Math.min(count, items.length));
          const copy = items.slice();
          const selected = [];
          while (selected.length < safeCount && copy.length > 0) {
            const index = Math.floor(Math.random() * copy.length);
            selected.push(copy.splice(index, 1)[0]);
          }
          return selected;
        }
        function safeNode(id) { return document.getElementById(id); }
        function renderHistory() {
          const listNode = safeNode('gms-history');
          if (!listNode) {
            return false;
          }
          const profileData = getProfileData();
          listNode.innerHTML = '';
          if (!profileData.history.length) {
            const li = document.createElement('li');
            li.textContent = 'Noch kein Verlauf.';
            listNode.appendChild(li);
            return true;
          }
          profileData.history.forEach(function (entry, index) {
            const li = document.createElement('li');
            li.textContent = String(index + 1) + '. ' + entry;
            listNode.appendChild(li);
          });
          return true;
        }
        function renderProfileInfo() {
          const info = safeNode('gms-profile-info');
          if (!info) {
            return false;
          }
          info.textContent = 'Aktives Profil: ' + state.currentProfile + '.';
          return true;
        }
        function renderProfileSelect() {
          const selectNode = safeNode('gms-profile-select');
          if (!selectNode) {
            return false;
          }
          const keys = Object.keys(state.profiles);
          selectNode.innerHTML = '';
          keys.forEach(function (key) {
            const option = document.createElement('option');
            option.value = key;
            option.textContent = key;
            if (key === state.currentProfile) {
              option.selected = true;
            }
            selectNode.appendChild(option);
          });
          return true;
        }
        function renderEntryList() {
          const listNode = safeNode('gms-entry-list');
          const categoryNode = safeNode('gms-category');
          if (!listNode || !categoryNode) {
            return false;
          }
          const category = categoryNode.value;
          const data = getProfileData();
          const items = Array.isArray(data[category]) ? data[category] : [];
          listNode.innerHTML = '';
          if (!items.length) {
            const li = document.createElement('li');
            li.textContent = 'Noch keine Eintr√§ge in dieser Kategorie.';
            listNode.appendChild(li);
            state.selectedEntryIndex = -1;
            return true;
          }
          items.forEach(function (item, index) {
            const li = document.createElement('li');
            li.className = 'drag-item';
            li.setAttribute('draggable', 'true');
            li.setAttribute('data-entry-index', String(index));
            li.setAttribute('aria-selected', state.selectedEntryIndex === index ? 'true' : 'false');
            const label = document.createElement('span');
            label.textContent = item;
            const pick = document.createElement('button');
            pick.type = 'button';
            pick.textContent = 'Ausw√§hlen';
            pick.setAttribute('data-action', 'gms-entry-pick');
            pick.setAttribute('data-entry-index', String(index));
            li.appendChild(label);
            li.appendChild(pick);
            listNode.appendChild(li);
          });
          return true;
        }
        const services = {
          storage: {
            read: function () { return getProfileData(); },
            write: function (nextState) {
              if (!nextState || typeof nextState !== 'object') {
                return false;
              }
              const profileData = getProfileData();
              ['genres', 'moods', 'styles', 'history'].forEach(function (key) {
                if (Array.isArray(nextState[key])) {
                  profileData[key] = nextState[key].slice();
                }
              });
              return true;
            }
          },
          profile: {
            getCurrent: function () { return state.currentProfile; },
            setCurrent: function (profileKey) {
              if (typeof profileKey !== 'string' || profileKey.trim().length === 0) {
                return false;
              }
              state.currentProfile = profileKey.trim();
              renderProfileInfo();
              renderHistory();
              return true;
            }
          },
          ui: {
            toast: function (message) { return setResult(message); },
            copy: function (value) {
              if (typeof value !== 'string' || value.trim().length === 0) {
                setResult('‚ö†Ô∏è Nichts zu kopieren.');
                return false;
              }
              if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(value).then(function () { setResult('‚úÖ Kopiert.'); });
                return true;
              }
              setResult('‚ö†Ô∏è Kopieren nicht m√∂glich. Bitte Text markieren und kopieren.');
              return false;
            }
          },
          exportCenter: {
            exportPayload: function () {
              return { module: MODULE_ID, profile: state.currentProfile, data: getProfileData() };
            },
            importPayload: function (payload) {
              if (!payload || typeof payload !== 'object' || !payload.data) {
                return { ok: false, reason: 'Import kaputt. Bitte Abbrechen oder Reparatur versuchen.' };
              }
              const incoming = payload.data;
              ['genres', 'moods', 'styles'].forEach(function (key) {
                const clean = Array.isArray(incoming[key]) ? incoming[key].filter(function (item) { return typeof item === 'string' && item.trim().length > 0; }) : [];
                addUniqueByCategory(key, clean);
              });
              renderHistory();
              return { ok: true };
            }
          },
          log: {
            info: function (message) { appendDebugLog('‚ÑπÔ∏è GMS: ' + message + ' (' + getTimeStamp() + ').'); }
          }
        };
        return {
          mount: function () {
            state.mounted = true;
            renderProfileInfo();
            renderProfileSelect();
            renderHistory();
            renderEntryList();
            return true;
          },
          unmount: function () { state.mounted = false; return true; },
          getState: function () { return JSON.parse(JSON.stringify(state)); },
          setState: function (nextState) {
            if (!nextState || typeof nextState !== 'object') {
              return false;
            }
            if (typeof nextState.currentProfile === 'string' && nextState.currentProfile.trim().length > 0) {
              state.currentProfile = nextState.currentProfile.trim();
            }
            if (nextState.profiles && typeof nextState.profiles === 'object') {
              state.profiles = nextState.profiles;
            }
            if (typeof nextState.selectedEntryIndex === 'number' && Number.isInteger(nextState.selectedEntryIndex)) {
              state.selectedEntryIndex = nextState.selectedEntryIndex;
            }
            renderProfileInfo();
            renderProfileSelect();
            renderHistory();
            renderEntryList();
            return true;
          },
          exportPayload: services.exportCenter.exportPayload,
          importPayload: services.exportCenter.importPayload,
          handleAction: function (actionValue) {
            const categoryNode = safeNode('gms-category');
            const inputNode = safeNode('gms-bulk-input');
            const feedbackNode = safeNode('gms-feedback');
            const randomNode = safeNode('gms-random-result');
            const countNode = safeNode('gms-random-count');
            const profileData = getProfileData();
            if (actionValue === 'gms-add') {
              const category = categoryNode ? categoryNode.value : '';
              const entries = normalizeEntries(inputNode ? inputNode.value : '');
              if (!entries.length) {
                if (feedbackNode) { feedbackNode.textContent = '‚ö†Ô∏è Bitte mindestens einen Eintrag eingeben.'; }
                return true;
              }
              const result = addUniqueByCategory(category, entries);
              if (feedbackNode) { feedbackNode.textContent = '‚úÖ Gespeichert: ' + result.added + '. Duplikat √ºbersprungen: ' + result.duplicates + '.'; }
              services.log.info('Eintr√§ge gespeichert in ' + category + ': +' + result.added + ', Duplikate ' + result.duplicates);
              renderEntryList();
              return true;
            }
            if (actionValue === 'gms-profile-switch') {
              const profileNode = safeNode('gms-profile-select');
              const profileName = profileNode ? profileNode.value : '';
              if (typeof profileName !== 'string' || profileName.trim().length === 0 || !state.profiles[profileName]) {
                setResult('‚ö†Ô∏è Profil nicht gefunden. Bitte Profil erneut w√§hlen.');
                return true;
              }
              state.currentProfile = profileName.trim();
              state.selectedEntryIndex = -1;
              renderProfileInfo();
              renderHistory();
              renderEntryList();
              const profileResult = safeNode('gms-profile-result');
              if (profileResult) { profileResult.textContent = '‚úÖ Profil geladen: ' + state.currentProfile + '.'; }
              return true;
            }
            if (actionValue === 'gms-profile-create') {
              const input = safeNode('gms-new-profile');
              const raw = input ? input.value : '';
              const nextName = typeof raw === 'string' ? raw.trim().toLowerCase() : '';
              if (!nextName || /[^a-z0-9\-√§√∂√º]/i.test(nextName)) {
                setResult('‚ö†Ô∏è Profilname ung√ºltig. Bitte nur Buchstaben, Zahlen oder Bindestrich nutzen.');
                return true;
              }
              if (!state.profiles[nextName]) {
                state.profiles[nextName] = { genres: [], moods: [], styles: [], history: [] };
              }
              state.currentProfile = nextName;
              if (input) { input.value = ''; }
              renderProfileInfo();
              renderProfileSelect();
              renderHistory();
              renderEntryList();
              const profileResult = safeNode('gms-profile-result');
              if (profileResult) { profileResult.textContent = '‚úÖ Profil erstellt: ' + state.currentProfile + '.'; }
              return true;
            }
            if (actionValue === 'gms-entry-pick') {
              return true;
            }
            if (actionValue === 'gms-entry-delete') {
              const category = categoryNode ? categoryNode.value : '';
              const active = getProfileData();
              if (state.selectedEntryIndex < 0 || !Array.isArray(active[category]) || !active[category][state.selectedEntryIndex]) {
                setResult('‚ö†Ô∏è Bitte zuerst einen Eintrag ausw√§hlen.');
                return true;
              }
              active[category].splice(state.selectedEntryIndex, 1);
              state.selectedEntryIndex = -1;
              renderEntryList();
              setResult('‚úÖ Eintrag gel√∂scht.');
              return true;
            }
            if (actionValue === 'gms-entry-rename') {
              const category = categoryNode ? categoryNode.value : '';
              const active = getProfileData();
              const current = state.selectedEntryIndex >= 0 && Array.isArray(active[category]) ? active[category][state.selectedEntryIndex] : '';
              if (!current) {
                setResult('‚ö†Ô∏è Bitte zuerst einen Eintrag ausw√§hlen.');
                return true;
              }
              const renamed = window.prompt('Neuen Namen eingeben:', current);
              if (typeof renamed !== 'string' || renamed.trim().length === 0) {
                setResult('‚ö†Ô∏è Umbenennen abgebrochen. Bitte erneut versuchen.');
                return true;
              }
              active[category][state.selectedEntryIndex] = renamed.trim();
              renderEntryList();
              setResult('‚úÖ Eintrag umbenannt.');
              return true;
            }
            if (actionValue === 'gms-random') {
              const count = countNode ? Number(countNode.value) : 1;
              const merged = profileData.genres.concat(profileData.moods, profileData.styles);
              const resultItems = chooseRandom(merged, count);
              if (!resultItems.length) {
                if (randomNode) { randomNode.textContent = '‚ö†Ô∏è Keine Daten vorhanden. Bitte zuerst Eintr√§ge speichern.'; }
                return true;
              }
              state.lastRandomResult = resultItems.join(', ');
              addHistoryItem(state.lastRandomResult);
              renderHistory();
              if (randomNode) { randomNode.textContent = 'üé≤ ' + state.lastRandomResult; }
              services.log.info('Zufall erzeugt: ' + state.lastRandomResult);
              return true;
            }
            if (actionValue === 'gms-copy-random') { return services.ui.copy(state.lastRandomResult); }
            if (actionValue === 'gms-copy-history') { return services.ui.copy(profileData.history.join('\n')); }
            if (actionValue === 'gms-clear-history') {
              profileData.history = [];
              renderHistory();
              renderEntryList();
              setResult('‚úÖ Verlauf gel√∂scht.');
              return true;
            }
            if (actionValue === 'gms-export') {
              const exportData = this.exportPayload();
              if (!exportData || typeof exportData !== 'object' || !exportData.data) {
                setResult('‚ö†Ô∏è Export fehlgeschlagen. N√§chster Schritt: Eintr√§ge pr√ºfen und erneut exportieren.');
                return true;
              }
              const fileName = buildExportFileName(exportData.module, exportData.profile);
              const payload = JSON.stringify(Object.assign({}, exportData, { file_name: fileName }), null, 2);
              const copied = services.ui.copy(payload);
              if (gmsExportFilenameStatusNode) {
                gmsExportFilenameStatusNode.textContent = 'Dateiname: ' + fileName;
              }
              setResult(copied ? '‚úÖ Export kopiert. Dateiname: ' + fileName : '‚ö†Ô∏è Export erstellt, aber Kopieren ist fehlgeschlagen. Dateiname: ' + fileName);
              return true;
            }
            if (actionValue === 'gms-import-demo') {
              const demo = { data: { genres: ['Electro'], moods: ['Hell'], styles: ['Minimal'] } };
              const merged = this.importPayload(demo);
              if (!merged.ok) {
                setResult('‚ö†Ô∏è Import kaputt. Abbrechen / Reparatur versuchen / Backup laden.');
                return true;
              }
              setResult('‚úÖ Demo-Import gemerged.');
              return true;
            }
            return false;
          }
        };
      })();
      function getDialogFocusableElements() {
        if (!dialog) {
          return [];
        }
        return Array.from(dialog.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'));
      }
      function restoreFocusAfterDialog() {
        if (!lastDialogTrigger || typeof lastDialogTrigger.focus !== 'function') {
          return false;
        }
        lastDialogTrigger.focus();
        return true;
      }
      function keepDialogFocusInside(event) {
        if (!dialog || !dialog.open || !event || event.key !== 'Tab') {
          return false;
        }
        const focusable = getDialogFocusableElements();
        if (!focusable.length) {
          return false;
        }
        const first = focusable[0];
        const last = focusable[focusable.length - 1];
        const active = document.activeElement;
        if (event.shiftKey && active === first) {
          event.preventDefault();
          last.focus();
          return true;
        }
        if (!event.shiftKey && active === last) {
          event.preventDefault();
          first.focus();
          return true;
        }
        return false;
      }
      function setResult(message) {
        if (!resultNode || typeof message !== 'string' || message.trim().length === 0) {
          return false;
        }
        resultNode.textContent = message;
        return true;
      }
      function getTimeStamp() {
        return new Date().toLocaleTimeString('de-DE');
      }
      function deriveExportWorkflowStatus() {
        const syncText = syncStatusNode && typeof syncStatusNode.textContent === 'string' ? syncStatusNode.textContent.toLowerCase() : '';
        const backupEnabled = readBackupPreference();
        if (syncText.indexOf('alle √§nderungen gespeichert') !== -1 && backupEnabled) {
          return 'release-ready';
        }
        if (syncText.indexOf('gespeichert') !== -1) {
          return 'review-ready';
        }
        return 'in-abstimmung';
      }
      function sanitizeForLinuxFileName(value) {
        if (typeof value !== 'string' || value.trim().length === 0) {
          return 'ohne-inhalt';
        }
        const clean = value.trim().toLowerCase()
          .replace(/[√§]/g, 'ae')
          .replace(/[√∂]/g, 'oe')
          .replace(/[√º]/g, 'ue')
          .replace(/[√ü]/g, 'ss')
          .replace(/[^a-z0-9._-]+/g, '-')
          .replace(/-+/g, '-')
          .replace(/^-|-$/g, '');
        return clean.length > 0 ? clean.slice(0, 60) : 'ohne-inhalt';
      }
      function buildExportFileName(moduleId, profileName) {
        const modulePart = sanitizeForLinuxFileName(moduleId);
        const profilePart = sanitizeForLinuxFileName(profileName);
        const statusPart = deriveExportWorkflowStatus();
        const datePart = new Date().toISOString().slice(0, 10).replace(/-/g, '');
        return [modulePart, profilePart, statusPart, datePart].join('__') + '.json';
      }
      function updateSyncStatus(statusText) {
        if (typeof statusText !== 'string' || statusText.trim().length === 0) {
          return false;
        }
        const fullText = statusText.trim();
        if (syncStatusNode) {
          syncStatusNode.textContent = fullText;
        }
        if (footerSyncStatusNode) {
          footerSyncStatusNode.textContent = fullText.replace(/^‚úÖ\s*/, '');
        }
        return true;
      }
      function setDebugDetails(eventLabel, nextStep) {
        if (typeof eventLabel !== 'string' || eventLabel.trim().length === 0) {
          return false;
        }
        if (typeof nextStep !== 'string' || nextStep.trim().length === 0) {
          return false;
        }
        if (debugEventNode) {
          debugEventNode.textContent = 'Letztes Ereignis: ' + eventLabel.trim() + ' um ' + getTimeStamp() + '.';
        }
        if (debugNextStepNode) {
          debugNextStepNode.textContent = 'N√§chster Schritt: ' + nextStep.trim();
        }
        return true;
      }
      function appendDebugLog(message) {
        if (typeof message !== 'string' || message.trim().length === 0) {
          return false;
        }
        const text = message.trim();
        if (topbarLogListNode) {
          const topItem = document.createElement('li');
          topItem.textContent = text;
          topbarLogListNode.prepend(topItem);
          while (topbarLogListNode.children.length > 10) {
            topbarLogListNode.removeChild(topbarLogListNode.lastElementChild);
          }
        }
        if (!debugLogListNode) {
          return false;
        }
        const listItem = document.createElement('li');
        listItem.textContent = text;
        debugLogListNode.prepend(listItem);
        while (debugLogListNode.children.length > 5) {
          debugLogListNode.removeChild(debugLogListNode.lastElementChild);
        }
        return true;
      }
      function setModuleStatus(message) {
        if (!moduleStatusNode || typeof message !== 'string' || message.trim().length === 0) {
          return false;
        }
        moduleStatusNode.textContent = message.trim();
        return true;
      }
      function setProjectDialogResult(message) {
        if (!projectDialogResultNode || typeof message !== 'string' || message.trim().length === 0) {
          return false;
        }
        projectDialogResultNode.textContent = message.trim();
        return true;
      }
      function copyLogToClipboard() {
        if (!topbarLogListNode || !topbarLogListNode.children.length) {
          return setResult('‚ö†Ô∏è Kein Protokoll vorhanden. Bitte zuerst eine Aktion starten.');
        }
        const text = Array.from(topbarLogListNode.querySelectorAll('li')).map(function (entry) {
          return entry.textContent || '';
        }).join('\n');
        if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard.writeText(text);
          return setResult('‚úÖ Protokoll kopiert.');
        }
        return setResult('‚ö†Ô∏è Kopieren nicht m√∂glich. Bitte Text manuell markieren.');
      }
      function toggleMode() {
        isProMode = !isProMode;
        if (modeSwitchNode) {
          modeSwitchNode.textContent = isProMode ? 'Modus: Profi' : 'Modus: Laie';
          modeSwitchNode.setAttribute('aria-pressed', isProMode ? 'true' : 'false');
        }
        return setResult(isProMode ? '‚úÖ Profi-Modus aktiv: mehr Technikdetails sichtbar.' : '‚úÖ Laien-Modus aktiv: einfache Hinweise sichtbar.');
      }
      function normalizeProjectPath(value) {
        if (typeof value !== 'string') {
          return '';
        }
        return value.trim();
      }
      function validateProjectPath(value) {
        const pathValue = normalizeProjectPath(value);
        if (pathValue.length < 2 || pathValue.startsWith('/') === false) {
          return false;
        }
        return true;
      }
      function hasExtraWhitespaceInPath(value) {
        return typeof value === 'string' && /\s{2,}/.test(value);
      }
      function getStoredProjectPath() {
        const localValue = window.localStorage.getItem('provoware-project-path');
        if (validateProjectPath(localValue)) {
          return normalizeProjectPath(localValue);
        }
        if (validateProjectPath(serverProjectPath)) {
          return normalizeProjectPath(serverProjectPath);
        }
        return '';
      }
      function updateProjectStatus(pathValue) {
        if (!projectStatusNode) {
          return false;
        }
        if (typeof pathValue !== 'string' || pathValue.trim().length === 0) {
          projectStatusNode.textContent = 'Projektordner: noch nicht gesetzt. Bitte im Dialog einen Pfad eingeben.';
          return true;
        }
        projectStatusNode.textContent = 'Projektordner aktiv: ' + pathValue + '.';
        return true;
      }
      function updateFooterContext(pathValue) {
        const validatedPath = typeof pathValue === 'string' && validateProjectPath(pathValue) ? normalizeProjectPath(pathValue) : 'nicht gesetzt';
        const backupEnabled = readBackupPreference();
        if (footerVersionPathNode) {
          footerVersionPathNode.textContent = 'Version: ' + APP_VERSION + ' | Projektpfad: ' + validatedPath;
        }
        if (footerBackupStatusNode) {
          footerBackupStatusNode.textContent = backupEnabled ? 'Auto-Backup: Aktiv' : 'Auto-Backup: Inaktiv. N√§chster Schritt: Backup einschalten.';
        }
        return true;
      }
      function saveProjectPath(pathValue) {
        const normalized = normalizeProjectPath(pathValue);
        if (!validateProjectPath(normalized)) {
          setProjectDialogResult('‚ö†Ô∏è Ung√ºltiger Pfad. Bitte absoluten Pfad eingeben, z. B. /home/name/Ordner.');
          return false;
        }
        if (hasExtraWhitespaceInPath(pathValue)) {
          setProjectDialogResult('‚ö†Ô∏è Pfad gespeichert. Hinweis: Mehrere Leerzeichen erkannt. Bitte kurz pr√ºfen, ob das so gew√ºnscht ist.');
        }
        window.localStorage.setItem('provoware-project-path', normalized);
        updateProjectStatus(normalized);
        updateFooterContext(normalized);
        if (!hasExtraWhitespaceInPath(pathValue)) {
          setProjectDialogResult('‚úÖ Pfad gespeichert. N√§chster Schritt: start.sh neu starten, damit die Pr√ºfung und ggf. Erstellung l√§uft.');
        }
        setDebugDetails('Projektpfad aktualisiert', 'F√ºhren Sie ./start.sh aus. Die Start-Routine pr√ºft den Ordner und erstellt ihn bei Bedarf.');
        appendDebugLog('‚úÖ Projektpfad gespeichert: ' + normalized + ' (' + getTimeStamp() + ').');
        setResult('‚úÖ Projektordner im Dashboard aktualisiert.');
        return true;
      }
      function setActiveNavigation(moduleKey) {
        if (!Array.isArray(navButtonNodes) || typeof moduleKey !== 'string' || moduleKey.trim().length === 0) {
          return false;
        }
        navButtonNodes.forEach(function (buttonNode) {
          if (!(buttonNode instanceof HTMLElement)) {
            return;
          }
          const current = buttonNode.getAttribute('data-module-nav') === moduleKey.trim();
          if (current) {
            buttonNode.setAttribute('aria-current', 'page');
          } else {
            buttonNode.removeAttribute('aria-current');
          }
        });
        return true;
      }
      function renderModuleSidebarOptions(moduleKey, sourceMeta) {
        if (!moduleOptionListNode) {
          return false;
        }
        const optionsByModule = {
          'gms-suite': ['üß≤ Reihenfolge im Archiv per Drag&Drop √§ndern', 'üé≤ Zufallsvorschlag erzeugen und direkt kopieren', 'üìã Liste pflegen mit Umbenennen/L√∂schen'],
          'debug-dev': ['ü™µ Live-Debug-Log lesen', 'üß™ Fehlermeldung mit Next Steps ausl√∂sen', 'üõ†Ô∏è Entwicklerhinweise nur bei Bedarf √∂ffnen']
        };
        const items = optionsByModule[moduleKey] || ['Bitte g√ºltiges Modul w√§hlen.'];
        moduleOptionListNode.innerHTML = '';
        items.forEach(function (entry) {
          const li = document.createElement('li');
          li.textContent = entry;
          moduleOptionListNode.appendChild(li);
        });
        if (sourceMeta) {
          const li = document.createElement('li');
          li.textContent = '‚ÑπÔ∏è Datenquelle aktiv: ' + sourceMeta.dataSource;
          moduleOptionListNode.appendChild(li);
        }
        return true;
      }
      function normalizeModuleSources(rawValue) {
        if (!rawValue || typeof rawValue !== 'object' || Array.isArray(rawValue)) {
          appendDebugLog('‚ö†Ô∏è Modulquellen fehlen oder sind ung√ºltig. N√§chster Schritt: Start √ºber "bash start.sh" wiederholen.');
          return {};
        }
        return rawValue;
      }
      function getThemePreference() {
        const allowed = ['balanced', 'high-contrast', 'light', 'dark'];
        const htmlTheme = html && typeof html.getAttribute === 'function' ? html.getAttribute('data-theme') : '';
        if (typeof htmlTheme === 'string' && allowed.includes(htmlTheme.trim())) {
          return htmlTheme.trim();
        }
        const selectorTheme = themeSelector && typeof themeSelector.value === 'string' ? themeSelector.value.trim() : '';
        if (allowed.includes(selectorTheme)) {
          return selectorTheme;
        }
        return 'high-contrast';
      }
      function setPluginStatus(selectedModule) {
        if (!pluginStatusListNode || typeof selectedModule !== 'string' || selectedModule.trim().length === 0) {
          return false;
        }
        const sourceMeta = getModuleSourceMeta(selectedModule);
        const activeLabel = sourceMeta ? sourceMeta.label.trim().toLowerCase() : '';
        const pluginRows = Array.from(pluginStatusListNode.querySelectorAll('.plugin-status-item'));
        if (!pluginRows.length) {
          return false;
        }
        pluginRows.forEach(function (row) {
          if (!(row instanceof HTMLElement)) {
            return;
          }
          const nameNode = row.querySelector('span');
          const statusNode = row.querySelector('.plugin-pill');
          if (!nameNode || !statusNode) {
            return;
          }
          const rowKey = nameNode.textContent ? nameNode.textContent.trim().toLowerCase() : '';
          const isActive = !!activeLabel && rowKey === activeLabel;
          statusNode.textContent = isActive ? 'Aktiv' : 'Wartet';
          statusNode.classList.toggle('plugin-pill-online', isActive);
          statusNode.classList.toggle('plugin-pill-offline', !isActive);
        });
        return true;
      }
      function getModuleSourceMeta(moduleKey) {
        if (typeof moduleKey !== 'string' || moduleKey.trim().length === 0) {
          return null;
        }
        const normalizedKey = moduleKey.trim();
        const localFallback = {
          'gms-suite': { label: 'Genres-Archiv + Zufall + Liste', data_source: 'data/project_context.json', detail: 'Geb√ºndeltes Modul f√ºr Archiv, Zufallsgenerator und Listenpflege im selben Bereich.', next_step: 'Eintr√§ge speichern oder Zufall erzeugen.' },
          'debug-dev': { label: 'Debugging & Entwickleroptionen', data_source: 'logs/status_summary.txt', detail: 'Zeigt Live-Protokoll, Fehlerhilfe und n√§chste technische Schritte.', next_step: 'Bei Fehlern zuerst Log lesen und dann Reparatur starten.' }
        };
        const sourceMeta = (serverModuleSources && typeof serverModuleSources === 'object' && normalizedKey in serverModuleSources) ? serverModuleSources[normalizedKey] : localFallback[normalizedKey];
        if (!sourceMeta) {
          return null;
        }
        if (!sourceMeta || typeof sourceMeta !== 'object') {
          return null;
        }
        const label = typeof sourceMeta.label === 'string' ? sourceMeta.label.trim() : '';
        const dataSource = typeof sourceMeta.data_source === 'string' ? sourceMeta.data_source.trim() : '';
        const detail = typeof sourceMeta.detail === 'string' ? sourceMeta.detail.trim() : '';
        const nextStep = typeof sourceMeta.next_step === 'string' ? sourceMeta.next_step.trim() : '';
        if (!label || !dataSource || !detail || !nextStep) {
          appendDebugLog('‚ö†Ô∏è Modulquelle unvollst√§ndig f√ºr "' + normalizedKey + '". N√§chster Schritt: config/module_sources.json pr√ºfen.');
          return null;
        }
        return { label: label, dataSource: dataSource, detail: detail, nextStep: nextStep };
      }
      function renderModulePreview(selectedModule) {
        const previewNode = document.getElementById('module-source-preview');
        if (!(previewNode instanceof HTMLElement)) {
          return false;
        }
        const sourceMeta = getModuleSourceMeta(selectedModule);
        if (!sourceMeta) {
          previewNode.textContent = 'Kurzdetails: Keine g√ºltige Modulauswahl. N√§chster Schritt: Modul w√§hlen und erneut versuchen.';
          return false;
        }
        previewNode.textContent = 'Kurzdetails: ' + sourceMeta.detail + ' Datenquelle: ' + sourceMeta.dataSource + '. N√§chster Schritt: ' + sourceMeta.nextStep + '.';
        return true;
      }
      function switchActiveModulePanel(moduleKey) {
        if (!Array.isArray(modulePanelNodes) || !modulePanelNodes.length) {
          return false;
        }
        modulePanelNodes.forEach(function (panelNode) {
          if (!(panelNode instanceof HTMLElement)) {
            return;
          }
          const shouldShow = panelNode.id === moduleKey + '-view';
          panelNode.classList.toggle('active', shouldShow);
        });
        if (moduleStageEmptyNode instanceof HTMLElement) {
          moduleStageEmptyNode.hidden = false;
          if (moduleKey) {
            const activePanel = document.getElementById(moduleKey + '-view');
            moduleStageEmptyNode.hidden = activePanel instanceof HTMLElement;
          }
        }
        activeModuleKey = moduleKey;
        return true;
      }
      function openModule(selectedModule) {
        const sourceMeta = getModuleSourceMeta(selectedModule);
        if (typeof selectedModule !== 'string' || !sourceMeta) {
          setDebugDetails('Modulstart fehlgeschlagen', 'Bitte zuerst ein Modul ausw√§hlen und dann erneut ‚ÄûModul √∂ffnen‚Äú dr√ºcken.');
          appendDebugLog('‚ö†Ô∏è Modulstart abgebrochen: Keine g√ºltige Auswahl oder fehlende Datenquelle.');
          setModuleStatus('‚ö†Ô∏è Kein Modul gestartet: Bitte ein Modul ausw√§hlen.');
          return setResult('‚ö†Ô∏è Modul konnte nicht ge√∂ffnet werden. Bitte Auswahl und Datenquelle pr√ºfen.');
        }
        const statusText = '‚úÖ Modul aktiv: ' + sourceMeta.label + '. Datenquelle: ' + sourceMeta.dataSource + '.';
        const debugTitle = 'Modul gewechselt zu ' + sourceMeta.label;
        const debugStep = sourceMeta.detail + ' N√§chster Schritt: ' + sourceMeta.nextStep;
        setModuleStatus(statusText);
        renderModulePreview(selectedModule);
        switchActiveModulePanel(selectedModule);
        setActiveNavigation(selectedModule);
        setPluginStatus(selectedModule);
        renderModuleSidebarOptions(selectedModule, sourceMeta);
        if (inspectorDetailsNode) { inspectorDetailsNode.textContent = 'Details: ' + sourceMeta.label + ' ist aktiv. Status: Bereit.'; }
        if (inspectorHelpNode) { inspectorHelpNode.textContent = 'Hilfe: ' + sourceMeta.nextStep; }
        if (inspectorMetaNode) { inspectorMetaNode.textContent = 'Meta: Quelle ' + sourceMeta.dataSource + ', letzter Wechsel: ' + getTimeStamp() + '.'; }
        setDebugDetails(debugTitle, debugStep);
        appendDebugLog('‚úÖ Modul geladen: ' + sourceMeta.label + ' | Datenquelle: ' + sourceMeta.dataSource + ' (' + getTimeStamp() + ').');
        updateSyncStatus('‚úÖ Modul bereit: ' + sourceMeta.label + ' (' + getTimeStamp() + ')');
        return setResult('‚úÖ Modul ge√∂ffnet: ' + sourceMeta.label + '. Datenquelle: ' + sourceMeta.dataSource + '.');
      }
      function applyTheme(themeValue) {
        const allowed = ['balanced', 'high-contrast', 'light', 'dark'];
        if (typeof themeValue !== 'string' || !allowed.includes(themeValue)) {
          setResult('‚ö†Ô∏è Ung√ºltiges Theme. Erlaubt sind: balanced, high-contrast, light, dark.');
          return false;
        }
        const helperTextByTheme = {
          balanced: 'Aktives Theme: balanced. Ruhige Farben mit klarer Lesbarkeit.',
          'high-contrast': 'Aktives Theme: high-contrast. Empfohlen f√ºr maximalen Kontrast.',
          light: 'Aktives Theme: light. Bitte Fokusrahmen gut sichtbar pr√ºfen.',
          dark: 'Aktives Theme: dark. Bitte Helligkeit und Lesbarkeit kurz pr√ºfen.'
        };
        html.setAttribute('data-theme', themeValue);
        if (themeStatusNode) {
          themeStatusNode.textContent = helperTextByTheme[themeValue] || 'Aktives Theme ge√§ndert.';
        }
        setDebugDetails('Theme ge√§ndert', 'Pr√ºfen Sie kurz Lesbarkeit, Fokusrahmen und Symboltexte im gew√§hlten Theme.');
        appendDebugLog('‚ÑπÔ∏è Theme aktiv: ' + themeValue + ' (' + getTimeStamp() + ').');
        setResult('‚úÖ Theme wurde gesetzt: ' + themeValue + '.');
        return true;
      }
      function setCardState(node, stateValue, plainText) {
        const allowed = ['ready', 'loading', 'error'];
        if (!(node instanceof HTMLElement) || typeof plainText !== 'string' || !allowed.includes(stateValue)) {
          return false;
        }
        node.setAttribute('data-state', stateValue);
        node.textContent = 'Status: ' + plainText;
        return true;
      }
      function readFontScalePreference() {
        if (!(window.localStorage && typeof window.localStorage.getItem === 'function')) {
          return 'm';
        }
        const saved = window.localStorage.getItem(FONT_SCALE_STORAGE_KEY);
        const allowed = ['s', 'm', 'l', 'xl'];
        return typeof saved === 'string' && allowed.includes(saved) ? saved : 'm';
      }
      function applyFontScale(scaleValue) {
        const allowed = { s: '0.94', m: '1', l: '1.1', xl: '1.2' };
        if (typeof scaleValue !== 'string' || !Object.prototype.hasOwnProperty.call(allowed, scaleValue)) {
          setResult('‚ö†Ô∏è Ung√ºltige Textgr√∂√üe. Bitte S, M, L oder XL w√§hlen.');
          return false;
        }
        html.style.fontSize = allowed[scaleValue] + 'rem';
        if (fontScaleSelector) {
          fontScaleSelector.value = scaleValue;
        }
        if (fontScaleStatusNode) {
          const labels = { s: 'S (kompakt)', m: 'M (standard)', l: 'L (gr√∂√üer)', xl: 'XL (sehr gro√ü)' };
          fontScaleStatusNode.textContent = 'Textgr√∂√üe: ' + labels[scaleValue] + '.';
        }
        if (window.localStorage && typeof window.localStorage.setItem === 'function') {
          window.localStorage.setItem(FONT_SCALE_STORAGE_KEY, scaleValue);
        }
        return true;
      }
      function readBackupPreference() {
        if (!(window.localStorage && typeof window.localStorage.getItem === 'function')) {
          return true;
        }
        const rawValue = window.localStorage.getItem(BACKUP_STORAGE_KEY);
        if (rawValue === null) {
          return true;
        }
        if (rawValue !== 'true' && rawValue !== 'false') {
          appendDebugLog('‚ö†Ô∏è Backup-Einstellung war ung√ºltig. N√§chster Schritt: Einstellung wird automatisch auf Aktiv gesetzt.');
          window.localStorage.setItem(BACKUP_STORAGE_KEY, 'true');
          return true;
        }
        return rawValue === 'true';
      }
      function applyBackupPreference(isEnabled, sourceLabel) {
        if (typeof isEnabled !== 'boolean') {
          setResult('‚ö†Ô∏è Backup-Einstellung ist ung√ºltig. Bitte erneut versuchen.');
          return false;
        }
        if (window.localStorage && typeof window.localStorage.setItem === 'function') {
          window.localStorage.setItem(BACKUP_STORAGE_KEY, String(isEnabled));
        }
        if (backupToggleNode) {
          backupToggleNode.checked = isEnabled;
        }
        if (backupStatusNode) {
          backupStatusNode.textContent = isEnabled ? 'Auto-Backup: Aktiv. √Ñnderungen werden zus√§tzlich gesichert.' : 'Auto-Backup: Inaktiv. N√§chster Schritt: Bitte manuell speichern oder Backup wieder aktivieren.';
        }
        updateFooterContext(getStoredProjectPath());
        const sourceText = typeof sourceLabel === 'string' && sourceLabel.trim().length > 0 ? sourceLabel.trim() : 'Unbekannt';
        appendDebugLog('‚ÑπÔ∏è Backup-Einstellung: ' + (isEnabled ? 'aktiv' : 'inaktiv') + ' (' + sourceText + ', ' + getTimeStamp() + ').');
        return true;
      }
      function saveLayoutProfile() {
        if (!(shellNode instanceof HTMLElement)) {
          return false;
        }
        const profile = {
          width: shellNode.style.width || '',
          margin: shellNode.style.margin || '',
          opacity: shellNode.style.opacity || ''
        };
        if (!(window.localStorage && typeof window.localStorage.setItem === 'function')) {
          setResult('‚ö†Ô∏è Layout kann hier nicht gespeichert werden.');
          return false;
        }
        window.localStorage.setItem(LAYOUT_STORAGE_KEY, JSON.stringify(profile));
        return true;
      }
      function restoreLayoutProfile() {
        if (!(shellNode instanceof HTMLElement) || !(window.localStorage && typeof window.localStorage.getItem === 'function')) {
          return false;
        }
        const raw = window.localStorage.getItem(LAYOUT_STORAGE_KEY);
        if (typeof raw !== 'string' || raw.trim().length === 0) {
          setResult('‚ö†Ô∏è Kein gespeichertes Layout gefunden. Bitte zuerst ‚ÄûLayout speichern‚Äú nutzen.');
          return false;
        }
        let profile;
        try {
          profile = JSON.parse(raw);
        } catch (error) {
          setResult('‚ö†Ô∏è Gespeichertes Layout ist besch√§digt. Bitte neu speichern.');
          return false;
        }
        if (!profile || typeof profile !== 'object') {
          setResult('‚ö†Ô∏è Layoutdaten ung√ºltig. Bitte neu speichern.');
          return false;
        }
        shellNode.style.width = typeof profile.width === 'string' ? profile.width : '';
        shellNode.style.margin = typeof profile.margin === 'string' ? profile.margin : '';
        shellNode.style.opacity = typeof profile.opacity === 'string' ? profile.opacity : '';
        return true;
      }
      function executeAction(actionValue) {
        const known = ['save', 'retry', 'repair', 'log', 'error', 'close-dialog', 'open-module', 'project-setup', 'project-save', 'project-close', 'open-shortcuts', 'close-shortcuts', 'project-switch', 'copy-log', 'switch-mode', 'window-hide', 'window-maximize', 'window-reset', 'window-detach', 'layout-save', 'layout-restore', 'gms-add', 'gms-random', 'gms-copy-random', 'gms-copy-history', 'gms-clear-history', 'gms-export', 'gms-import-demo', 'gms-profile-switch', 'gms-profile-create', 'gms-entry-delete', 'gms-entry-rename', 'gms-entry-pick'];
        if (typeof actionValue !== 'string' || !known.includes(actionValue)) {
          return setResult('‚ö†Ô∏è Unbekannte Aktion. Bitte pr√ºfen Sie den Button.');
        }
        if (actionValue.startsWith('gms-')) {
          return gmsPlugin.handleAction(actionValue);
        }
        if (actionValue === 'open-module') {
          const selectedValue = moduleSelector && typeof moduleSelector.value === 'string' ? moduleSelector.value.trim() : '';
          return openModule(selectedValue);
        }
        if (actionValue === 'project-setup') {
          if (projectDialog && typeof projectDialog.showModal === 'function') {
            projectDialog.showModal();
            if (projectPathInput) {
              projectPathInput.value = getStoredProjectPath();
              projectPathInput.focus();
            }
            return setResult('‚ÑπÔ∏è Projekt-Routine ge√∂ffnet. Bitte Pfad pr√ºfen und speichern.');
          }
          return setResult('‚ö†Ô∏è Projekt-Routine kann in diesem Browser nicht als Dialog ge√∂ffnet werden.');
        }
        if (actionValue === 'project-save') {
          const userPath = projectPathInput ? projectPathInput.value : '';
          return saveProjectPath(userPath);
        }
        if (actionValue === 'project-close') {
          if (projectDialog && typeof projectDialog.close === 'function') {
            projectDialog.close();
          }
          return setResult('‚ÑπÔ∏è Projekt-Routine geschlossen. Sie k√∂nnen sp√§ter fortsetzen.');
        }
        if (actionValue === 'open-shortcuts') { return openShortcutOverlay(); }
        if (actionValue === 'close-shortcuts') { return closeShortcutOverlay(); }
        if (actionValue === 'project-switch') { return applyProjectSwitch(); }
        if (actionValue === 'copy-log') { return copyLogToClipboard(); }
        if (actionValue === 'switch-mode') { return toggleMode(); }
        if (actionValue === 'window-hide') {
          if (!activeModuleKey) {
            return setResult('‚ö†Ô∏è Kein aktives Modul im Grid. Bitte zuerst ein Modul √∂ffnen.');
          }
          switchActiveModulePanel('');
          return setResult('‚úÖ Modul aus dem Grid ausgeblendet.');
        }
        if (actionValue === 'window-maximize') {
          if (!activeModuleKey) {
            return setResult('‚ö†Ô∏è Kein aktives Modul im Grid. Bitte zuerst ein Modul √∂ffnen.');
          }
          if (moduleStageNode) {
            moduleStageNode.style.minHeight = '70vh';
          }
          return setResult('‚úÖ Aktives Modul im Grid vergr√∂√üert.');
        }
        if (actionValue === 'window-reset') {
          if (moduleStageNode) {
            moduleStageNode.style.minHeight = '';
          }
          if (activeModuleKey) {
            switchActiveModulePanel(activeModuleKey);
          }
          return setResult('‚úÖ Grid-Sicht wiederhergestellt.');
        }
        if (actionValue === 'layout-save') {
          if (saveLayoutProfile()) {
            return setResult('‚úÖ Layout gespeichert. N√§chster Schritt: Bei Bedarf ‚ÄûGespeichertes Layout laden‚Äú nutzen.');
          }
          return setResult('‚ö†Ô∏è Layout konnte nicht gespeichert werden.');
        }
        if (actionValue === 'layout-restore') {
          if (restoreLayoutProfile()) {
            return setResult('‚úÖ Gespeichertes Layout geladen.');
          }
          return false;
        }
        if (actionValue === 'window-detach') {
          const selected = activeModuleKey || (moduleSelector && typeof moduleSelector.value === 'string' ? moduleSelector.value.trim() : '');
          const sourceMeta = getModuleSourceMeta(selected);
          if (!sourceMeta) {
            return setResult('‚ö†Ô∏è Erst ein Modul w√§hlen und √∂ffnen, dann Einzelfenster starten.');
          }
          const windowId = 'module_' + selected;
          const featureString = 'width=760,height=580,resizable=yes,scrollbars=yes';
          const detached = window.open('', windowId, featureString);
          if (!detached) {
            return setResult('‚ö†Ô∏è Einzelfenster blockiert. Bitte Pop-up erlauben und erneut versuchen.');
          }
          detachedWindows[windowId] = detached;
          detached.document.title = 'Einzelfenster: ' + sourceMeta.label;
          detached.document.body.textContent = '';
          const mainNode = detached.document.createElement('main');
          mainNode.style.fontFamily = 'Arial, sans-serif';
          mainNode.style.padding = '1rem';
          const titleNode = detached.document.createElement('h1');
          titleNode.textContent = sourceMeta.label;
          const sourceNode = detached.document.createElement('p');
          sourceNode.textContent = 'Datenquelle: ' + sourceMeta.dataSource;
          const detailNode = detached.document.createElement('p');
          detailNode.textContent = sourceMeta.detail;
          const nextStepNode = detached.document.createElement('p');
          nextStepNode.textContent = 'N√§chster Schritt: ' + sourceMeta.nextStep;
          mainNode.appendChild(titleNode);
          mainNode.appendChild(sourceNode);
          mainNode.appendChild(detailNode);
          mainNode.appendChild(nextStepNode);
          detached.document.body.appendChild(mainNode);
          return setResult('‚úÖ Einzelfenster ge√∂ffnet f√ºr ' + sourceMeta.label + '.');
        }
        if (actionValue === 'save') {
          const message = '‚úÖ Gespeichert um ' + getTimeStamp() + '.';
          updateSyncStatus('‚úÖ Alle √Ñnderungen gespeichert (' + getTimeStamp() + ')');
      setCardState(projectCardStateNode, 'ready', 'Bereit');
          setDebugDetails('Speichern abgeschlossen', 'Sie k√∂nnen jetzt sicher weiterarbeiten oder mit Alt+L das Protokoll √∂ffnen.');
          return setResult(message);
        }
        if (actionValue === 'retry') {
          updateSyncStatus('‚úÖ Aktion erneut bereit (' + getTimeStamp() + ')');
          setDebugDetails('Erneut versuchen vorbereitet', 'F√ºhren Sie die gew√ºnschte Aktion jetzt erneut aus.');
          return setResult('‚û°Ô∏è Erneut versuchen wurde vorbereitet. Aktion jetzt wiederholen.');
        }
        if (actionValue === 'repair') {
          setDebugDetails('Reparatur empfohlen', 'F√ºhren Sie ./start.sh --repair aus und pr√ºfen Sie danach den Statusbericht.');
          return setResult('‚û°Ô∏è Reparaturhinweis: Starten Sie ./start.sh --repair');
        }
        if (actionValue === 'log') {
          setDebugDetails('Protokollhilfe ge√∂ffnet', '√ñffnen Sie logs/start.log und suchen Sie nach der letzten ‚ùå-Meldung.');
          return setResult('‚û°Ô∏è Protokollhinweis: √ñffnen Sie logs/start.log');
        }
        if (actionValue === 'error') {
          setCardState(debugCardStateNode, 'error', 'Fehlerhinweis aktiv');
          if (dialog && typeof dialog.showModal === 'function') {
            lastDialogTrigger = document.activeElement instanceof HTMLElement ? document.activeElement : null;
            dialog.showModal();
            const firstDialogButton = getDialogFocusableElements()[0];
            if (firstDialogButton && typeof firstDialogButton.focus === 'function') {
              firstDialogButton.focus();
            }
            setDebugDetails('Fehlerdialog ge√∂ffnet', 'W√§hlen Sie im Dialog zuerst ‚ÄûErneut versuchen‚Äú und pr√ºfen Sie danach das Protokoll.');
            return setResult('‚ùå Fehlerdialog ge√∂ffnet. Bitte n√§chsten Schritt w√§hlen.');
          }
          setDebugDetails('Fehlerdialog fehlgeschlagen', 'Browser aktualisieren und Aktion erneut ausf√ºhren.');
          return setResult('‚ö†Ô∏è Fehlerdialog konnte nicht ge√∂ffnet werden. Browser pr√ºfen.');
        }
        if (actionValue === 'close-dialog') {
          if (dialog && typeof dialog.close === 'function') {
            dialog.close();
            restoreFocusAfterDialog();
            setDebugDetails('Fehlerdialog geschlossen', 'Sie k√∂nnen jetzt ohne Dialog weiterarbeiten.');
            return setResult('‚úÖ Fehlerdialog geschlossen.');
          }
          setDebugDetails('Dialog konnte nicht schlie√üen', 'Seite neu laden und Aktion wiederholen.');
          return setResult('‚ö†Ô∏è Dialog konnte nicht geschlossen werden.');
        }
        return false;
      }
      function renderShortcutList(filterValue) {
        if (!shortcutListNode || !shortcutFilterStatusNode) {
          return false;
        }
        const normalized = typeof filterValue === 'string' ? filterValue.trim().toLowerCase() : '';
        const visibleItems = shortcutEntries.filter(function (entry) {
          const rowText = (entry.key + ' ' + entry.title + ' ' + entry.detail).toLowerCase();
          return normalized.length === 0 ? true : rowText.includes(normalized);
        });
        shortcutListNode.innerHTML = '';
        visibleItems.forEach(function (entry) {
          const li = document.createElement('li');
          li.textContent = entry.key + ' ‚Äì ' + entry.title + ': ' + entry.detail;
          shortcutListNode.appendChild(li);
        });
        if (!visibleItems.length) {
          const li = document.createElement('li');
          li.textContent = 'Kein Treffer. N√§chster Schritt: Anderen Suchbegriff testen.';
          shortcutListNode.appendChild(li);
        }
        shortcutFilterStatusNode.textContent = String(visibleItems.length) + ' Eintr√§ge sichtbar.';
        return true;
      }
      function openShortcutOverlay() {
        if (!shortcutOverlay || typeof shortcutOverlay.showModal !== 'function') {
          return setResult('‚ö†Ô∏è Shortcut-√úbersicht nicht verf√ºgbar. Bitte Seite neu laden.');
        }
        renderShortcutList('');
        shortcutOverlay.showModal();
        if (shortcutFilterInput) {
          shortcutFilterInput.value = '';
          shortcutFilterInput.focus();
        }
        return setResult('‚ÑπÔ∏è Shortcut-√úbersicht ge√∂ffnet.');
      }
      function closeShortcutOverlay() {
        if (!shortcutOverlay || !shortcutOverlay.open) {
          return false;
        }
        shortcutOverlay.close();
        return setResult('‚ÑπÔ∏è Shortcut-√úbersicht geschlossen.');
      }
      function applyProjectSwitch() {
        if (!projectSwitchInput || typeof projectSwitchInput.value !== 'string') {
          return setResult('‚ö†Ô∏è Projektwechsel nicht m√∂glich. Bitte Eingabe pr√ºfen.');
        }
        const candidate = projectSwitchInput.value.trim();
        if (!validateProjectPath(candidate)) {
          return setResult('‚ö†Ô∏è Ung√ºltiger Projektpfad. N√§chster Schritt: Absoluten Pfad eingeben und erneut versuchen.');
        }
        persistProjectPath(candidate, 'Steuerleiste');
        if (projectBreadcrumbNode) {
          projectBreadcrumbNode.textContent = 'Projektpfad: ' + candidate;
        }
        return setResult('‚úÖ Projektpfad gewechselt: ' + candidate + '.');
      }
      function normalizeShortcutKey(event) {
        if (!event || typeof event.key !== 'string') {
          return '';
        }
        return event.key.trim().toLowerCase();
      }
      function executeShortcut(event) {
        if (!event) {
          return false;
        }
        if (event.key === 'F1' || event.key === '?') {
          event.preventDefault();
          return openShortcutOverlay();
        }
        if (event.altKey !== true) {
          return false;
        }
        const shortcutMap = {
          s: 'save',
          r: 'retry',
          p: 'repair',
          l: 'log',
          o: 'open-module'
        };
        const shortcutKey = normalizeShortcutKey(event);
        const actionFromShortcut = shortcutMap[shortcutKey];
        if (typeof actionFromShortcut !== 'string') {
          return false;
        }
        event.preventDefault();
        return executeAction(actionFromShortcut);
      }
      if (themeSelector) {
        themeSelector.addEventListener('change', function (event) {
          const value = event.target && typeof event.target.value === 'string' ? event.target.value : '';
          applyTheme(value);
        });
      }
      if (fontScaleSelector) {
        fontScaleSelector.addEventListener('change', function (event) {
          const value = event.target && typeof event.target.value === 'string' ? event.target.value.trim().toLowerCase() : '';
          applyFontScale(value);
        });
      }
      if (backupToggleNode) {
        backupToggleNode.addEventListener('change', function (event) {
          const enabled = Boolean(event.target && event.target.checked);
          if (applyBackupPreference(enabled, 'Bedienfeld')) {
            setResult(enabled ? '‚úÖ Auto-Backup aktiviert.' : '‚ÑπÔ∏è Auto-Backup deaktiviert. Bitte bei √Ñnderungen manuell speichern.');
          }
        });
      }
      if (shortcutFilterInput) {
        shortcutFilterInput.addEventListener('input', function (event) {
          const value = event && event.target && typeof event.target.value === 'string' ? event.target.value : '';
          renderShortcutList(value);
        });
      }
      if (globalSearchInput) {
        globalSearchInput.addEventListener('input', function (event) {
          if (!globalSearchStatusNode) {
            return;
          }
          const value = event && event.target && typeof event.target.value === 'string' ? event.target.value.trim() : '';
          if (!value) {
            globalSearchStatusNode.textContent = 'Suche bereit: Bitte Begriff eingeben.';
            return;
          }
          globalSearchStatusNode.textContent = 'Suche aktiv: "' + value + '". N√§chster Schritt: Passendes Modul √∂ffnen.';
        });
      }
      if (moduleSelector) {
        moduleSelector.addEventListener('change', function (event) {
          const target = event.target;
          const selectedValue = target && typeof target.value === 'string' ? target.value.trim() : '';
          renderModulePreview(selectedValue);
        });
      }
      document.addEventListener('click', function (event) {
        const target = event.target;
        if (!(target instanceof HTMLElement)) {
          return;
        }
        const clickableNode = target.closest('[data-action], [data-module-nav]');
        if (!(clickableNode instanceof HTMLElement)) {
          return;
        }
        const pickedIndex = clickableNode.getAttribute('data-entry-index');
        if (clickableNode.getAttribute('data-action') === 'gms-entry-pick') {
          gmsPlugin.setState((function () {
            const snap = gmsPlugin.getState();
            snap.selectedEntryIndex = Number(pickedIndex);
            return snap;
          })());
        }
        const moduleTarget = clickableNode.getAttribute('data-module-nav');
        if (typeof moduleTarget === 'string' && moduleTarget.length > 0 && moduleSelector) {
          moduleSelector.value = moduleTarget;
          openModule(moduleTarget);
          return;
        }
        const action = clickableNode.getAttribute('data-action');
        if (typeof action !== 'string' || action.length === 0) {
          return;
        }
        executeAction(action);
      });
      document.addEventListener('keydown', function (event) {
        executeShortcut(event);
        keepDialogFocusInside(event);
      });
      document.addEventListener('change', function (event) {
        const target = event.target;
        if (!(target instanceof HTMLElement)) {
          return;
        }
        if (target.id === 'gms-category') {
          gmsPlugin.setState(gmsPlugin.getState());
        }
      });
      document.addEventListener('dragstart', function (event) {
        const target = event.target;
        if (!(target instanceof HTMLElement) || !target.classList.contains('drag-item')) {
          return;
        }
        event.dataTransfer.setData('text/plain', target.getAttribute('data-entry-index') || '-1');
      });
      document.addEventListener('dragover', function (event) {
        const target = event.target;
        if (target instanceof HTMLElement && target.closest('.drag-item')) {
          event.preventDefault();
        }
      });
      document.addEventListener('drop', function (event) {
        const target = event.target;
        if (!(target instanceof HTMLElement)) {
          return;
        }
        const dropItem = target.closest('.drag-item');
        if (!dropItem || !event.dataTransfer) {
          return;
        }
        event.preventDefault();
        const fromIndex = Number(event.dataTransfer.getData('text/plain'));
        const toIndex = Number(dropItem.getAttribute('data-entry-index'));
        const state = gmsPlugin.getState();
        const categoryNode = document.getElementById('gms-category');
        const category = categoryNode ? categoryNode.value : '';
        const profile = state.profiles[state.currentProfile];
        if (!profile || !Array.isArray(profile[category]) || Number.isNaN(fromIndex) || Number.isNaN(toIndex) || fromIndex === toIndex) {
          return;
        }
        const moved = profile[category].splice(fromIndex, 1)[0];
        profile[category].splice(toIndex, 0, moved);
        state.selectedEntryIndex = toIndex;
        gmsPlugin.setState(state);
        setResult('‚úÖ Reihenfolge aktualisiert (Drag&Drop).');
      });
      applyTheme(getThemePreference());
      applyFontScale(readFontScalePreference());
      applyBackupPreference(readBackupPreference(), 'Start');
      if (themeSelector) {
        themeSelector.value = html.getAttribute('data-theme') || 'high-contrast';
      }
      updateProjectStatus(getStoredProjectPath());
      updateFooterContext(getStoredProjectPath());
      if (projectBreadcrumbNode) {
        projectBreadcrumbNode.textContent = 'Projektpfad: ' + getStoredProjectPath();
      }
      if (projectSwitchInput) {
        projectSwitchInput.value = getStoredProjectPath();
      }
      if (projectPathInput) {
        projectPathInput.value = getStoredProjectPath();
      }
      const initialProjectPath = getStoredProjectPath();
      if (projectDialog && typeof projectDialog.showModal === 'function' && !validateProjectPath(initialProjectPath)) {
        projectDialog.showModal();
      }
      gmsPlugin.mount();
      switchActiveModulePanel('');
      setCardState(moduleCardStateNode, 'ready', 'Bereit');
      setCardState(debugCardStateNode, 'ready', 'Bereit');
      setActiveNavigation('dashboard');
      setPluginStatus('dashboard');
      renderModuleSidebarOptions('dashboard', getModuleSourceMeta('dashboard'));
      renderModulePreview('dashboard');
      updateSyncStatus('‚úÖ Alle √Ñnderungen gespeichert (' + getTimeStamp() + ')');
      setCardState(projectCardStateNode, 'ready', 'Bereit');
      setDebugDetails('Startzustand aktiv', 'W√§hlen Sie ein Modul oder √∂ffnen Sie bei Bedarf den Fehlerdialog.');
      appendDebugLog('‚ÑπÔ∏è Startzustand aktiv (' + getTimeStamp() + ').');
    })();
  </script>
</body>
</html>
