<!doctype html>
<html lang="de" data-theme="high-contrast">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Provoware ModulTool Dashboard</title>
  <style>
    :root {
      --bg-start: #020717;
      --bg-end: #061229;
      --bg: #020717;
      --surface: rgba(7, 16, 36, 0.86);
      --surface-strong: rgba(4, 11, 27, 0.95);
      --text: #f3f6ff;
      --muted: #b9c5de;
      --focus: #f8d23f;
      --border: #7fa8ff;
      --shadow: rgba(0, 0, 0, 0.5);
      --accent-a: #ff6a3d;
      --accent-b: #00b5ff;
      --primary: #00b5ff;
      --accent-c: #f4bb31;
      color-scheme: dark;
    }

    html[data-theme="light"] {
      --bg-start: #eaf0ff;
      --bg-end: #f7f8fb;
      --bg: #f7f8fb;
      --surface: rgba(255, 255, 255, 0.95);
      --surface-strong: rgba(247, 249, 255, 0.98);
      --text: #09152d;
      --muted: #324367;
      --focus: #1f4aff;
      --border: #314d93;
      --shadow: rgba(16, 32, 74, 0.18);
      --accent-a: #d14a22;
      --accent-b: #006cc5;
      --primary: #006cc5;
      --accent-c: #a57300;
      color-scheme: light;
    }

    html[data-theme="dark"] {
      --bg-start: #030813;
      --bg-end: #101f3a;
      --bg: #030813;
      --surface: rgba(12, 24, 47, 0.86);
      --surface-strong: rgba(7, 18, 35, 0.95);
      --text: #ecf4ff;
      --muted: #a8b8d8;
      --focus: #ffd64d;
      --border: #6f94ff;
      --shadow: rgba(0, 0, 0, 0.56);
      --accent-a: #ee6a3f;
      --accent-b: #2ec7ff;
      --primary: #2ec7ff;
      --accent-c: #f2b632;
      color-scheme: dark;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Inter", "Segoe UI", Arial, sans-serif;
      color: var(--text);
      background: radial-gradient(circle at top, #0f2a63 0%, transparent 38%), linear-gradient(130deg, var(--bg-start), var(--bg-end));
    }

    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation: none !important;
        transition: none !important;
        scroll-behavior: auto !important;
      }
    }

    .skip-link {
      position: absolute;
      left: -999px;
      top: 0;
      padding: .65rem .9rem;
      border: 2px solid var(--focus);
      background: var(--surface-strong);
      color: var(--text);
      border-radius: 0 0 10px 10px;
      z-index: 30;
    }

    .skip-link:focus {
      left: .7rem;
      top: .5rem;
    }

    .shell {
      width: min(1440px, calc(100% - 1.5rem));
      margin: .9rem auto;
      border-radius: 14px;
      border: 1px solid rgba(127, 168, 255, 0.35);
      background: linear-gradient(180deg, rgba(7, 17, 37, 0.92), rgba(5, 13, 31, 0.95));
      box-shadow: 0 18px 48px var(--shadow);
      overflow: hidden;
      display: grid;
      grid-template-columns: 280px minmax(0, 1fr) 320px;
      grid-template-rows: 64px minmax(0, 1fr) 52px;
      grid-template-areas:
        "top top top"
        "left main right"
        "foot foot foot";
    }

    .topbar {
      grid-area: top;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 1.1rem;
      background: linear-gradient(90deg, rgba(8, 24, 53, 0.9), rgba(8, 14, 30, 0.95));
      border-bottom: 1px solid rgba(127, 168, 255, 0.32);
    }

    .status-pill {
      font-weight: 700;
      color: #a4ffc8;
      border: 1px solid rgba(131, 250, 173, 0.5);
      border-radius: 999px;
      padding: .2rem .7rem;
      background: rgba(8, 53, 25, 0.4);
    }

    .panel {
      padding: 1rem;
      background: var(--surface);
    }

    .left {
      grid-area: left;
      border-right: 1px solid rgba(127, 168, 255, 0.35);
      display: flex;
      flex-direction: column;
      gap: .9rem;
    }

    .right {
      grid-area: right;
      border-left: 1px solid rgba(127, 168, 255, 0.35);
      display: flex;
      flex-direction: column;
      gap: .9rem;
    }

    .main {
      grid-area: main;
      padding: 1rem;
      background: linear-gradient(180deg, rgba(9, 18, 39, 0.78), rgba(6, 14, 31, 0.88));
      display: grid;
      gap: .9rem;
      align-content: start;
    }

    .headline {
      text-align: center;
      font-size: 1.85rem;
      margin: 0;
    }

    .subline {
      margin: 0;
      text-align: center;
      color: var(--muted);
    }

    .nav-list,
    .settings-list {
      list-style: none;
      margin: 0;
      padding: 0;
      display: grid;
      gap: .4rem;
    }

    .nav-item,
    .settings-item,
    .quick-help {
      border-radius: 10px;
      border: 1px solid rgba(127, 168, 255, 0.24);
      background: var(--surface-strong);
      padding: .62rem .72rem;
    }

    .card-grid {
      display: grid;
      gap: .85rem;
      grid-template-columns: repeat(3, minmax(210px, 1fr));
    }

    .tool-card {
      border-radius: 12px;
      border: 2px solid rgba(127, 168, 255, 0.4);
      padding: .8rem;
      background: linear-gradient(160deg, rgba(22, 35, 66, 0.95), rgba(10, 18, 36, 0.92));
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.32);
    }

    .tool-card[data-accent="a"] { border-color: var(--accent-a); }
    .tool-card[data-accent="b"] { border-color: var(--accent-b); }
    .tool-card[data-accent="c"] { border-color: var(--accent-c); }

    h1, h2, h3, p { margin: 0; }
    h2 { font-size: 1.15rem; margin-bottom: .6rem; }
    h3 { font-size: 1.45rem; }

    .actions {
      display: grid;
      gap: .5rem;
      margin-top: .7rem;
    }

    button,
    select {
      min-height: 44px;
      border-radius: 8px;
      border: 2px solid rgba(127, 168, 255, 0.55);
      background: rgba(10, 22, 44, 0.86);
      color: inherit;
      font-size: 1rem;
      padding: .5rem .7rem;
      width: 100%;
    }

    button:hover,
    select:hover { border-color: var(--focus); }

    button:focus-visible,
    select:focus-visible,
    a:focus-visible {
      outline: 3px solid var(--focus);
      outline-offset: 3px;
    }

    .result {
      margin-top: .4rem;
      color: var(--muted);
      min-height: 1.4rem;
    }

    .footer {
      grid-area: foot;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 .9rem;
      border-top: 1px solid rgba(127, 168, 255, 0.32);
      background: rgba(4, 10, 23, 0.95);
      color: var(--muted);
    }

    dialog {
      border: 3px solid var(--accent-a);
      border-radius: 12px;
      width: min(560px, calc(100% - 2rem));
      background: var(--surface-strong);
      color: var(--text);
    }

    dialog::backdrop { background: rgba(0, 0, 0, 0.7); }

    @media (max-width: 1240px) {
      .shell {
        grid-template-columns: 250px minmax(0, 1fr);
        grid-template-areas:
          "top top"
          "left main"
          "right right"
          "foot foot";
        grid-template-rows: 64px auto auto 52px;
      }
      .card-grid { grid-template-columns: repeat(2, minmax(220px, 1fr)); }
    }

    @media (max-width: 860px) {
      .shell {
        grid-template-columns: 1fr;
        grid-template-areas: "top" "left" "main" "right" "foot";
        grid-template-rows: auto;
      }
      .card-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <a href="#bereich-aufgaben" class="skip-link">Direkt zum Arbeitsbereich springen</a>

  <main class="shell" role="main" aria-live="polite">
    <header class="topbar" aria-label="Obere Statusleiste">
      <span>üß© ModulTool</span>
      <h1 class="headline">ModulTool</h1>
      <span class="status-pill" id="sync-status" role="status" aria-live="polite">‚úÖ Alle √Ñnderungen gespeichert</span>
    </header>

    <aside class="panel left" aria-label="Navigation">
      <h2>Navigation</h2>
      <ul class="nav-list">
        <li class="nav-item">üìö Genres</li>
        <li class="nav-item">üßæ Zitate</li>
        <li class="nav-item">üéµ Songeditor</li>
        <li class="nav-item">‚úÖ To-Do-Liste</li>
        <li class="nav-item">üìä Dashboard</li>
      </ul>
      <p class="quick-help" id="shortcut-help">Tastatur-K√ºrzel (Keyboard Shortcut = Schnellbefehl): Alt+S Speichern, Alt+R Erneut versuchen, Alt+P Reparatur, Alt+L Protokoll.</p>
    </aside>

    <section class="main" aria-labelledby="bereich-aufgaben">
      <p class="subline">Genrearchiv ‚Äì alle √Ñnderungen gespeichert</p>
      <h2 id="bereich-aufgaben">Werkzeug-√úbersicht</h2>
      <div class="card-grid">
        <article class="tool-card" data-accent="a">
          <h2>Genreverwaltung</h2>
          <div class="actions">
            <button type="button" data-action="save" aria-keyshortcuts="Alt+S" aria-describedby="shortcut-help">Genre speichern</button>
            <button type="button" data-action="retry" aria-keyshortcuts="Alt+R" aria-describedby="shortcut-help">Hinzuf√ºgen</button>
          </div>
        </article>

        <article class="tool-card" data-accent="b">
          <h2>Archiv</h2>
          <div class="actions">
            <button type="button" data-action="save" aria-keyshortcuts="Alt+S" aria-describedby="shortcut-help">Beispiel speichern</button>
            <button type="button" data-action="retry" aria-keyshortcuts="Alt+R" aria-describedby="shortcut-help">Bearbeiten</button>
          </div>
        </article>

        <article class="tool-card" data-accent="c">
          <h2>Dashboard</h2>
          <div class="actions">
            <button type="button" data-action="log" aria-keyshortcuts="Alt+L" aria-describedby="shortcut-help">√úbersicht anzeigen</button>
          </div>
        </article>

        <article class="tool-card" data-accent="b">
          <h2>Zufallsgenerator</h2>
          <div class="actions">
            <button type="button" data-action="retry" aria-keyshortcuts="Alt+R" aria-describedby="shortcut-help">Genre zuf√§llig w√§hlen</button>
            <button type="button" data-action="save" aria-keyshortcuts="Alt+S" aria-describedby="shortcut-help">Speichern</button>
          </div>
        </article>

        <article class="tool-card" data-accent="a">
          <h2>Text-Templates</h2>
          <div class="actions">
            <button type="button" data-action="repair" aria-keyshortcuts="Alt+P" aria-describedby="shortcut-help">Vorlage laden</button>
            <button type="button" data-action="save" aria-keyshortcuts="Alt+S" aria-describedby="shortcut-help">Einf√ºgen</button>
          </div>
        </article>

        <article class="tool-card" data-accent="b">
          <h2>Debug-Log</h2>
          <p class="result" id="result" role="status" aria-live="polite">Keine Fehler.</p>
          <p class="subline" id="debug-last-event" data-debug-event>Letztes Ereignis: Startzustand um --:--:--.</p>
          <p class="subline" id="debug-next-step" data-debug-next-step>N√§chster Schritt: Aktion w√§hlen oder Alt+L f√ºr Protokoll nutzen.</p>
          <div class="actions">
            <button type="button" data-action="error">Beispiel-Fehler anzeigen</button>
          </div>
        </article>
      </div>

      <section class="tool-card" data-accent="a" aria-labelledby="bereich-hilfe" id="hilfe-next-steps">
        <h2 id="bereich-hilfe">Schnellhilfe mit Next Steps</h2>
        <ol>
          <li>Neu starten: <code>./start.sh</code></li>
          <li>Auto-Reparatur: <code>./start.sh --repair</code></li>
          <li>Protokoll lesen: <code>cat logs/status_summary.txt</code></li>
        </ol>
        <p class="result">Fehlerdialog zeigt immer klare Schritte: ‚ÄûErneut versuchen‚Äú, ‚ÄûReparatur‚Äú, ‚ÄûProtokoll‚Äú.</p>
      </section>
    </section>

    <aside class="panel right" aria-label="Einstellungen und Hilfe">
      <h2>Einstellungen</h2>
      <ul class="settings-list">
        <li class="settings-item">
          <label for="theme-switcher"><strong>Design:</strong></label>
          <select id="theme-switcher" data-theme-switcher aria-describedby="theme-help">
            <option value="high-contrast">High Contrast (hoher Kontrast)</option>
            <option value="light">Light (hell)</option>
            <option value="dark">Dark (dunkel)</option>
          </select>
        </li>
        <li class="settings-item">
          <p id="theme-help">Hinweis: Status nie nur √ºber Farbe, sondern immer mit Symbol + Text. Kontrast (Helligkeits-Unterschied) bleibt in allen drei Themes gut lesbar. Daten sparen: Wenn Ihr Ger√§t reduzierte Bewegung nutzt, werden Animationen automatisch deaktiviert.</p>
          <p class="subline" id="theme-status" role="status" aria-live="polite">Aktives Theme: high-contrast. Empfohlen f√ºr maximalen Kontrast.</p>
        </li>
        <li class="settings-item">Nutzerstatistik: 0 aktive Fehler, letzte Pr√ºfung erfolgreich.</li>
      </ul>
    </aside>

    <footer class="footer">
      <span>Version 13.0 ‚Äì Pfad: /home</span>
      <span>Auto-Backup: Aktiv</span>
      <span id="footer-sync-status">Alle √Ñnderungen gespeichert</span>
    </footer>
  </main>

  <dialog id="error-dialog" aria-labelledby="error-title" aria-describedby="error-text" aria-modal="true">
    <h2 id="error-title">‚ùå Fehler erkannt</h2>
    <p id="error-text">Die Aktion konnte nicht abgeschlossen werden. Bitte folgen Sie den n√§chsten Schritten.</p>
    <ul>
      <li>Erneut versuchen</li>
      <li>Reparatur ausf√ºhren mit <code>./start.sh --repair</code></li>
      <li>Protokoll √∂ffnen mit <code>cat logs/start.log</code></li>
    </ul>
    <div class="actions">
      <button type="button" data-action="retry">Erneut versuchen</button>
      <button type="button" data-action="repair">Reparatur</button>
      <button type="button" data-action="log">Protokoll √∂ffnen</button>
      <button type="button" data-action="close-dialog">Dialog schlie√üen</button>
    </div>
  </dialog>

  <script>
    (function () {
      const html = document.documentElement;
      const resultNode = document.getElementById('result');
      const dialog = document.getElementById('error-dialog');
      const themeSelector = document.getElementById('theme-switcher');
      const syncStatusNode = document.getElementById('sync-status');
      const footerSyncStatusNode = document.getElementById('footer-sync-status');
      const debugEventNode = document.getElementById('debug-last-event');
      const debugNextStepNode = document.getElementById('debug-next-step');
      const themeStatusNode = document.getElementById('theme-status');
      let lastDialogTrigger = null;

      function getDialogFocusableElements() {
        if (!dialog) {
          return [];
        }
        return Array.from(dialog.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'));
      }

      function restoreFocusAfterDialog() {
        if (!lastDialogTrigger || typeof lastDialogTrigger.focus !== 'function') {
          return false;
        }
        lastDialogTrigger.focus();
        return true;
      }

      function keepDialogFocusInside(event) {
        if (!dialog || !dialog.open || !event || event.key !== 'Tab') {
          return false;
        }
        const focusable = getDialogFocusableElements();
        if (!focusable.length) {
          return false;
        }
        const first = focusable[0];
        const last = focusable[focusable.length - 1];
        const active = document.activeElement;

        if (event.shiftKey && active === first) {
          event.preventDefault();
          last.focus();
          return true;
        }
        if (!event.shiftKey && active === last) {
          event.preventDefault();
          first.focus();
          return true;
        }
        return false;
      }

      function setResult(message) {
        if (!resultNode || typeof message !== 'string' || message.trim().length === 0) {
          return false;
        }
        resultNode.textContent = message;
        return true;
      }

      function getTimeStamp() {
        return new Date().toLocaleTimeString('de-DE');
      }

      function updateSyncStatus(statusText) {
        if (typeof statusText !== 'string' || statusText.trim().length === 0) {
          return false;
        }
        const fullText = statusText.trim();
        if (syncStatusNode) {
          syncStatusNode.textContent = fullText;
        }
        if (footerSyncStatusNode) {
          footerSyncStatusNode.textContent = fullText.replace(/^‚úÖ\s*/, '');
        }
        return true;
      }

      function setDebugDetails(eventLabel, nextStep) {
        if (typeof eventLabel !== 'string' || eventLabel.trim().length === 0) {
          return false;
        }
        if (typeof nextStep !== 'string' || nextStep.trim().length === 0) {
          return false;
        }
        if (debugEventNode) {
          debugEventNode.textContent = 'Letztes Ereignis: ' + eventLabel.trim() + ' um ' + getTimeStamp() + '.';
        }
        if (debugNextStepNode) {
          debugNextStepNode.textContent = 'N√§chster Schritt: ' + nextStep.trim();
        }
        return true;
      }

      function applyTheme(themeValue) {
        const allowed = ['high-contrast', 'light', 'dark'];
        if (typeof themeValue !== 'string' || !allowed.includes(themeValue)) {
          setResult('‚ö†Ô∏è Ung√ºltiges Theme. Erlaubt sind: high-contrast, light, dark.');
          return false;
        }

        const helperTextByTheme = {
          'high-contrast': 'Aktives Theme: high-contrast. Empfohlen f√ºr maximalen Kontrast.',
          light: 'Aktives Theme: light. Bitte Fokusrahmen gut sichtbar pr√ºfen.',
          dark: 'Aktives Theme: dark. Bitte Helligkeit und Lesbarkeit kurz pr√ºfen.'
        };

        html.setAttribute('data-theme', themeValue);
        if (themeStatusNode) {
          themeStatusNode.textContent = helperTextByTheme[themeValue] || 'Aktives Theme ge√§ndert.';
        }
        setDebugDetails('Theme ge√§ndert', 'Pr√ºfen Sie kurz Lesbarkeit, Fokusrahmen und Symboltexte im gew√§hlten Theme.');
        setResult('‚úÖ Theme wurde gesetzt: ' + themeValue + '.');
        return true;
      }

      function executeAction(actionValue) {
        const known = ['save', 'retry', 'repair', 'log', 'error', 'close-dialog'];
        if (typeof actionValue !== 'string' || !known.includes(actionValue)) {
          return setResult('‚ö†Ô∏è Unbekannte Aktion. Bitte pr√ºfen Sie den Button.');
        }

        if (actionValue === 'save') {
          const message = '‚úÖ Gespeichert um ' + getTimeStamp() + '.';
          updateSyncStatus('‚úÖ Alle √Ñnderungen gespeichert (' + getTimeStamp() + ')');
          setDebugDetails('Speichern abgeschlossen', 'Sie k√∂nnen jetzt sicher weiterarbeiten oder mit Alt+L das Protokoll √∂ffnen.');
          return setResult(message);
        }
        if (actionValue === 'retry') {
          updateSyncStatus('‚úÖ Aktion erneut bereit (' + getTimeStamp() + ')');
          setDebugDetails('Erneut versuchen vorbereitet', 'F√ºhren Sie die gew√ºnschte Aktion jetzt erneut aus.');
          return setResult('‚û°Ô∏è Erneut versuchen wurde vorbereitet. Aktion jetzt wiederholen.');
        }
        if (actionValue === 'repair') {
          setDebugDetails('Reparatur empfohlen', 'F√ºhren Sie ./start.sh --repair aus und pr√ºfen Sie danach den Statusbericht.');
          return setResult('‚û°Ô∏è Reparaturhinweis: Starten Sie ./start.sh --repair');
        }
        if (actionValue === 'log') {
          setDebugDetails('Protokollhilfe ge√∂ffnet', '√ñffnen Sie logs/start.log und suchen Sie nach der letzten ‚ùå-Meldung.');
          return setResult('‚û°Ô∏è Protokollhinweis: √ñffnen Sie logs/start.log');
        }

        if (actionValue === 'error') {
          if (dialog && typeof dialog.showModal === 'function') {
            lastDialogTrigger = document.activeElement instanceof HTMLElement ? document.activeElement : null;
            dialog.showModal();
            const firstDialogButton = getDialogFocusableElements()[0];
            if (firstDialogButton && typeof firstDialogButton.focus === 'function') {
              firstDialogButton.focus();
            }
            setDebugDetails('Fehlerdialog ge√∂ffnet', 'W√§hlen Sie im Dialog zuerst ‚ÄûErneut versuchen‚Äú und pr√ºfen Sie danach das Protokoll.');
            return setResult('‚ùå Fehlerdialog ge√∂ffnet. Bitte n√§chsten Schritt w√§hlen.');
          }
          setDebugDetails('Fehlerdialog fehlgeschlagen', 'Browser aktualisieren und Aktion erneut ausf√ºhren.');
          return setResult('‚ö†Ô∏è Fehlerdialog konnte nicht ge√∂ffnet werden. Browser pr√ºfen.');
        }

        if (actionValue === 'close-dialog') {
          if (dialog && typeof dialog.close === 'function') {
            dialog.close();
            restoreFocusAfterDialog();
            setDebugDetails('Fehlerdialog geschlossen', 'Sie k√∂nnen jetzt ohne Dialog weiterarbeiten.');
            return setResult('‚úÖ Fehlerdialog geschlossen.');
          }
          setDebugDetails('Dialog konnte nicht schlie√üen', 'Seite neu laden und Aktion wiederholen.');
          return setResult('‚ö†Ô∏è Dialog konnte nicht geschlossen werden.');
        }

        return false;
      }

      function normalizeShortcutKey(event) {
        if (!event || typeof event.key !== 'string') {
          return '';
        }
        return event.key.trim().toLowerCase();
      }

      function executeShortcut(event) {
        if (!event || event.altKey !== true) {
          return false;
        }

        const shortcutMap = {
          s: 'save',
          r: 'retry',
          p: 'repair',
          l: 'log'
        };
        const shortcutKey = normalizeShortcutKey(event);
        const actionFromShortcut = shortcutMap[shortcutKey];
        if (typeof actionFromShortcut !== 'string') {
          return false;
        }

        event.preventDefault();
        return executeAction(actionFromShortcut);
      }

      if (themeSelector) {
        themeSelector.addEventListener('change', function (event) {
          const value = event.target && typeof event.target.value === 'string' ? event.target.value : '';
          applyTheme(value);
        });
      }

      document.addEventListener('click', function (event) {
        const target = event.target;
        if (!(target instanceof HTMLElement)) {
          return;
        }
        const action = target.getAttribute('data-action');
        if (typeof action !== 'string' || action.length === 0) {
          return;
        }
        executeAction(action);
      });

      document.addEventListener('keydown', function (event) {
        executeShortcut(event);
        keepDialogFocusInside(event);
      });

      applyTheme('high-contrast');
      updateSyncStatus('‚úÖ Alle √Ñnderungen gespeichert (' + getTimeStamp() + ')');
      setDebugDetails('Startzustand aktiv', 'W√§hlen Sie eine Aktion oder √∂ffnen Sie bei Bedarf den Fehlerdialog.');
    })();
  </script>
</body>
</html>
