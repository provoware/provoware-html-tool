<!doctype html>
<html lang="de" data-theme="high-contrast">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Provoware ModulTool Dashboard</title>
  <style>
    :root {
      --bg-glow: #284b9a;
      --bg-start: #020717;
      --bg-end: #061229;
      --bg: #020717;
      --surface: rgba(7, 16, 36, 0.86);
      --surface-strong: rgba(4, 11, 27, 0.95);
      --text: #f3f6ff;
      --muted: #b9c5de;
      --focus: #f8d23f;
      --border: #7fa8ff;
      --shadow: rgba(0, 0, 0, 0.5);
      --accent-a: #ff7a52;
      --accent-b: #47c2ff;
      --primary: #47c2ff;
      --accent-c: #ffd061;
      --module-font-size: clamp(1rem, 0.2vw + .98rem, 1.08rem);
      --module-button-min-height: 48px;
      color-scheme: dark;
    }
    html[data-theme="balanced"] {
      --bg-glow: #1d4287;
      --bg-start: #081022;
      --bg-end: #162746;
      --bg: #081022;
      --surface: rgba(11, 23, 46, 0.9);
      --surface-strong: rgba(8, 18, 36, 0.96);
      --text: #f3f7ff;
      --muted: #b8c6e6;
      --focus: #ffd95a;
      --border: #79a1f7;
      --shadow: rgba(0, 0, 0, 0.48);
      --accent-a: #ff845d;
      --accent-b: #4ec8ff;
      --primary: #4ec8ff;
      --accent-c: #ffd26d;
      color-scheme: dark;
    }
    html[data-theme="high-contrast"] {
      --bg-glow: #0037a8;
      --bg-start: #000000;
      --bg-end: #0c1224;
      --bg: #000000;
      --surface: rgba(0, 0, 0, 0.96);
      --surface-strong: rgba(8, 8, 8, 0.99);
      --text: #ffffff;
      --muted: #dbe8ff;
      --focus: #ffe600;
      --border: #8bc2ff;
      --shadow: rgba(0, 0, 0, 0.7);
      --accent-a: #ff9966;
      --accent-b: #6de1ff;
      --primary: #6de1ff;
      --accent-c: #ffe47a;
      color-scheme: dark;
    }
    html[data-theme="light"] {
      --bg-start: #eaf0ff;
      --bg-end: #f7f8fb;
      --bg: #f7f8fb;
      --surface: rgba(255, 255, 255, 0.95);
      --surface-strong: rgba(247, 249, 255, 0.98);
      --text: #09152d;
      --muted: #324367;
      --focus: #1f4aff;
      --border: #314d93;
      --shadow: rgba(16, 32, 74, 0.18);
      --accent-a: #d14a22;
      --accent-b: #006cc5;
      --primary: #006cc5;
      --accent-c: #a57300;
      color-scheme: light;
    }
    html[data-theme="dark"] {
      --bg-start: #030813;
      --bg-end: #101f3a;
      --bg: #030813;
      --surface: rgba(12, 24, 47, 0.86);
      --surface-strong: rgba(7, 18, 35, 0.95);
      --text: #ecf4ff;
      --muted: #a8b8d8;
      --focus: #ffd64d;
      --border: #6f94ff;
      --shadow: rgba(0, 0, 0, 0.56);
      --accent-a: #ee6a3f;
      --accent-b: #2ec7ff;
      --primary: #2ec7ff;
      --accent-c: #f2b632;
      color-scheme: dark;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Inter", "Segoe UI", Arial, sans-serif;
      color: var(--text);
      background: radial-gradient(circle at top, var(--bg-glow) 0%, transparent 38%), linear-gradient(130deg, var(--bg-start), var(--bg-end));
    }
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation: none !important;
        transition: none !important;
        scroll-behavior: auto !important;
      }
    }
    .skip-link {
      position: absolute;
      left: -999px;
      top: 0;
      padding: .65rem .9rem;
      border: 2px solid var(--focus);
      background: var(--surface-strong);
      color: var(--text);
      border-radius: 0 0 10px 10px;
      z-index: 30;
    }
    .skip-link:focus {
      left: .7rem;
      top: .5rem;
    }
    .shell {
      width: min(1680px, calc(100% - 1rem));
      margin: max(.9rem, env(safe-area-inset-top)) auto .9rem;
      border-radius: 14px;
      border: 1px solid rgba(127, 168, 255, 0.35);
      background: linear-gradient(180deg, rgba(7, 17, 37, 0.92), rgba(5, 13, 31, 0.95));
      box-shadow: 0 18px 48px var(--shadow);
      overflow: hidden;
      display: grid;
      grid-template-columns: minmax(220px, 16vw) minmax(0, 1fr) minmax(240px, 18vw);
      grid-template-rows: auto minmax(0, 1fr) 52px;
      grid-template-areas:
        "top top top"
        "left main right"
        "foot foot foot";
    }
    .topbar {
      grid-area: top;
      position: sticky;
      top: 0;
      z-index: 20;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 .75rem;
      background: linear-gradient(90deg, rgba(8, 24, 53, 0.9), rgba(8, 14, 30, 0.95));
      border-bottom: 1px solid rgba(127, 168, 255, 0.32);
      gap: .6rem;
      flex-wrap: wrap;
      min-height: 52px;
    }
    .topbar-log {
      min-width: 280px;
      flex: 1;
      border: 1px solid rgba(127, 168, 255, 0.35);
      border-radius: 10px;
      padding: .45rem .6rem;
      background: rgba(4, 10, 23, 0.7);
    }
    .topbar-log ol {
      margin: .35rem 0 0;
      padding-left: 1.1rem;
      max-height: 72px;
      overflow: auto;
      color: var(--muted);
    }
    .topbar-controls {
      display: grid;
      grid-template-columns: repeat(3, minmax(140px, 1fr));
      gap: .35rem;
      min-width: 360px;
    }
    .recent-projects {
      min-width: 260px;
      max-width: 360px;
      border: 1px solid rgba(127, 168, 255, 0.35);
      border-radius: 10px;
      padding: .45rem .6rem;
      background: rgba(4, 10, 23, 0.7);
    }
    .recent-projects-list {
      margin: .35rem 0 0;
      padding: 0;
      list-style: none;
      display: grid;
      gap: .25rem;
    }
    .recent-projects-button {
      width: 100%;
      text-align: left;
      min-height: 40px;
      border-radius: 8px;
      border: 1px solid rgba(127, 168, 255, 0.32);
      background: rgba(8, 22, 47, 0.82);
      color: var(--text);
      padding: .35rem .5rem;
      font-size: .9rem;
      overflow-wrap: anywhere;
    }
    .status-pill {
      font-weight: 700;
      color: #a4ffc8;
      border: 1px solid rgba(131, 250, 173, 0.5);
      border-radius: 999px;
      padding: .2rem .7rem;
      background: rgba(8, 53, 25, 0.4);
    }
    .panel {
      padding: 1rem;
      background: var(--surface);
    }
    .left {
      grid-area: left;
      border-right: 1px solid rgba(127, 168, 255, 0.35);
      display: flex;
      flex-direction: column;
      gap: .9rem;
    }
    .right {
      grid-area: right;
      border-left: 1px solid rgba(127, 168, 255, 0.35);
      display: flex;
      flex-direction: column;
      gap: .9rem;
    }
    .main {
      grid-area: main;
      padding: 1rem;
      background: linear-gradient(180deg, rgba(9, 18, 39, 0.78), rgba(6, 14, 31, 0.88));
      display: grid;
      gap: .9rem;
      align-content: start;
    }
    .headline {
      text-align: center;
      font-size: 1.85rem;
      margin: 0;
    }
    .subline {
      margin: 0;
      text-align: center;
      color: var(--muted);
    }
    .nav-list,
    .settings-list {
      list-style: none;
      margin: 0;
      padding: 0;
      display: grid;
      gap: .4rem;
    }
    .nav-item,
    .settings-item,
    .quick-help {
      border-radius: 10px;
      border: 1px solid rgba(127, 168, 255, 0.24);
      background: var(--surface-strong);
      padding: .62rem .72rem;
    }
    .nav-group-title {
      margin-top: .5rem;
      font-size: .95rem;
      color: var(--muted);
    }
    .nav-button {
      min-height: 44px;
      border-radius: 8px;
      border: 1px solid rgba(127, 168, 255, 0.42);
      background: rgba(10, 20, 43, 0.76);
      color: inherit;
      text-align: left;
      padding: .45rem .6rem;
      width: 100%;
      font-size: .97rem;
    }
    .nav-button[aria-current="page"] {
      border-color: var(--focus);
      box-shadow: inset 0 0 0 1px var(--focus);
      font-weight: 700;
    }
    .module-toggle-button {
      text-align: left;
      min-height: 42px;
    }
    .module-toggle-button[data-enabled="true"] {
      border-color: #8bf2ac;
      background: rgba(13, 50, 26, 0.88);
      color: #d9ffe7;
    }
    .module-toggle-button[data-enabled="false"] {
      border-color: #ffb487;
      background: rgba(56, 24, 14, 0.88);
      color: #ffe8da;
    }
    .card-grid {
      display: grid;
      gap: .85rem;
      grid-template-columns: repeat(3, minmax(210px, 1fr));
    }
    .module-empty {
      min-height: 160px;
      display: grid;
      place-items: center;
      border: 2px dashed rgba(127, 168, 255, 0.45);
      border-radius: 10px;
      color: var(--muted);
      text-align: center;
      padding: .75rem;
    }
    .module-panel { display: none; }
    .module-panel.active { display: block; }
    .main-grid {
      display: grid;
      grid-template-columns: repeat(var(--grid-cols, 3), minmax(0, 1fr));
      grid-template-rows: repeat(var(--grid-rows, 3), minmax(0, 1fr));
      grid-auto-rows: minmax(0, 1fr);
      gap: .6rem;
      margin-bottom: .6rem;
      min-height: clamp(540px, 66vh, 760px);
    }
    .quick-archive-grid {
      display: grid;
      gap: .6rem;
      grid-template-columns: minmax(180px, 220px) 1fr;
      margin-top: .6rem;
    }
    .quick-archive-masks {
      border: 1px solid rgba(127, 168, 255, 0.3);
      border-radius: 10px;
      padding: .5rem;
      display: grid;
      gap: .35rem;
      max-height: 300px;
      overflow: auto;
      background: rgba(8, 22, 47, 0.64);
    }
    .quick-archive-entry {
      border: 1px solid rgba(127, 168, 255, 0.3);
      border-radius: 10px;
      padding: .6rem;
      background: rgba(8, 22, 47, 0.75);
      display: grid;
      gap: .45rem;
    }
    .quick-archive-history {
      margin: 0;
      padding-left: 1.1rem;
      max-height: 220px;
      overflow: auto;
      color: var(--muted);
    }
    .main-grid[data-maximized="true"] {
      grid-template-columns: 1fr;
      grid-template-rows: minmax(680px, 1fr);
    }
    .main-grid-cell {
      min-height: 0;
      border: 2px dashed rgba(127, 168, 255, 0.5);
      border-radius: 10px;
      display: grid;
      align-items: stretch;
      text-align: center;
      color: var(--muted);
      background: rgba(10, 18, 34, 0.45);
      padding: .35rem;
      overflow: auto;
    }
    .main-grid-cell.is-maximized-slot {
      grid-column: 1 / -1;
      grid-row: 1 / -1;
      min-height: 680px;
    }
    .main-grid-cell.is-hidden-slot {
      display: none;
    }
    .grid-slot-label {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100%;
    }
    .module-window-actions {
      display: grid;
      grid-template-columns: repeat(3, 42px);
      justify-content: end;
      gap: .4rem;
      margin-bottom: .6rem;
    }
    .module-window-actions button { min-height: 42px; padding: .2rem; }
    .module-panel.active { display: block; height: 100%; }
    .main-grid-cell .tool-card { height: 100%; min-height: 100%; }
    .module-panel { font-size: var(--module-font-size); }
    .module-panel button,
    .module-panel select,
    .module-panel input { min-height: var(--module-button-min-height); font-size: 1rem; }
    .control-bar {
      display: grid;
      grid-template-columns: minmax(220px, 1fr) minmax(180px, 1fr) 220px;
      gap: .5rem;
      align-items: end;
      padding: .65rem;
      border: 1px solid rgba(127, 168, 255, 0.4);
      border-radius: 10px;
      background: rgba(9, 20, 41, 0.8);
      margin-bottom: .6rem;
    }
    .control-bar label { display: grid; gap: .25rem; font-weight: 700; }
    .breadcrumb { display: inline-flex; align-items: center; gap: .35rem; color: var(--muted); font-size: .9rem; margin-bottom: .2rem; }
    .inspector-grid { display: grid; gap: .5rem; margin-top: .55rem; }
    .quick-overlay { border: 2px solid var(--focus); border-radius: 12px; width: min(640px, calc(100% - 1.5rem)); }
    .shortcut-list { list-style: none; padding: 0; margin: .55rem 0 0; display: grid; gap: .35rem; max-height: 270px; overflow: auto; }
    .shortcut-list li { border: 1px solid rgba(127, 168, 255, 0.35); border-radius: 8px; padding: .45rem .55rem; background: rgba(9, 20, 41, 0.72); }
    .tool-card {
      border-radius: 12px;
      border: 2px solid rgba(127, 168, 255, 0.4);
      padding: .8rem;
      background: linear-gradient(160deg, rgba(20, 33, 63, 0.94), rgba(10, 19, 36, 0.94));
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.32);
    }
    .tool-card-primary {
      border-width: 3px;
      box-shadow: 0 12px 20px rgba(0, 0, 0, 0.38);
    }
    .tool-card-secondary {
      border-style: solid;
    }
    .tool-card-utility {
      border-style: dashed;
    }
    .card-tag {
      display: inline-block;
      margin-bottom: .35rem;
      padding: .1rem .45rem;
      border-radius: 999px;
      border: 1px solid rgba(127, 168, 255, 0.55);
      color: var(--muted);
      font-size: .82rem;
    }
    .card-state {
      display: inline-flex;
      align-items: center;
      gap: .35rem;
      margin-top: .4rem;
      padding: .1rem .5rem;
      border-radius: 999px;
      border: 1px solid rgba(127, 168, 255, 0.55);
      font-size: .85rem;
      color: var(--muted);
      background: rgba(10, 21, 44, 0.72);
    }
    .card-state[data-state="ready"] { border-color: #8bf2ac; color: #8bf2ac; }
    .card-state[data-state="loading"] { border-color: #ffd26d; color: #ffd26d; }
    .card-state[data-state="error"] { border-color: #ffb487; color: #ffb487; }
    .plugin-status-list {
      margin: .4rem 0 0;
      padding: 0;
      list-style: none;
      display: grid;
      gap: .35rem;
    }
    .plugin-status-item {
      display: flex;
      justify-content: space-between;
      gap: .5rem;
      align-items: center;
      border: 1px solid rgba(127, 168, 255, 0.3);
      border-radius: 8px;
      padding: .4rem .55rem;
      background: rgba(10, 21, 44, 0.72);
    }
    .plugin-pill {
      border-radius: 999px;
      border: 1px solid rgba(127, 168, 255, 0.4);
      font-size: .8rem;
      padding: .1rem .45rem;
    }
    .plugin-pill-online {
      border-color: #8bf2ac;
      color: #8bf2ac;
    }
    .plugin-pill-offline {
      border-color: #ffb487;
      color: #ffb487;
    }
    .module-option-list {
      margin: .45rem 0 0;
      padding-left: 1.1rem;
      color: var(--muted);
      display: grid;
      gap: .3rem;
    }
    .drag-list {
      list-style: none;
      margin: .4rem 0;
      padding: 0;
      display: grid;
      gap: .35rem;
    }
    .drag-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: .5rem;
      border: 1px solid rgba(127, 168, 255, 0.35);
      border-radius: 8px;
      padding: .35rem .55rem;
      background: rgba(10, 21, 44, 0.72);
      cursor: move;
    }
    .drag-item[aria-selected="true"] {
      border-color: var(--focus);
      box-shadow: inset 0 0 0 1px var(--focus);
    }
    .drag-item button {
      min-height: 36px;
      width: auto;
      padding: .2rem .45rem;
    }
    .tool-card[data-accent="a"] { border-color: var(--accent-a); }
    .tool-card[data-accent="b"] { border-color: var(--accent-b); }
    .tool-card[data-accent="c"] { border-color: var(--accent-c); }
    h1, h2, h3, p { margin: 0; }
    h2 { font-size: 1.15rem; margin-bottom: .6rem; }
    h3 { font-size: 1.45rem; }
    .debug-log-list,
    #debug-log-list {
      margin: .6rem 0 0;
      padding-left: 1.1rem;
      color: var(--muted);
      min-height: 3.2rem;
    }
    .actions {
      display: grid;
      gap: .5rem;
      margin-top: .7rem;
    }
    button,
    select,
    input {
      min-height: 44px;
      border-radius: 8px;
      border: 2px solid rgba(127, 168, 255, 0.55);
      background: rgba(10, 22, 44, 0.86);
      color: inherit;
      font-size: 1rem;
      padding: .5rem .7rem;
      width: 100%;
    }
    button:hover,
    select:hover,
    input:hover { border-color: var(--focus); }
    button:focus-visible,
    select:focus-visible,
    input:focus-visible,
    a:focus-visible {
      outline: 3px solid var(--focus);
      outline-offset: 3px;
    }
    .result {
      margin-top: .4rem;
      color: var(--muted);
      min-height: 1.4rem;
    }
    .footer {
      grid-area: foot;
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      align-items: center;
      gap: .6rem;
      padding: .45rem .9rem;
      border-top: 1px solid rgba(127, 168, 255, 0.32);
      background: rgba(4, 10, 23, 0.95);
      color: var(--muted);
    }
    .footer-column {
      display: grid;
      gap: .25rem;
      min-height: 100%;
      align-content: center;
    }
    .footer-column strong {
      color: var(--text);
      font-size: .9rem;
    }
    .footer-actions {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: .3rem;
    }
    .footer-actions button {
      min-height: 40px;
      font-size: .9rem;
      padding: .35rem;
    }
    dialog {
      border: 3px solid var(--accent-a);
      border-radius: 12px;
      width: min(560px, calc(100% - 2rem));
      background: var(--surface-strong);
      color: var(--text);
    }
    dialog::backdrop { background: rgba(0, 0, 0, 0.7); }
    @media (max-width: 1240px) {
      .shell {
        grid-template-columns: 250px minmax(0, 1fr);
        grid-template-areas:
          "top top"
          "left main"
          "right right"
          "foot foot";
        grid-template-rows: 64px auto auto 52px;
      }
      .card-grid { grid-template-columns: repeat(2, minmax(220px, 1fr)); }
      .main-grid { grid-template-columns: repeat(3, minmax(100px, 1fr)); }
    }
    @media (max-width: 860px) {
      .shell {
        grid-template-columns: 1fr;
        grid-template-areas: "top" "left" "main" "right" "foot";
        grid-template-rows: auto;
      }
      .card-grid { grid-template-columns: 1fr; }
      .main-grid,
      .window-actions,
      .control-bar,
      .topbar-controls {
        grid-template-columns: 1fr;
      }
    }
    @media (max-width: 420px) {
      body {
        font-size: 0.96rem;
      }
      .shell {
        width: calc(100% - .7rem);
        margin: .35rem auto;
        border-radius: 10px;
      }
      .topbar,
      .panel,
      .main,
      .footer {
        padding-left: .7rem;
        padding-right: .7rem;
      }
      .topbar {
        gap: .45rem;
        flex-wrap: wrap;
        justify-content: center;
      }
      .headline {
        width: 100%;
        font-size: 1.45rem;
      }
      .status-pill {
        width: 100%;
        text-align: center;
      }
      .tool-card,
      .settings-item,
      .quick-help {
        padding: .7rem;
      }
      h2 {
        font-size: 1.04rem;
      }
      button,
      select,
      .nav-button {
        min-height: 46px;
        font-size: .96rem;
      }
      .footer {
        grid-template-columns: 1fr;
        gap: .5rem;
        min-height: 80px;
        padding-top: .45rem;
        padding-bottom: .45rem;
      }
      .footer-actions {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <a href="#bereich-aufgaben" class="skip-link">Direkt zum Arbeitsbereich springen</a>
  <main class="shell" role="main" aria-live="polite">
    <header class="topbar" aria-label="Obere Statusleiste">
      <span>üß© Provoware -Modul-Tool-2026</span>
      <h1 class="headline">Dashboard ¬∑ Provoware -Modul-Tool-2026 <small id="dashboard-version">v2026.02.23</small></h1>
      <span class="status-pill" id="sync-status" role="status" aria-live="polite">‚úÖ Alle √Ñnderungen gespeichert</span>
      <section class="topbar-log" aria-label="Echtzeit-Protokollkopf">
        <strong>Live-Protokoll (letzte 10 Ereignisse)</strong>
        <ol id="topbar-log-list"></ol>
      </section>
      <div class="topbar-controls">
        <button type="button" data-action="copy-log">Gesamtes Protokoll kopieren</button>
        <button type="button" data-action="project-setup" aria-describedby="project-switch-help">Projekt wechseln</button>
        <button type="button" data-action="export-all-data">Gesamt-Daten-Export</button>
        <button type="button" id="mode-switch" data-action="switch-mode" aria-pressed="false">Modus: Laie</button>
      </div>
      <section class="recent-projects" aria-label="Zuletzt genutzte Projekte">
        <strong>Zuletzt genutzt (maximal 5)</strong>
        <p class="subline" id="recent-project-help">Hilfe: Mit Enter auf einen Eintrag dr√ºcken, um den Projektpfad direkt zu wechseln.</p>
        <ul class="recent-projects-list" id="recent-project-list"></ul>
        <p class="subline" id="recent-project-status" role="status" aria-live="polite">Noch kein letzter Projektpfad gespeichert.</p>
      </section>
    </header>
    <aside class="panel left" aria-label="Navigation">
      <h2>Navigation</h2>
      <p class="nav-group-title">Arbeitsmodule</p>
      <ul class="nav-list" aria-label="Arbeitsmodule">
        <li class="nav-item"><button type="button" class="nav-button" data-module-nav="gms-suite">üß© Genres-Archiv + Zufall + Liste</button></li>
        <li class="nav-item"><button type="button" class="nav-button" data-module-nav="debug-dev">üõ†Ô∏è Debugging & Entwickleroptionen</button></li>
        <li class="nav-item"><button type="button" class="nav-button" data-module-nav="quick-archive">üóÉÔ∏è Schnell-Speicher-Archiv</button></li>
      </ul>
      <p class="nav-group-title">Organisation</p>
      <ul class="nav-list" aria-label="Organisation und √úberblick">
        <li class="nav-item"><button type="button" class="nav-button" data-module-nav="todo">‚úÖ To-Do-Liste</button></li>
        <li class="nav-item"><button type="button" class="nav-button" data-module-nav="template-archive">üóÇÔ∏è Template-Archiv</button></li>
        <li class="nav-item"><button type="button" class="nav-button" data-module-nav="dashboard" aria-current="page">üìä Dashboard</button></li>
      </ul>
      <p class="quick-help" id="shortcut-help">Tastatur-K√ºrzel (Keyboard Shortcut = Schnellbefehl): Alt+S Speichern, Alt+R Erneut versuchen, Alt+P Reparatur, Alt+L Protokoll, Alt+O Modul √∂ffnen.</p>
      <section class="quick-help" aria-label="Pluginstatus">
        <strong>Pluginstatus (sichtbar):</strong>
        <ul class="plugin-status-list" id="plugin-status-list" aria-live="polite">
          <li class="plugin-status-item"><span>Genres-Archiv + Zufall + Liste</span><span class="plugin-pill plugin-pill-offline">Wartet</span></li>
          <li class="plugin-status-item"><span>Debugging & Entwickleroptionen</span><span class="plugin-pill plugin-pill-offline">Wartet</span></li>
          <li class="plugin-status-item"><span>Template-Archiv</span><span class="plugin-pill plugin-pill-offline">Wartet</span></li>
          <li class="plugin-status-item"><span>Schnell-Speicher-Archiv</span><span class="plugin-pill plugin-pill-offline">Wartet</span></li>
        </ul>
      </section>
    </aside>
    <section class="main" aria-labelledby="bereich-aufgaben">
      <p class="subline">Genrearchiv ‚Äì alle √Ñnderungen gespeichert</p>
      <h2 id="bereich-aufgaben">Werkzeug-√úbersicht</h2>
      <p class="subline" id="project-breadcrumb">Projektpfad: noch nicht gesetzt</p>
      <p class="subline" id="global-search-status" role="status" aria-live="polite">Suche bereit: Bitte Begriff eingeben.</p>
      <p class="subline">Startansicht: Leeres 3x3-Haupt-Grid. Aktivierte Untermodule rutschen automatisch auf den n√§chsten freien Grid-Platz.</p>
      <p class="subline" id="grid-help">Hilfe: Alle 9 Felder sind gleich gro√ü. Inhalte im Feld sind scrollbar (Scroll = bl√§ttern), damit nichts abgeschnitten wird.</p>
      <div class="module-window-actions" aria-label="Globale Fensteroptionen">
        <button type="button" data-action="layout-save" aria-label="Layout speichern" title="Layout speichern">üíæ</button>
        <button type="button" data-action="layout-restore" aria-label="Gespeichertes Layout laden" title="Gespeichertes Layout laden">‚Ü∫</button>
        <button type="button" data-action="window-reset" aria-label="Grid zur√ºcksetzen" title="Grid zur√ºcksetzen">‚ñ£</button>
      </div>
      <section class="main-grid" aria-label="Haupt-Grid 3x3" id="module-grid">
        <div class="main-grid-cell" data-slot-index="1"><div class="grid-slot-label">Feld 1 (frei)</div></div>
        <div class="main-grid-cell" data-slot-index="2"><div class="grid-slot-label">Feld 2 (frei)</div></div>
        <div class="main-grid-cell" data-slot-index="3"><div class="grid-slot-label">Feld 3 (frei)</div></div>
        <div class="main-grid-cell" data-slot-index="4"><div class="grid-slot-label">Feld 4 (frei)</div></div>
        <div class="main-grid-cell" data-slot-index="5"><div class="grid-slot-label">Feld 5 (frei)</div></div>
        <div class="main-grid-cell" data-slot-index="6"><div class="grid-slot-label">Feld 6 (frei)</div></div>
        <div class="main-grid-cell" data-slot-index="7"><div class="grid-slot-label">Feld 7 (frei)</div></div>
        <div class="main-grid-cell" data-slot-index="8"><div class="grid-slot-label">Feld 8 (frei)</div></div>
        <div class="main-grid-cell" data-slot-index="9"><div class="grid-slot-label">Feld 9 (frei)</div></div>
      </section>
      <div class="card-grid" hidden aria-hidden="true"></div>
      <div class="module-empty" id="module-stage-empty">Noch kein Modul aktiv. √ñffnen Sie links ein Modul. Das Modul wird dann dynamisch in das 3x3-Grid eingebettet.</div>
        <article class="tool-card tool-card-primary module-panel" data-accent="c" aria-labelledby="modul-starter-title">
          <p class="card-tag">Startmodul</p>
          <h2 id="modul-starter-title">Modul-Starter</h2>
          <p class="card-state" id="module-card-state" data-state="ready" role="status" aria-live="polite">Status: Bereit</p>
          <label for="module-switcher"><strong>Modul w√§hlen:</strong></label>
          <select id="module-switcher" aria-describedby="module-toggle-help module-help shortcut-help">
            <option value="">Bitte Modul ausw√§hlen</option>
            <option value="gms-suite">Genres-Archiv + Zufall + Liste</option>
            <option value="debug-dev">Debugging & Entwickleroptionen</option>
            <option value="template-archive">Template-Archiv</option>
            <option value="quick-archive">Schnell-Speicher-Archiv</option>
          </select>
          <p id="module-toggle-help" class="subline">Aktive Module sind gr√ºn markiert, deaktivierte Module orange. So sehen Sie den Zustand nicht nur √ºber Text, sondern auch klar mit Kontrast.</p>
          <div class="actions" aria-label="Untermodul aktivieren oder deaktivieren">
            <button type="button" class="module-toggle-button" data-module-toggle="gms-suite" data-enabled="true">Aktiv: Genres-Archiv + Zufall + Liste</button>
            <button type="button" class="module-toggle-button" data-module-toggle="debug-dev" data-enabled="true">Aktiv: Debugging & Entwickleroptionen</button>
            <button type="button" class="module-toggle-button" data-module-toggle="template-archive" data-enabled="true">Aktiv: Template-Archiv</button>
            <button type="button" class="module-toggle-button" data-module-toggle="quick-archive" data-enabled="true">Aktiv: Schnell-Speicher-Archiv</button>
          </div>
          <div class="actions">
            <button type="button" data-action="open-module" aria-keyshortcuts="Alt+O" aria-describedby="module-help shortcut-help">Modul √∂ffnen</button>
          </div>
          <p class="result" id="module-status" role="status" aria-live="polite">Noch kein Modul ge√∂ffnet.</p>
          <p class="subline" id="module-source-preview">Kurzdetails: Bitte Modul ausw√§hlen, um Datenquelle und n√§chsten Schritt zu sehen.</p>
        </article>
        <article class="tool-card tool-card-primary module-panel" data-accent="b" id="gms-suite-view" aria-labelledby="gms-title">
          <p class="card-tag">Plugin: Hauptmodul-Ansicht</p>
          <h2 id="gms-title">Genres-Archiv + Zufall + Liste</h2><div class="module-window-actions" aria-label="Fensteroptionen im Untermodul"><button type="button" data-action="window-hide" aria-label="Untermodul ausblenden" title="Untermodul ausblenden">‚úï</button><button type="button" data-action="window-maximize" aria-label="Untermodul maximieren" title="Untermodul maximieren">‚§¢</button><button type="button" data-action="window-detach" aria-label="Untermodul als Einzelfenster √∂ffnen" title="Untermodul als Einzelfenster √∂ffnen">‚Üó</button></div>
          <p class="subline">Genres, Stimmungen und Stile als Profil-Archiv mit getrennten Eingabefeldern. Enter best√§tigt direkt.</p>
          <label for="gms-genre-input"><strong>Genres:</strong></label>
          <input id="gms-genre-input" type="text" placeholder="z. B. Synthwave, LoFi" aria-describedby="gms-input-help">
          <label for="gms-mood-input"><strong>Stimmungen:</strong></label>
          <input id="gms-mood-input" type="text" placeholder="z. B. Ruhig, D√ºster" aria-describedby="gms-input-help">
          <label for="gms-style-input"><strong>Stile:</strong></label>
          <input id="gms-style-input" type="text" placeholder="z. B. Cinematic, Minimal" aria-describedby="gms-input-help">
          <p id="gms-input-help" class="subline">Hilfe: Mit Enter best√§tigen oder den Speichern-Button nutzen.</p>
          <select id="gms-category" aria-label="Kategorie f√ºr Listenaktionen" hidden><option value="genres">Genres</option><option value="moods">Stimmungen</option><option value="styles">Stile</option></select>
          <div class="actions">
            <button type="button" data-action="gms-add">Eintr√§ge speichern</button>
          </div>
          <p class="result" id="gms-feedback" role="status" aria-live="polite">Noch keine √Ñnderung.</p>
          <p class="subline" id="gms-profile-info">Aktives Profil: default.</p>
          <label for="gms-profile-select"><strong>Archivprofil:</strong></label>
          <select id="gms-profile-select" aria-label="Profil f√ºr Genres-Archiv">
            <option value="default">default</option>
            <option value="techno">techno</option>
            <option value="hoerspiele">h√∂rspiele</option>
          </select>
          <label for="gms-new-profile"><strong>Neues Profil:</strong></label>
          <input id="gms-new-profile" type="text" placeholder="z. B. Ambient" aria-describedby="gms-profile-help">
          <p id="gms-profile-help" class="subline">Profilname bitte kurz und eindeutig eingeben.</p>
          <div class="actions">
            <button type="button" data-action="gms-profile-switch">Profil laden</button>
            <button type="button" data-action="gms-profile-create">Profil erstellen</button>
          </div>
          <p class="result" id="gms-profile-result" role="status" aria-live="polite">Profile bereit.</p>
          <label for="gms-random-count"><strong>Zufallsanzahl:</strong></label>
          <select id="gms-random-count" aria-label="Anzahl f√ºr Zufallsgenerator">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
          </select>
          <div class="actions">
            <button type="button" data-action="gms-random">Zufall erzeugen</button>
            <button type="button" data-action="gms-copy-random">Ergebnis kopieren</button>
          </div>
          <p class="result" id="gms-random-result" role="status" aria-live="polite">Noch kein Zufallsergebnis.</p>
          <h3>Verlauf</h3>
          <ul id="gms-history" aria-label="Letzte Zufallsausgaben"></ul>
          <h3>Archiv-Eintr√§ge (Drag&Drop + CRUD)</h3>
          <ul id="gms-entry-list" class="drag-list" aria-label="Eintr√§ge im aktuellen Profil"></ul>
          <div class="actions">
            <button type="button" data-action="gms-entry-rename">Eintrag umbenennen</button>
            <button type="button" data-action="gms-entry-delete">Eintrag l√∂schen</button>
            <button type="button" data-action="gms-copy-history">Verlauf kopieren</button>
            <button type="button" data-action="gms-clear-history">Verlauf l√∂schen</button>
            <button type="button" data-action="gms-export">Export f√ºr Exportzentrum</button>
            <button type="button" data-action="gms-import-demo">Demo-Import (Merge)</button>
          </div>
          <p id="gms-export-help" class="subline">Hilfe: Export-Dateiname ist Linux-kompatibel und enth√§lt den Arbeitsstatus (z. B. release-ready oder in-abstimmung).</p>
          <p id="gms-export-filename-status" class="result" role="status" aria-live="polite">Dateiname: noch nicht erstellt.</p>
        </article>
<article class="tool-card tool-card-secondary module-panel" data-accent="a" id="debug-dev-view">
          <p class="card-tag">Status und Hilfe</p>
          <h2>Debugging & Entwickleroptionen</h2><div class="module-window-actions" aria-label="Fensteroptionen im Untermodul"><button type="button" data-action="window-hide" aria-label="Untermodul ausblenden" title="Untermodul ausblenden">‚úï</button><button type="button" data-action="window-maximize" aria-label="Untermodul maximieren" title="Untermodul maximieren">‚§¢</button><button type="button" data-action="window-detach" aria-label="Untermodul als Einzelfenster √∂ffnen" title="Untermodul als Einzelfenster √∂ffnen">‚Üó</button></div>
          <p class="card-state" id="debug-card-state" data-state="ready" role="status" aria-live="polite">Status: Bereit</p>
          <p class="result" id="result" role="status" aria-live="polite">Keine Fehler.</p>
          <p class="subline" id="debug-last-event" data-debug-event>Letztes Ereignis: Startzustand um --:--:--.</p>
          <p class="subline" id="debug-next-step" data-debug-next-step>N√§chster Schritt: Aktion w√§hlen oder Alt+L f√ºr Protokoll nutzen.</p>
          <ul id="debug-log-list" aria-label="Letzte Debug-Ereignisse"></ul>
          <div class="actions">
            <button type="button" data-action="error">Beispiel-Fehler anzeigen</button>
          </div>
        </article>
        <article class="tool-card tool-card-secondary module-panel" data-accent="c" id="todo-view" aria-labelledby="todo-title">
          <p class="card-tag">Untermodul: Projekt-To-Do</p>
          <h2 id="todo-title">To-Do-Liste (nutzerbasiert)</h2><div class="module-window-actions" aria-label="Fensteroptionen im Untermodul"><button type="button" data-action="window-hide" aria-label="Untermodul ausblenden" title="Untermodul ausblenden">‚úï</button><button type="button" data-action="window-maximize" aria-label="Untermodul maximieren" title="Untermodul maximieren">‚§¢</button><button type="button" data-action="window-detach" aria-label="Untermodul als Einzelfenster √∂ffnen" title="Untermodul als Einzelfenster √∂ffnen">‚Üó</button></div>
          <p class="subline">Standardfunktionen: Aufgabe erfassen, F√§lligkeit (Datum), erledigen, l√∂schen.</p>
          <label for="todo-input"><strong>Aufgabe:</strong></label>
          <input id="todo-input" type="text" placeholder="z. B. Introtext f√ºr Kundin pr√ºfen">
          <label for="todo-date"><strong>F√§llig am:</strong></label>
          <input id="todo-date" type="date">
          <div class="actions">
            <button type="button" data-action="todo-add">To-Do hinzuf√ºgen</button>
            <button type="button" data-action="todo-toggle">Als erledigt markieren</button>
            <button type="button" data-action="todo-delete">Aus Liste entfernen</button>
          </div>
          <p class="result" id="todo-result" role="status" aria-live="polite">Noch keine To-Do-Aktion.</p>
          <ul id="todo-list" class="drag-list" aria-label="Projektorientierte Nutzer-To-Do-Liste"></ul>
        </article>
        <article class="tool-card tool-card-secondary module-panel" data-accent="b" id="template-archive-view" aria-labelledby="template-archive-title">
          <p class="card-tag">Untermodul: Template-Archiv</p>
          <h2 id="template-archive-title">Template-Archiv f√ºr Profile und Fragmente</h2><div class="module-window-actions" aria-label="Fensteroptionen im Untermodul"><button type="button" data-action="window-hide" aria-label="Untermodul ausblenden" title="Untermodul ausblenden">‚úï</button><button type="button" data-action="window-maximize" aria-label="Untermodul maximieren" title="Untermodul maximieren">‚§¢</button><button type="button" data-action="window-detach" aria-label="Untermodul als Einzelfenster √∂ffnen" title="Untermodul als Einzelfenster √∂ffnen">‚Üó</button></div>
          <p class="subline">Hilfe: Speichern Sie hier Coden, Content, Textfragmente, Prompting und eigene Befehle als wiederverwendbare Buttons.</p>
          <label for="template-title-input"><strong>Titel:</strong></label>
          <input id="template-title-input" type="text" maxlength="80" placeholder="z. B. Prompt f√ºr Code-Review" aria-describedby="template-help-text">
          <label for="template-category-input"><strong>Profil/Kategorie:</strong></label>
          <input id="template-category-input" type="text" maxlength="40" placeholder="z. B. Coden, Content, Prompting">
          <label for="template-content-input"><strong>Textinhalt:</strong></label>
          <textarea id="template-content-input" rows="5" placeholder="Template-Inhalt oder Befehl eingeben"></textarea>
          <div class="actions">
            <button type="button" data-action="template-add">Template speichern</button>
            <button type="button" data-action="template-update">Auswahl aktualisieren</button>
            <button type="button" data-action="template-delete">Auswahl l√∂schen</button>
          </div>
          <p class="result" id="template-result" role="status" aria-live="polite">Noch kein Template gespeichert.</p>
          <p class="subline" id="template-help-text">Hinweis: Beim Klick auf ein Template wird es protokolliert und automatisch in die Zwischenablage kopiert.</p>
          <ul id="template-list" class="module-option-list" aria-label="Gespeicherte Templates als Buttons"></ul>
        </article>
        <article class="tool-card tool-card-secondary module-panel" data-accent="c" id="quick-archive-view" aria-labelledby="quick-archive-title">
          <p class="card-tag">Untermodul: Schnell-Speicher-Archiv</p>
          <h2 id="quick-archive-title">Schnell-Speicher-Archiv</h2><div class="module-window-actions" aria-label="Fensteroptionen im Untermodul"><button type="button" data-action="window-hide" aria-label="Untermodul ausblenden" title="Untermodul ausblenden">‚úï</button><button type="button" data-action="window-maximize" aria-label="Untermodul maximieren oder wiederherstellen" title="Untermodul maximieren oder wiederherstellen">‚§¢</button><button type="button" data-action="window-detach" aria-label="Untermodul als Einzelfenster √∂ffnen" title="Untermodul als Einzelfenster √∂ffnen">‚Üó</button></div>
          <p class="subline">Erste Maske: <strong>Eingabe Fachtermini</strong>. Der Titel wird als Dateiname genutzt (Dateiname = Textname ohne Sonderzeichen). Die Eintr√§ge werden chronologisch gespeichert.</p>
          <label for="quick-archive-title-input"><strong>Titel:</strong></label>
          <input id="quick-archive-title-input" type="text" value="Eingabe Fachtermini" autocomplete="off">
          <label for="quick-archive-path-input"><strong>Projektordnerpfad (optional):</strong></label>
          <input id="quick-archive-path-input" type="text" placeholder="Leer lassen f√ºr Standardordner ./data/quick_archive">
          <label for="quick-archive-text-input"><strong>Eingabefeld:</strong></label>
          <input id="quick-archive-text-input" type="text" placeholder="z. B. neuer Fachbegriff, Idee oder Zwischenrecherche-Ergebnis">
          <div class="actions"><button type="button" data-action="quick-archive-save">Eintrag speichern</button><button type="button" data-action="quick-archive-new-mask">Neue Maske anlegen</button></div>
          <p class="result" id="quick-archive-result" role="status" aria-live="polite">Noch kein Eintrag gespeichert.</p>
          <div class="quick-archive-grid">
            <section class="quick-archive-masks" id="quick-archive-mask-list" aria-label="Vorhandene Masken"></section>
            <section class="quick-archive-entry" aria-label="Chronologischer Verlauf">
              <strong>Chronologisch gespeicherte Eintr√§ge</strong>
              <ol id="quick-archive-history" class="quick-archive-history"></ol>
            </section>
          </div>
        </article>
<article class="tool-card tool-card-primary module-panel" data-accent="a" id="project-routine-view" aria-labelledby="projekt-routine-title">
          <p class="card-tag">Start-Routine Projektordner</p>
          <h2 id="projekt-routine-title">Projekt-Routine</h2>
          <p class="card-state" id="project-card-state" data-state="loading" role="status" aria-live="polite">Status: L√§dt</p>
          <p id="project-path-status" class="result" role="status" aria-live="polite">Projektordner: wird beim Start gepr√ºft‚Ä¶</p>
          <p class="subline" id="project-path-help">Hilfe (Help = Unterst√ºtzung): Der Pfad wird in der Start-Routine gepr√ºft und bei Bedarf automatisch erstellt.</p>
          <div class="actions">
            <button type="button" data-action="project-setup">Projektordner anpassen</button>
          </div>
        </article>
    </section>
    <aside class="panel right" aria-label="Einstellungen und Hilfe">
      <h2>Einstellungen</h2>
      <section class="quick-help" aria-labelledby="inspector-title">
        <strong id="inspector-title">Kontext-Inspector (Details + Hilfe):</strong>
        <div class="inspector-grid">
          <p id="inspector-details">Details: Dashboard ist aktiv. Status: Bereit.</p>
          <p id="inspector-help">Hilfe: √ñffnen Sie ‚ÄûShortcut-√úbersicht‚Äú, wenn Sie nur per Tastatur arbeiten.</p>
          <p id="inspector-meta">Meta: Quelle config/module_sources.json, letzter Wechsel: Start.</p>
          <p id="inspector-shortcuts">Shortcuts: Alt+S Speichern, Alt+O Modul √∂ffnen, F1 oder ? f√ºr Overlay.</p>
        </div>
      </section>
      <section class="quick-help" data-accent="a" aria-labelledby="bereich-hilfe" id="hilfe-next-steps" tabindex="-1">
        <h2 id="bereich-hilfe">Schnellhilfe mit Next Steps</h2>
        <div class="actions" aria-label="Schnellaktionen">
          <button type="button" data-action="save" aria-keyshortcuts="Alt+S" aria-describedby="shortcut-help">Zwischenstand speichern</button>
          <button type="button" data-action="retry" aria-keyshortcuts="Alt+R" aria-describedby="shortcut-help">Aktion erneut versuchen</button>
          <button type="button" data-action="log" aria-keyshortcuts="Alt+L" aria-describedby="shortcut-help">N√§chsten Protokoll-Schritt zeigen</button>
        </div>
        <p class="subline">Empfohlene Reihenfolge (Priorit√§t): Erst P0-Schritte (kritisch), danach P1-Schritte (wichtig).</p>
        <ol>
          <li>Neu starten: <code>./start.sh</code></li>
          <li>Auto-Reparatur: <code>./start.sh --repair</code></li>
          <li><button type="button" data-action="repair" aria-keyshortcuts="Alt+P" aria-describedby="shortcut-help">Reparatur jetzt erkl√§ren</button></li>
          <li>Protokoll lesen: <code>cat logs/status_summary.txt</code></li>
        </ol>
      </section>
      <ul class="settings-list">
        <li class="settings-item"><strong>Hauptmodul Einstellungen</strong><label for="project-switch-input">Projekt-Kontext</label><input id="project-switch-input" type="text" value="" placeholder="/home/name/Projektordner" aria-describedby="project-switch-help"><label for="global-search-input">Globale Suche</label><input id="global-search-input" type="search" placeholder="Modul, Aktion oder Hilfe suchen" aria-describedby="global-search-status project-switch-help"><div class="actions" style="margin-top:0;"><button type="button" data-action="project-switch" aria-describedby="project-switch-help">Projekt wechseln</button></div><p class="subline" id="project-switch-help">Hilfe: Pfad eintragen, dann ‚ÄûProjekt wechseln‚Äú dr√ºcken.</p></li>
        <li class="settings-item">
          <label for="theme-switcher"><strong>Design:</strong></label>
          <select id="theme-switcher" data-theme-switcher aria-describedby="theme-help">
            <option value="balanced">Balanced (ausgeglichen)</option>
            <option value="high-contrast">High Contrast (hoher Kontrast)</option>
            <option value="light">Light (hell)</option>
            <option value="dark">Dark (dunkel)</option>
          </select>
        </li>
        <li class="settings-item">
          <p id="theme-help">Hinweis: Status nie nur √ºber Farbe, sondern immer mit Symbol + Text. Kontrast (Helligkeits-Unterschied) bleibt in allen drei Themes gut lesbar. Daten sparen: Wenn Ihr Ger√§t reduzierte Bewegung nutzt, werden Animationen automatisch deaktiviert.</p>
          <p class="subline" id="theme-contrast-preview">Kontrast-Vorschau: balanced ‚âà 10:1, high-contrast ‚âà 17:1, light ‚âà 11:1, dark ‚âà 12:1.</p>
          <p class="subline" id="theme-status" role="status" aria-live="polite">Aktives Theme: high-contrast. Empfohlen f√ºr maximalen Kontrast.</p>
        </li>
        <li class="settings-item" id="module-help">Modulhilfe: W√§hlen Sie links ein Modul und √∂ffnen Sie es mit Alt+O. Bei Fehlern folgen Sie den Next Steps im Debug-Log.</li>
        <li class="settings-item">
          <label for="font-scale-switcher"><strong>Textgr√∂√üe:</strong></label>
          <select id="font-scale-switcher" aria-describedby="font-scale-help">
            <option value="s">S (kompakt)</option>
            <option value="m">M (standard)</option>
            <option value="l">L (gr√∂√üer)</option>
            <option value="xl">XL (sehr gro√ü)</option>
          </select>
          <p id="font-scale-help">Hilfe: Gr√∂√üere Textgr√∂√üe verbessert Lesbarkeit. Die Auswahl wird lokal gespeichert.</p>
          <p class="subline" id="font-scale-status" role="status" aria-live="polite">Textgr√∂√üe: M (standard).</p>
        </li>
        <li class="settings-item">
          <label for="backup-switcher"><strong>Auto-Backup:</strong></label>
          <input id="backup-switcher" type="checkbox" aria-describedby="backup-help backup-status" checked>
          <p id="backup-help">Hilfe: Auto-Backup sichert √Ñnderungen im Hintergrund. Empfehlung: Aktiv lassen. Wenn aus, bitte manuell speichern.</p>
          <p class="subline" id="backup-status" role="status" aria-live="polite">Auto-Backup: Aktiv (Standard).</p>
        </li>
        <li class="settings-item">Nutzerstatistik: 0 aktive Fehler, letzte Pr√ºfung erfolgreich.</li>
        <li class="settings-item">
          <button type="button" data-action="open-shortcuts">Shortcut-√úbersicht √∂ffnen (F1 oder ?)</button>
          <p class="subline">Hilfe: Die √úbersicht zeigt alle K√ºrzel und kann nach Stichwort gefiltert werden.</p>
        </li>
      </ul>
    </aside>
    <footer class="footer" aria-label="Footer mit Schnellfunktionen und Status">
      <section class="footer-column" aria-label="Systemstatus"><strong>Status</strong><span id="footer-version-path">Version: wird geladen‚Ä¶ | Projektpfad: wird gepr√ºft‚Ä¶</span></section>
      <section class="footer-column" aria-label="Datensicherung"><strong>Datensicherung</strong><span id="footer-backup-status">Auto-Backup: Aktiv (Standard)</span></section>
      <section class="footer-column" aria-label="Schnellfunktionen im Footer"><strong>Footer-Schnellfunktionen</strong><div class="footer-actions"><button type="button" data-action="save">Speichern</button><button type="button" data-action="retry">Erneut versuchen</button><button type="button" data-action="log">Protokoll √∂ffnen</button></div><span id="footer-sync-status">Alle √Ñnderungen gespeichert</span></section>
    </footer>
  </main>
  <dialog id="error-dialog" aria-labelledby="error-title" aria-describedby="error-text" aria-modal="true"><h2 id="error-title">‚ùå Fehler erkannt</h2><p id="error-text">Die Aktion konnte nicht abgeschlossen werden. Bitte folgen Sie den n√§chsten Schritten.</p><ul><li>Erneut versuchen</li><li>Reparatur ausf√ºhren mit <code>./start.sh --repair</code></li><li>Protokoll √∂ffnen mit <code>cat logs/start.log</code></li></ul><div class="actions"><button type="button" data-action="retry">Erneut versuchen</button><button type="button" data-action="repair">Reparatur</button><button type="button" data-action="log">Protokoll √∂ffnen</button><button type="button" data-action="close-dialog">Dialog schlie√üen</button></div></dialog>
  <dialog id="shortcut-overlay" class="quick-overlay" aria-labelledby="shortcut-overlay-title" aria-describedby="shortcut-overlay-help" aria-modal="true"><h2 id="shortcut-overlay-title">‚å®Ô∏è Shortcut-√úbersicht</h2><p id="shortcut-overlay-help">Fachwort: Overlay (√ºberlagerndes Fenster). Tipp: Suchbegriff eingeben, um passende Befehle schneller zu finden.</p><label for="shortcut-filter"><strong>Suche in K√ºrzeln:</strong></label><input id="shortcut-filter" type="search" placeholder="z. B. speichern, reparatur, modul" autocomplete="off"><p id="shortcut-filter-status" class="result" role="status" aria-live="polite">6 Eintr√§ge sichtbar.</p><ul id="shortcut-list" class="shortcut-list"></ul><div class="actions"><button type="button" data-action="close-shortcuts">Schlie√üen</button></div></dialog>
  <dialog id="project-dialog" aria-labelledby="project-title" aria-describedby="project-text" aria-modal="true">
    <h2 id="project-title">üìÅ Projekt-Routine</h2>
    <p id="project-text">Bitte Projektordner eingeben und best√§tigen. Es gibt keinen Standardordner mehr. Die Start-Routine pr√ºft den Ordner beim n√§chsten Start und erstellt ihn bei Bedarf automatisch.</p>
    <label for="project-path-input"><strong>Projektordner (absoluter Pfad):</strong></label>
    <input id="project-path-input" type="text" autocomplete="off" spellcheck="false" aria-describedby="project-hint">
    <p class="subline" id="project-hint">Beispiel: /home/name/Provoware-Projekte/MeinProjekt</p>
    <p class="result" id="project-dialog-result" role="status" aria-live="polite">Bitte Pfad pr√ºfen und speichern.</p>
    <div class="actions">
      <button type="button" data-action="project-save">Pfad speichern</button>
      <button type="button" data-action="project-close">Sp√§ter</button>
    </div>
  </dialog>
  <script>
    (function () {
      const html = document.documentElement;
      const resultNode = document.getElementById('result');
      const dialog = document.getElementById('error-dialog');
      const themeSelector = document.getElementById('theme-switcher');
      const syncStatusNode = document.getElementById('sync-status');
      const footerSyncStatusNode = document.getElementById('footer-sync-status');
      const footerVersionPathNode = document.getElementById('footer-version-path');
      const footerBackupStatusNode = document.getElementById('footer-backup-status');
      const debugEventNode = document.getElementById('debug-last-event');
      const debugNextStepNode = document.getElementById('debug-next-step');
      const themeStatusNode = document.getElementById('theme-status');
      const fontScaleSelector = document.getElementById('font-scale-switcher');
      const fontScaleStatusNode = document.getElementById('font-scale-status');
      const backupToggleNode = document.getElementById('backup-switcher');
      const backupStatusNode = document.getElementById('backup-status');
      const moduleCardStateNode = document.getElementById('module-card-state');
      const debugCardStateNode = document.getElementById('debug-card-state');
      const projectCardStateNode = document.getElementById('project-card-state');
      const moduleSelector = document.getElementById('module-switcher');
      const moduleStatusNode = document.getElementById('module-status');
      const gmsExportFilenameStatusNode = document.getElementById('gms-export-filename-status');
      const projectStatusNode = document.getElementById('project-path-status');
      const projectDialog = document.getElementById('project-dialog');
      const shortcutOverlay = document.getElementById('shortcut-overlay');
      const shortcutFilterInput = document.getElementById('shortcut-filter');
      const shortcutFilterStatusNode = document.getElementById('shortcut-filter-status');
      const shortcutListNode = document.getElementById('shortcut-list');
      const projectPathInput = document.getElementById('project-path-input');
      const projectSwitchInput = document.getElementById('project-switch-input');
      const projectBreadcrumbNode = document.getElementById('project-breadcrumb');
      const globalSearchInput = document.getElementById('global-search-input');
      const globalSearchStatusNode = document.getElementById('global-search-status');
      const inspectorDetailsNode = document.getElementById('inspector-details');
      const inspectorHelpNode = document.getElementById('inspector-help');
      const inspectorMetaNode = document.getElementById('inspector-meta');
      const projectDialogResultNode = document.getElementById('project-dialog-result');
      const debugLogListNode = document.getElementById('debug-log-list');
      const topbarLogListNode = document.getElementById('topbar-log-list');
      const recentProjectListNode = document.getElementById('recent-project-list');
      const recentProjectStatusNode = document.getElementById('recent-project-status');
      const modeSwitchNode = document.getElementById('mode-switch');
      const shellNode = document.querySelector('.shell');
      const pluginStatusListNode = document.getElementById('plugin-status-list');
      const navButtonNodes = Array.from(document.querySelectorAll('[data-module-nav]'));
      const moduleGridNode = document.getElementById('module-grid');
      const moduleStageEmptyNode = document.getElementById('module-stage-empty');
      const modulePanelNodes = Array.from(document.querySelectorAll('.module-panel'));
      const moduleGridCells = Array.from(document.querySelectorAll('.main-grid-cell'));
      const moduleSlots = {};
      const LAYOUT_STORAGE_KEY = 'provoware-layout-profile';
      const FONT_SCALE_STORAGE_KEY = 'provoware-font-scale';
      const BACKUP_STORAGE_KEY = 'provoware-backup-enabled';
      const RECENT_PROJECT_STORAGE_KEY = 'provoware-recent-projects';
      const TEMPLATE_ARCHIVE_STORAGE_KEY = 'provoware-template-archive';
      const QUICK_ARCHIVE_STORAGE_KEY = 'provoware-quick-archive';
      const MODULE_TOGGLE_STORAGE_KEY = 'provoware-module-toggle-state';
      const APP_VERSION = '2026.02.23';
      const moduleToggleNodes = Array.from(document.querySelectorAll('[data-module-toggle]'));
      const moduleEnabledState = {};
      const quickArchiveFallbackPath = './data/quick_archive';
      const shortcutEntries = [{ key: 'Alt+S', title: 'Speichern', detail: 'Speichert √Ñnderungen im aktiven Modul.' }, { key: 'Alt+R', title: 'Erneut versuchen', detail: 'Startet die letzte Aktion neu.' }, { key: 'Alt+P', title: 'Reparatur', detail: '√ñffnet die Reparatur-Hilfe mit Befehlen.' }, { key: 'Alt+L', title: 'Protokoll', detail: 'Zeigt den n√§chsten Log-Schritt.' }, { key: 'Alt+O', title: 'Modul √∂ffnen', detail: '√ñffnet das gew√§hlte Modul.' }, { key: 'F1 / ?', title: 'Shortcut-√úbersicht', detail: '√ñffnet das Overlay mit Filter.' }];
      let lastDialogTrigger = null;
      const serverProjectPath = '__PROJECT_PATH__';
      const injectedModuleSources = typeof __MODULE_SOURCES__ !== 'undefined' ? __MODULE_SOURCES__ : null;
      const serverModuleSources = normalizeModuleSources(injectedModuleSources);
      const detachedWindows = {};
      let isProMode = false;
      let activeModuleKey = '';
      const gmsPlugin = (function createGmsArchivPlugin() {
        const MODULE_ID = 'gms-archiv';
        const HISTORY_LIMIT = 8;
        const state = {
          currentProfile: 'default',
          profiles: {
            default: { genres: ['Synthwave', 'Lo-Fi'], moods: ['Ruhig'], styles: ['Cinematic'], history: [] },
            techno: { genres: ['Techno'], moods: ['Energie'], styles: ['Peak-Time'], history: [] },
            hoerspiele: { genres: ['H√∂rspiel'], moods: ['Spannung'], styles: ['Erz√§hlerisch'], history: [] }
          },
          mounted: false,
          lastRandomResult: '',
          selectedEntryIndex: -1
        };
        function getProfileData() {
          if (!state.profiles[state.currentProfile]) {
            state.profiles[state.currentProfile] = { genres: [], moods: [], styles: [], history: [] };
          }
          return state.profiles[state.currentProfile];
        }
        function normalizeEntries(value) {
          if (typeof value !== 'string') {
            return [];
          }
          return value.split(',').map(function (item) { return item.trim(); }).filter(Boolean);
        }
        function addUniqueByCategory(category, entries) {
          const profileData = getProfileData();
          if (!['genres', 'moods', 'styles'].includes(category) || !Array.isArray(entries)) {
            return { added: 0, duplicates: 0 };
          }
          const known = new Set(profileData[category].map(function (item) { return item.toLowerCase(); }));
          let added = 0;
          let duplicates = 0;
          entries.forEach(function (entry) {
            const low = entry.toLowerCase();
            if (known.has(low)) {
              duplicates += 1;
              return;
            }
            known.add(low);
            profileData[category].push(entry);
            added += 1;
          });
          return { added: added, duplicates: duplicates };
        }
        function addHistoryItem(text) {
          const profileData = getProfileData();
          if (typeof text !== 'string' || text.trim().length === 0) {
            return false;
          }
          profileData.history.unshift(text.trim());
          if (profileData.history.length > HISTORY_LIMIT) {
            profileData.history.length = HISTORY_LIMIT;
          }
          return true;
        }
        function chooseRandom(items, count) {
          if (!Array.isArray(items) || items.length === 0) {
            return [];
          }
          const safeCount = Math.max(1, Math.min(count, items.length));
          const copy = items.slice();
          const selected = [];
          while (selected.length < safeCount && copy.length > 0) {
            const index = Math.floor(Math.random() * copy.length);
            selected.push(copy.splice(index, 1)[0]);
          }
          return selected;
        }
        function safeNode(id) { return document.getElementById(id); }
        function renderHistory() {
          const listNode = safeNode('gms-history');
          if (!listNode) {
            return false;
          }
          const profileData = getProfileData();
          listNode.innerHTML = '';
          if (!profileData.history.length) {
            const li = document.createElement('li');
            li.textContent = 'Noch kein Verlauf.';
            listNode.appendChild(li);
            return true;
          }
          profileData.history.forEach(function (entry, index) {
            const li = document.createElement('li');
            li.textContent = String(index + 1) + '. ' + entry;
            listNode.appendChild(li);
          });
          return true;
        }
        function renderProfileInfo() {
          const info = safeNode('gms-profile-info');
          if (!info) {
            return false;
          }
          info.textContent = 'Aktives Profil: ' + state.currentProfile + '.';
          return true;
        }
        function renderProfileSelect() {
          const selectNode = safeNode('gms-profile-select');
          if (!selectNode) {
            return false;
          }
          const keys = Object.keys(state.profiles);
          selectNode.innerHTML = '';
          keys.forEach(function (key) {
            const option = document.createElement('option');
            option.value = key;
            option.textContent = key;
            if (key === state.currentProfile) {
              option.selected = true;
            }
            selectNode.appendChild(option);
          });
          return true;
        }
        function renderEntryList() {
          const listNode = safeNode('gms-entry-list');
          const categoryNode = safeNode('gms-category');
          if (!listNode || !categoryNode) {
            return false;
          }
          const category = categoryNode.value;
          const data = getProfileData();
          const items = Array.isArray(data[category]) ? data[category] : [];
          listNode.innerHTML = '';
          if (!items.length) {
            const li = document.createElement('li');
            li.textContent = 'Noch keine Eintr√§ge in dieser Kategorie.';
            listNode.appendChild(li);
            state.selectedEntryIndex = -1;
            return true;
          }
          items.forEach(function (item, index) {
            const li = document.createElement('li');
            li.className = 'drag-item';
            li.setAttribute('draggable', 'true');
            li.setAttribute('data-entry-index', String(index));
            li.setAttribute('aria-selected', state.selectedEntryIndex === index ? 'true' : 'false');
            const label = document.createElement('span');
            label.textContent = item;
            const pick = document.createElement('button');
            pick.type = 'button';
            pick.textContent = 'Ausw√§hlen';
            pick.setAttribute('data-action', 'gms-entry-pick');
            pick.setAttribute('data-entry-index', String(index));
            li.appendChild(label);
            li.appendChild(pick);
            listNode.appendChild(li);
          });
          return true;
        }
        const services = {
          storage: {
            read: function () { return getProfileData(); },
            write: function (nextState) {
              if (!nextState || typeof nextState !== 'object') {
                return false;
              }
              const profileData = getProfileData();
              ['genres', 'moods', 'styles', 'history'].forEach(function (key) {
                if (Array.isArray(nextState[key])) {
                  profileData[key] = nextState[key].slice();
                }
              });
              return true;
            }
          },
          profile: {
            getCurrent: function () { return state.currentProfile; },
            setCurrent: function (profileKey) {
              if (typeof profileKey !== 'string' || profileKey.trim().length === 0) {
                return false;
              }
              state.currentProfile = profileKey.trim();
              renderProfileInfo();
              renderHistory();
              return true;
            }
          },
          ui: {
            toast: function (message) { return setResult(message); },
            copy: function (value) {
              if (typeof value !== 'string' || value.trim().length === 0) {
                setResult('‚ö†Ô∏è Nichts zu kopieren.');
                return false;
              }
              if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(value).then(function () { setResult('‚úÖ Kopiert.'); });
                return true;
              }
              setResult('‚ö†Ô∏è Kopieren nicht m√∂glich. Bitte Text markieren und kopieren.');
              return false;
            }
          },
          exportCenter: {
            exportPayload: function () {
              return { module: MODULE_ID, profile: state.currentProfile, data: getProfileData() };
            },
            importPayload: function (payload) {
              if (!payload || typeof payload !== 'object' || !payload.data) {
                return { ok: false, reason: 'Import kaputt. Bitte Abbrechen oder Reparatur versuchen.' };
              }
              const incoming = payload.data;
              ['genres', 'moods', 'styles'].forEach(function (key) {
                const clean = Array.isArray(incoming[key]) ? incoming[key].filter(function (item) { return typeof item === 'string' && item.trim().length > 0; }) : [];
                addUniqueByCategory(key, clean);
              });
              renderHistory();
              return { ok: true };
            }
          },
          log: {
            info: function (message) { appendDebugLog('‚ÑπÔ∏è GMS: ' + message + ' (' + getTimeStamp() + ').'); }
          }
        };
        return {
          mount: function () {
            state.mounted = true;
            renderProfileInfo();
            renderProfileSelect();
            renderHistory();
            renderEntryList();
            return true;
          },
          unmount: function () { state.mounted = false; return true; },
          getState: function () { return JSON.parse(JSON.stringify(state)); },
          setState: function (nextState) {
            if (!nextState || typeof nextState !== 'object') {
              return false;
            }
            if (typeof nextState.currentProfile === 'string' && nextState.currentProfile.trim().length > 0) {
              state.currentProfile = nextState.currentProfile.trim();
            }
            if (nextState.profiles && typeof nextState.profiles === 'object') {
              state.profiles = nextState.profiles;
            }
            if (typeof nextState.selectedEntryIndex === 'number' && Number.isInteger(nextState.selectedEntryIndex)) {
              state.selectedEntryIndex = nextState.selectedEntryIndex;
            }
            renderProfileInfo();
            renderProfileSelect();
            renderHistory();
            renderEntryList();
            return true;
          },
          exportPayload: services.exportCenter.exportPayload,
          importPayload: services.exportCenter.importPayload,
          handleAction: function (actionValue) {
            const categoryNode = safeNode('gms-category');
            const genreInputNode = safeNode('gms-genre-input');
            const moodInputNode = safeNode('gms-mood-input');
            const styleInputNode = safeNode('gms-style-input');
            const feedbackNode = safeNode('gms-feedback');
            const randomNode = safeNode('gms-random-result');
            const countNode = safeNode('gms-random-count');
            const profileData = getProfileData();
            if (actionValue === 'gms-add') {
              const groupedInputs = [
                { key: 'genres', node: genreInputNode },
                { key: 'moods', node: moodInputNode },
                { key: 'styles', node: styleInputNode }
              ];
              let addedTotal = 0;
              let duplicateTotal = 0;
              groupedInputs.forEach(function (group) {
                const entries = normalizeEntries(group.node ? group.node.value : '');
                if (!entries.length) {
                  return;
                }
                const result = addUniqueByCategory(group.key, entries);
                addedTotal += result.added;
                duplicateTotal += result.duplicates;
                if (group.node) {
                  group.node.value = '';
                }
              });
              if (addedTotal === 0 && duplicateTotal === 0) {
                if (feedbackNode) { feedbackNode.textContent = '‚ö†Ô∏è Bitte mindestens einen Eintrag eingeben.'; }
                return true;
              }
              if (feedbackNode) { feedbackNode.textContent = '‚úÖ Gespeichert: ' + addedTotal + '. Duplikat √ºbersprungen: ' + duplicateTotal + '.'; }
              services.log.info('Eintr√§ge gespeichert: +' + addedTotal + ', Duplikate ' + duplicateTotal);
              renderEntryList();
              return true;
            }
            if (actionValue === 'gms-profile-switch') {
              const profileNode = safeNode('gms-profile-select');
              const profileName = profileNode ? profileNode.value : '';
              if (typeof profileName !== 'string' || profileName.trim().length === 0 || !state.profiles[profileName]) {
                setResult('‚ö†Ô∏è Profil nicht gefunden. Bitte Profil erneut w√§hlen.');
                return true;
              }
              state.currentProfile = profileName.trim();
              state.selectedEntryIndex = -1;
              renderProfileInfo();
              renderHistory();
              renderEntryList();
              const profileResult = safeNode('gms-profile-result');
              if (profileResult) { profileResult.textContent = '‚úÖ Profil geladen: ' + state.currentProfile + '.'; }
              return true;
            }
            if (actionValue === 'gms-profile-create') {
              const input = safeNode('gms-new-profile');
              const raw = input ? input.value : '';
              const nextName = typeof raw === 'string' ? raw.trim().toLowerCase() : '';
              if (!nextName || /[^a-z0-9\-√§√∂√º]/i.test(nextName)) {
                setResult('‚ö†Ô∏è Profilname ung√ºltig. Bitte nur Buchstaben, Zahlen oder Bindestrich nutzen.');
                return true;
              }
              if (!state.profiles[nextName]) {
                state.profiles[nextName] = { genres: [], moods: [], styles: [], history: [] };
              }
              state.currentProfile = nextName;
              if (input) { input.value = ''; }
              renderProfileInfo();
              renderProfileSelect();
              renderHistory();
              renderEntryList();
              const profileResult = safeNode('gms-profile-result');
              if (profileResult) { profileResult.textContent = '‚úÖ Profil erstellt: ' + state.currentProfile + '.'; }
              return true;
            }
            if (actionValue === 'gms-entry-pick') {
              return true;
            }
            if (actionValue === 'gms-entry-delete') {
              const category = categoryNode ? categoryNode.value : '';
              const active = getProfileData();
              if (state.selectedEntryIndex < 0 || !Array.isArray(active[category]) || !active[category][state.selectedEntryIndex]) {
                setResult('‚ö†Ô∏è Bitte zuerst einen Eintrag ausw√§hlen.');
                return true;
              }
              active[category].splice(state.selectedEntryIndex, 1);
              state.selectedEntryIndex = -1;
              renderEntryList();
              setResult('‚úÖ Eintrag gel√∂scht.');
              return true;
            }
            if (actionValue === 'gms-entry-rename') {
              const category = categoryNode ? categoryNode.value : '';
              const active = getProfileData();
              const current = state.selectedEntryIndex >= 0 && Array.isArray(active[category]) ? active[category][state.selectedEntryIndex] : '';
              if (!current) {
                setResult('‚ö†Ô∏è Bitte zuerst einen Eintrag ausw√§hlen.');
                return true;
              }
              const renamed = window.prompt('Neuen Namen eingeben:', current);
              if (typeof renamed !== 'string' || renamed.trim().length === 0) {
                setResult('‚ö†Ô∏è Umbenennen abgebrochen. Bitte erneut versuchen.');
                return true;
              }
              active[category][state.selectedEntryIndex] = renamed.trim();
              renderEntryList();
              setResult('‚úÖ Eintrag umbenannt.');
              return true;
            }
            if (actionValue === 'gms-random') {
              const count = countNode ? Number(countNode.value) : 1;
              const merged = profileData.genres.concat(profileData.moods, profileData.styles);
              const resultItems = chooseRandom(merged, count);
              if (!resultItems.length) {
                if (randomNode) { randomNode.textContent = '‚ö†Ô∏è Keine Daten vorhanden. Bitte zuerst Eintr√§ge speichern.'; }
                return true;
              }
              state.lastRandomResult = resultItems.join(', ');
              addHistoryItem(state.lastRandomResult);
              renderHistory();
              if (randomNode) { randomNode.textContent = 'üé≤ ' + state.lastRandomResult; }
              services.log.info('Zufall erzeugt: ' + state.lastRandomResult);
              return true;
            }
            if (actionValue === 'gms-copy-random') { return services.ui.copy(state.lastRandomResult); }
            if (actionValue === 'gms-copy-history') { return services.ui.copy(profileData.history.join('\n')); }
            if (actionValue === 'gms-clear-history') {
              profileData.history = [];
              renderHistory();
              renderEntryList();
              setResult('‚úÖ Verlauf gel√∂scht.');
              return true;
            }
            if (actionValue === 'gms-export') {
              const exportData = this.exportPayload();
              if (!exportData || typeof exportData !== 'object' || !exportData.data) {
                setResult('‚ö†Ô∏è Export fehlgeschlagen. N√§chster Schritt: Eintr√§ge pr√ºfen und erneut exportieren.');
                return true;
              }
              const fileName = buildExportFileName(exportData.module, exportData.profile);
              const payload = JSON.stringify(Object.assign({}, exportData, { file_name: fileName }), null, 2);
              const copied = services.ui.copy(payload);
              if (gmsExportFilenameStatusNode) {
                gmsExportFilenameStatusNode.textContent = 'Dateiname: ' + fileName;
              }
              setResult(copied ? '‚úÖ Export kopiert. Dateiname: ' + fileName : '‚ö†Ô∏è Export erstellt, aber Kopieren ist fehlgeschlagen. Dateiname: ' + fileName);
              return true;
            }
            if (actionValue === 'gms-import-demo') {
              const demo = { data: { genres: ['Electro'], moods: ['Hell'], styles: ['Minimal'] } };
              const merged = this.importPayload(demo);
              if (!merged.ok) {
                setResult('‚ö†Ô∏è Import kaputt. Abbrechen / Reparatur versuchen / Backup laden.');
                return true;
              }
              setResult('‚úÖ Demo-Import gemerged.');
              return true;
            }
            return false;
          }
        };
      })();
      function getDialogFocusableElements() {
        if (!dialog) {
          return [];
        }
        return Array.from(dialog.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'));
      }
      function restoreFocusAfterDialog() {
        if (!lastDialogTrigger || typeof lastDialogTrigger.focus !== 'function') {
          return false;
        }
        lastDialogTrigger.focus();
        return true;
      }
      function keepDialogFocusInside(event) {
        if (!dialog || !dialog.open || !event || event.key !== 'Tab') {
          return false;
        }
        const focusable = getDialogFocusableElements();
        if (!focusable.length) {
          return false;
        }
        const first = focusable[0];
        const last = focusable[focusable.length - 1];
        const active = document.activeElement;
        if (event.shiftKey && active === first) {
          event.preventDefault();
          last.focus();
          return true;
        }
        if (!event.shiftKey && active === last) {
          event.preventDefault();
          first.focus();
          return true;
        }
        return false;
      }
      function setResult(message) {
        if (!resultNode || typeof message !== 'string' || message.trim().length === 0) {
          return false;
        }
        resultNode.textContent = message;
        return true;
      }
      function getTimeStamp() {
        return new Date().toLocaleTimeString('de-DE');
      }
      function deriveExportWorkflowStatus() {
        const syncText = syncStatusNode && typeof syncStatusNode.textContent === 'string' ? syncStatusNode.textContent.toLowerCase() : '';
        const backupEnabled = readBackupPreference();
        if (syncText.indexOf('alle √§nderungen gespeichert') !== -1 && backupEnabled) {
          return 'release-ready';
        }
        if (syncText.indexOf('gespeichert') !== -1) {
          return 'review-ready';
        }
        return 'in-abstimmung';
      }
      function sanitizeForLinuxFileName(value) {
        if (typeof value !== 'string' || value.trim().length === 0) {
          return 'ohne-inhalt';
        }
        const clean = value.trim().toLowerCase()
          .replace(/[√§]/g, 'ae')
          .replace(/[√∂]/g, 'oe')
          .replace(/[√º]/g, 'ue')
          .replace(/[√ü]/g, 'ss')
          .replace(/[^a-z0-9._-]+/g, '-')
          .replace(/-+/g, '-')
          .replace(/^-|-$/g, '');
        return clean.length > 0 ? clean.slice(0, 60) : 'ohne-inhalt';
      }
      function buildExportFileName(moduleId, profileName) {
        const modulePart = sanitizeForLinuxFileName(moduleId);
        const profilePart = sanitizeForLinuxFileName(profileName);
        const statusPart = deriveExportWorkflowStatus();
        const datePart = new Date().toISOString().slice(0, 10).replace(/-/g, '');
        return [modulePart, profilePart, statusPart, datePart].join('__') + '.json';
      }
      function updateSyncStatus(statusText) {
        if (typeof statusText !== 'string' || statusText.trim().length === 0) {
          return false;
        }
        const fullText = statusText.trim();
        if (syncStatusNode) {
          syncStatusNode.textContent = fullText;
        }
        if (footerSyncStatusNode) {
          footerSyncStatusNode.textContent = fullText.replace(/^‚úÖ\s*/, '');
        }
        return true;
      }
      function setDebugDetails(eventLabel, nextStep) {
        if (typeof eventLabel !== 'string' || eventLabel.trim().length === 0) {
          return false;
        }
        if (typeof nextStep !== 'string' || nextStep.trim().length === 0) {
          return false;
        }
        if (debugEventNode) {
          debugEventNode.textContent = 'Letztes Ereignis: ' + eventLabel.trim() + ' um ' + getTimeStamp() + '.';
        }
        if (debugNextStepNode) {
          debugNextStepNode.textContent = 'N√§chster Schritt: ' + nextStep.trim();
        }
        return true;
      }
      function appendDebugLog(message) {
        if (typeof message !== 'string' || message.trim().length === 0) {
          return false;
        }
        const text = message.trim();
        if (topbarLogListNode) {
          const topItem = document.createElement('li');
          topItem.textContent = text;
          topbarLogListNode.prepend(topItem);
          while (topbarLogListNode.children.length > 10) {
            topbarLogListNode.removeChild(topbarLogListNode.lastElementChild);
          }
        }
        if (!debugLogListNode) {
          return false;
        }
        const listItem = document.createElement('li');
        listItem.textContent = text;
        debugLogListNode.prepend(listItem);
        while (debugLogListNode.children.length > 5) {
          debugLogListNode.removeChild(debugLogListNode.lastElementChild);
        }
        return true;
      }
      function setModuleStatus(message) {
        if (!moduleStatusNode || typeof message !== 'string' || message.trim().length === 0) {
          return false;
        }
        moduleStatusNode.textContent = message.trim();
        return true;
      }
      function setProjectDialogResult(message) {
        if (!projectDialogResultNode || typeof message !== 'string' || message.trim().length === 0) {
          return false;
        }
        projectDialogResultNode.textContent = message.trim();
        return true;
      }
      function copyLogToClipboard() {
        if (!topbarLogListNode || !topbarLogListNode.children.length) {
          return setResult('‚ö†Ô∏è Kein Protokoll vorhanden. Bitte zuerst eine Aktion starten.');
        }
        const text = Array.from(topbarLogListNode.querySelectorAll('li')).map(function (entry) {
          return entry.textContent || '';
        }).join('\n');
        if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard.writeText(text);
          return setResult('‚úÖ Protokoll kopiert.');
        }
        return setResult('‚ö†Ô∏è Kopieren nicht m√∂glich. Bitte Text manuell markieren.');
      }
      function toggleMode() {
        isProMode = !isProMode;
        if (modeSwitchNode) {
          modeSwitchNode.textContent = isProMode ? 'Modus: Profi' : 'Modus: Laie';
          modeSwitchNode.setAttribute('aria-pressed', isProMode ? 'true' : 'false');
        }
        return setResult(isProMode ? '‚úÖ Profi-Modus aktiv: mehr Technikdetails sichtbar.' : '‚úÖ Laien-Modus aktiv: einfache Hinweise sichtbar.');
      }
      function normalizeProjectPath(value) {
        if (typeof value !== 'string') {
          return '';
        }
        return value.trim();
      }
      function validateProjectPath(value) {
        const pathValue = normalizeProjectPath(value);
        if (pathValue.length < 2 || pathValue.startsWith('/') === false) {
          return false;
        }
        return true;
      }
      function hasExtraWhitespaceInPath(value) {
        return typeof value === 'string' && /\s{2,}/.test(value);
      }
      function getStoredProjectPath() {
        const localValue = window.localStorage.getItem('provoware-project-path');
        if (validateProjectPath(localValue)) {
          return normalizeProjectPath(localValue);
        }
        if (validateProjectPath(serverProjectPath)) {
          return normalizeProjectPath(serverProjectPath);
        }
        return '';
      }
      function updateProjectStatus(pathValue) {
        if (!projectStatusNode) {
          return false;
        }
        if (typeof pathValue !== 'string' || pathValue.trim().length === 0) {
          projectStatusNode.textContent = 'Projektordner: noch nicht gesetzt. Bitte im Dialog einen Pfad eingeben.';
          return true;
        }
        projectStatusNode.textContent = 'Projektordner aktiv: ' + pathValue + '.';
        return true;
      }
      function updateFooterContext(pathValue) {
        const validatedPath = typeof pathValue === 'string' && validateProjectPath(pathValue) ? normalizeProjectPath(pathValue) : 'nicht gesetzt';
        const backupEnabled = readBackupPreference();
        if (footerVersionPathNode) {
          footerVersionPathNode.textContent = 'Version: ' + APP_VERSION + ' | Projektpfad: ' + validatedPath;
        }
        if (footerBackupStatusNode) {
          footerBackupStatusNode.textContent = backupEnabled ? 'Auto-Backup: Aktiv' : 'Auto-Backup: Inaktiv. N√§chster Schritt: Backup einschalten.';
        }
        return true;
      }
      function saveProjectPath(pathValue) {
        const normalized = normalizeProjectPath(pathValue);
        if (!validateProjectPath(normalized)) {
          setProjectDialogResult('‚ö†Ô∏è Ung√ºltiger Pfad. Bitte absoluten Pfad eingeben, z. B. /home/name/Ordner.');
          return false;
        }
        if (hasExtraWhitespaceInPath(pathValue)) {
          setProjectDialogResult('‚ö†Ô∏è Pfad gespeichert. Hinweis: Mehrere Leerzeichen erkannt. Bitte kurz pr√ºfen, ob das so gew√ºnscht ist.');
        } else {
          setProjectDialogResult('‚úÖ Pfad gespeichert. N√§chster Schritt: start.sh neu starten, damit die Pr√ºfung und ggf. Erstellung l√§uft.');
        }
        const persisted = persistProjectPath(normalized, 'Dialog');
        if (!persisted) {
          return false;
        }
        setResult('‚úÖ Projektordner im Dashboard aktualisiert.');
        return true;
      }
      function readRecentProjectList() {
        if (!(window.localStorage && typeof window.localStorage.getItem === 'function')) {
          return [];
        }
        const raw = window.localStorage.getItem(RECENT_PROJECT_STORAGE_KEY);
        if (typeof raw !== 'string' || raw.trim().length === 0) {
          return [];
        }
        let parsed;
        try {
          parsed = JSON.parse(raw);
        } catch (error) {
          return [];
        }
        if (!Array.isArray(parsed)) {
          return [];
        }
        const unique = [];
        parsed.forEach(function (entry) {
          if (typeof entry !== 'string') {
            return;
          }
          const normalized = normalizeProjectPath(entry);
          if (!validateProjectPath(normalized) || unique.includes(normalized)) {
            return;
          }
          unique.push(normalized);
        });
        return unique.slice(0, 5);
      }
      function storeRecentProjectList(projectList) {
        if (!(window.localStorage && typeof window.localStorage.setItem === 'function') || !Array.isArray(projectList)) {
          return false;
        }
        const validated = projectList.filter(function (entry) {
          return typeof entry === 'string' && validateProjectPath(entry);
        }).slice(0, 5);
        window.localStorage.setItem(RECENT_PROJECT_STORAGE_KEY, JSON.stringify(validated));
        return true;
      }
      function renderRecentProjectList() {
        if (!recentProjectListNode || !recentProjectStatusNode) {
          return false;
        }
        const projectList = readRecentProjectList();
        recentProjectListNode.innerHTML = '';
        if (!projectList.length) {
          recentProjectStatusNode.textContent = 'Noch kein letzter Projektpfad gespeichert.';
          return true;
        }
        projectList.forEach(function (pathValue, index) {
          const li = document.createElement('li');
          const button = document.createElement('button');
          button.type = 'button';
          button.className = 'recent-projects-button';
          button.setAttribute('data-action', 'project-switch-recent');
          button.setAttribute('data-project-path', pathValue);
          button.setAttribute('aria-label', 'Letztes Projekt ' + String(index + 1) + ': ' + pathValue);
          button.textContent = String(index + 1) + '. ' + pathValue;
          li.appendChild(button);
          recentProjectListNode.appendChild(li);
        });
        recentProjectStatusNode.textContent = 'Zuletzt genutzt: ' + String(projectList.length) + ' Projektpfad(e) verf√ºgbar.';
        return true;
      }
      function persistProjectPath(pathValue, sourceLabel) {
        const normalized = normalizeProjectPath(pathValue);
        if (!validateProjectPath(normalized)) {
          setDebugDetails('Projektpfad ung√ºltig', 'Bitte einen absoluten Pfad eingeben und erneut versuchen.');
          return false;
        }
        window.localStorage.setItem('provoware-project-path', normalized);
        const currentList = readRecentProjectList().filter(function (entry) {
          return entry !== normalized;
        });
        currentList.unshift(normalized);
        storeRecentProjectList(currentList);
        renderRecentProjectList();
        updateProjectStatus(normalized);
        updateFooterContext(normalized);
        if (projectBreadcrumbNode) {
          projectBreadcrumbNode.textContent = 'Projektpfad: ' + normalized;
        }
        if (projectSwitchInput) {
          projectSwitchInput.value = normalized;
        }
        if (projectPathInput) {
          projectPathInput.value = normalized;
        }
        const sourceText = typeof sourceLabel === 'string' && sourceLabel.trim().length > 0 ? sourceLabel.trim() : 'Unbekannt';
        appendDebugLog('‚úÖ Projektpfad aktiv: ' + normalized + ' (' + sourceText + ', ' + getTimeStamp() + ').');
        setDebugDetails('Projektpfad aktualisiert', 'Pfad wurde gespeichert. N√§chster Schritt: Bei Bedarf start.sh neu starten.');
        return true;
      }
      function setActiveNavigation(moduleKey) {
        if (!Array.isArray(navButtonNodes) || typeof moduleKey !== 'string' || moduleKey.trim().length === 0) {
          return false;
        }
        navButtonNodes.forEach(function (buttonNode) {
          if (!(buttonNode instanceof HTMLElement)) {
            return;
          }
          const current = buttonNode.getAttribute('data-module-nav') === moduleKey.trim();
          if (current) {
            buttonNode.setAttribute('aria-current', 'page');
          } else {
            buttonNode.removeAttribute('aria-current');
          }
        });
        return true;
      }
      function readTemplateArchiveState() {
        const fallback = { templates: [], selectedIndex: -1 };
        const raw = window.localStorage.getItem(TEMPLATE_ARCHIVE_STORAGE_KEY);
        if (typeof raw !== 'string' || raw.trim().length === 0) {
          return fallback;
        }
        try {
          const parsed = JSON.parse(raw);
          if (!parsed || typeof parsed !== 'object' || !Array.isArray(parsed.templates)) {
            return fallback;
          }
          const templates = parsed.templates
            .filter(function (entry) {
              return entry && typeof entry === 'object' && typeof entry.title === 'string' && typeof entry.category === 'string' && typeof entry.content === 'string';
            })
            .map(function (entry) {
              return {
                title: entry.title.trim().slice(0, 80),
                category: entry.category.trim().slice(0, 40),
                content: entry.content.trim()
              };
            })
            .filter(function (entry) { return entry.title.length > 0 && entry.content.length > 0; });
          const selectedIndex = Number.isInteger(parsed.selectedIndex) ? parsed.selectedIndex : -1;
          return { templates: templates, selectedIndex: selectedIndex >= 0 && selectedIndex < templates.length ? selectedIndex : -1 };
        } catch (error) {
          appendDebugLog('‚ö†Ô∏è Template-Archiv konnte nicht geladen werden. N√§chster Schritt: Template neu speichern.');
          return fallback;
        }
      }
      function writeTemplateArchiveState(state) {
        if (!state || typeof state !== 'object' || !Array.isArray(state.templates)) {
          return false;
        }
        const payload = JSON.stringify({ templates: state.templates, selectedIndex: state.selectedIndex }, null, 2);
        window.localStorage.setItem(TEMPLATE_ARCHIVE_STORAGE_KEY, payload);
        return window.localStorage.getItem(TEMPLATE_ARCHIVE_STORAGE_KEY) === payload;
      }
      function renderTemplateArchive() {
        const listNode = document.getElementById('template-list');
        const resultNode = document.getElementById('template-result');
        if (!listNode) {
          return false;
        }
        const state = readTemplateArchiveState();
        listNode.innerHTML = '';
        if (!state.templates.length) {
          const li = document.createElement('li');
          li.textContent = 'Noch keine Templates vorhanden. Bitte Titel und Text speichern.';
          listNode.appendChild(li);
          if (resultNode) {
            resultNode.textContent = 'Noch kein Template gespeichert.';
          }
          return true;
        }
        state.templates.forEach(function (entry, index) {
          const li = document.createElement('li');
          const button = document.createElement('button');
          button.type = 'button';
          button.setAttribute('data-template-index', String(index));
          button.className = 'recent-projects-button';
          const info = entry.category.length > 0 ? ' [' + entry.category + ']' : '';
          button.textContent = entry.title + info;
          button.setAttribute('aria-label', 'Template ' + entry.title + '. Kategorie: ' + (entry.category || 'ohne Kategorie') + '. Klick kopiert den Inhalt.');
          if (index === state.selectedIndex) {
            button.setAttribute('aria-current', 'true');
          }
          li.appendChild(button);
          listNode.appendChild(li);
        });
        if (resultNode) {
          resultNode.textContent = 'Templates verf√ºgbar: ' + String(state.templates.length) + '.';
        }
        return true;
      }
      function renderModuleSidebarOptions(moduleKey, sourceMeta) {
        if (!inspectorHelpNode) {
          return false;
        }
        const optionsByModule = {
          'gms-suite': 'Optionen direkt im Untermodul √ºber Symbolleiste: Ausblenden, Maximieren, Einzelfenster.',
          'debug-dev': 'Optionen direkt im Untermodul √ºber Symbolleiste: Ausblenden, Maximieren, Einzelfenster.',
          'todo': 'Optionen direkt im Untermodul √ºber Symbolleiste: Ausblenden, Maximieren, Einzelfenster.',
          'template-archive': 'Optionen direkt im Untermodul √ºber Symbolleiste: Speichern, bearbeiten, als Button kopieren.',
          'quick-archive': 'Optionen direkt im Untermodul √ºber Symbolleiste: Eintrag speichern, neue Maske anlegen, Verlauf pr√ºfen.'
        };
        const helpText = optionsByModule[moduleKey] || 'Bitte Modul w√§hlen und √ºber die Symbolleiste steuern.';
        inspectorHelpNode.textContent = 'Hilfe: ' + helpText;
        if (sourceMeta && inspectorMetaNode) {
          inspectorMetaNode.textContent = 'Meta: Quelle ' + sourceMeta.dataSource + ', letzter Wechsel: ' + getTimeStamp() + '.';
        }
        return true;
      }
      function renderSidebarModuleHints() {
        if (!Array.isArray(navButtonNodes) || navButtonNodes.length === 0) { return false; }
        navButtonNodes.forEach(function (buttonNode) {
          if (!(buttonNode instanceof HTMLElement)) { return; }
          const sourceMeta = getModuleSourceMeta(buttonNode.getAttribute('data-module-nav'));
          if (!sourceMeta) { return; }
          const hint = sourceMeta.detail + ' N√§chster Schritt: ' + sourceMeta.nextStep;
          buttonNode.setAttribute('title', hint);
          buttonNode.setAttribute('aria-label', sourceMeta.label + '. ' + hint);
        });
        return true;
      }
      function normalizeModuleSources(rawValue) {
        if (!rawValue || typeof rawValue !== 'object' || Array.isArray(rawValue)) {
          appendDebugLog('‚ö†Ô∏è Modulquellen fehlen oder sind ung√ºltig. N√§chster Schritt: Start √ºber "bash start.sh" wiederholen.');
          return {};
        }
        return rawValue;
      }
      function getThemePreference() {
        const allowed = ['balanced', 'high-contrast', 'light', 'dark'];
        const htmlTheme = html && typeof html.getAttribute === 'function' ? html.getAttribute('data-theme') : '';
        if (typeof htmlTheme === 'string' && allowed.includes(htmlTheme.trim())) {
          return htmlTheme.trim();
        }
        const selectorTheme = themeSelector && typeof themeSelector.value === 'string' ? themeSelector.value.trim() : '';
        if (allowed.includes(selectorTheme)) {
          return selectorTheme;
        }
        return 'high-contrast';
      }
      function setPluginStatus(selectedModule) {
        if (!pluginStatusListNode || typeof selectedModule !== 'string' || selectedModule.trim().length === 0) {
          return false;
        }
        if (moduleEnabledState[selectedModule] === false) {
          return setResult('‚ö†Ô∏è Modul ist deaktiviert. Bitte zuerst im Modul-Starter aktivieren.');
        }
        const sourceMeta = getModuleSourceMeta(selectedModule);
        const activeLabel = sourceMeta ? sourceMeta.label.trim().toLowerCase() : '';
        const pluginRows = Array.from(pluginStatusListNode.querySelectorAll('.plugin-status-item'));
        if (!pluginRows.length) {
          return false;
        }
        pluginRows.forEach(function (row) {
          if (!(row instanceof HTMLElement)) {
            return;
          }
          const nameNode = row.querySelector('span');
          const statusNode = row.querySelector('.plugin-pill');
          if (!nameNode || !statusNode) {
            return;
          }
          const rowKey = nameNode.textContent ? nameNode.textContent.trim().toLowerCase() : '';
          const isActive = !!activeLabel && rowKey === activeLabel;
          statusNode.textContent = isActive ? 'Aktiv' : 'Wartet';
          statusNode.classList.toggle('plugin-pill-online', isActive);
          statusNode.classList.toggle('plugin-pill-offline', !isActive);
        });
        return true;
      }
      function getModuleSourceMeta(moduleKey) {
        if (typeof moduleKey !== 'string' || moduleKey.trim().length === 0) {
          return null;
        }
        const normalizedKey = moduleKey.trim();
        const localFallback = {
          'gms-suite': { label: 'Genres-Archiv + Zufall + Liste', data_source: 'data/project_context.json', detail: 'Geb√ºndeltes Modul f√ºr Archiv, Zufallsgenerator und Listenpflege im selben Bereich.', next_step: 'Eintr√§ge speichern oder Zufall erzeugen.' },
          'debug-dev': { label: 'Debugging & Entwickleroptionen', data_source: 'logs/status_summary.txt', detail: 'Zeigt Live-Protokoll, Fehlerhilfe und n√§chste technische Schritte.', next_step: 'Bei Fehlern zuerst Log lesen und dann Reparatur starten.' },
          'template-archive': { label: 'Template-Archiv', data_source: 'data/template_archive.json', detail: 'Verwaltet wiederverwendbare Textbausteine inklusive automatischem Kopieren und Protokoll.', next_step: 'Template ausw√§hlen und direkt in Zielwerkzeug einf√ºgen.' },
          'quick-archive': { label: 'Schnell-Speicher-Archiv', data_source: 'data/quick_archive', detail: 'Speichert kurze Ideen, Fachtermini und Recherche-Ergebnisse chronologisch pro Maske.', next_step: 'Titel pr√ºfen, Eintrag speichern und bei Bedarf neue Maske anlegen.' }
        };
        const sourceMeta = (serverModuleSources && typeof serverModuleSources === 'object' && normalizedKey in serverModuleSources) ? serverModuleSources[normalizedKey] : localFallback[normalizedKey];
        if (!sourceMeta) {
          return null;
        }
        if (!sourceMeta || typeof sourceMeta !== 'object') {
          return null;
        }
        const label = typeof sourceMeta.label === 'string' ? sourceMeta.label.trim() : '';
        const dataSource = typeof sourceMeta.data_source === 'string' ? sourceMeta.data_source.trim() : '';
        const detail = typeof sourceMeta.detail === 'string' ? sourceMeta.detail.trim() : '';
        const nextStep = typeof sourceMeta.next_step === 'string' ? sourceMeta.next_step.trim() : '';
        if (!label || !dataSource || !detail || !nextStep) {
          appendDebugLog('‚ö†Ô∏è Modulquelle unvollst√§ndig f√ºr "' + normalizedKey + '". N√§chster Schritt: config/module_sources.json pr√ºfen.');
          return null;
        }
        return { label: label, dataSource: dataSource, detail: detail, nextStep: nextStep };
      }
      function renderModulePreview(selectedModule) {
        const previewNode = document.getElementById('module-source-preview');
        if (!(previewNode instanceof HTMLElement)) {
          return false;
        }
        if (moduleEnabledState[selectedModule] === false) {
          return setResult('‚ö†Ô∏è Modul ist deaktiviert. Bitte zuerst im Modul-Starter aktivieren.');
        }
        const sourceMeta = getModuleSourceMeta(selectedModule);
        if (!sourceMeta) {
          previewNode.textContent = 'Kurzdetails: Keine g√ºltige Modulauswahl. N√§chster Schritt: Modul w√§hlen und erneut versuchen.';
          return false;
        }
        previewNode.textContent = 'Kurzdetails: ' + sourceMeta.detail + ' Datenquelle: ' + sourceMeta.dataSource + '. N√§chster Schritt: ' + sourceMeta.nextStep + '.';
        return true;
      }
      function switchActiveModulePanel(moduleKey) {
        if (typeof moduleKey !== 'string') {
          return false;
        }
        const activePanel = document.getElementById(moduleKey + '-view');
        if (!(activePanel instanceof HTMLElement)) {
          return false;
        }
        const occupied = new Set(Object.values(moduleSlots));
        let slot = moduleSlots[moduleKey] || null;
        if (!slot) {
          slot = moduleGridCells.find(function (cell) { return !occupied.has(Number(cell.getAttribute('data-slot-index'))); });
        }
        if (!slot) {
          setResult('‚ö†Ô∏è Kein freier Grid-Platz mehr. Bitte zuerst ein Untermodul ausblenden.');
          return false;
        }
        const slotIndex = Number(slot.getAttribute('data-slot-index'));
        moduleSlots[moduleKey] = slotIndex;
        const label = slot.querySelector('.grid-slot-label');
        if (label) { label.remove(); }
        activePanel.classList.add('active');
        activePanel.setAttribute('data-maximized','false');
        slot.appendChild(activePanel);
        activeModuleKey = moduleKey;
        setMaximizedModule('');
        const hasActive = Object.keys(moduleSlots).length > 0;
        if (moduleStageEmptyNode instanceof HTMLElement) {
          moduleStageEmptyNode.hidden = hasActive;
        }
        return true;
      }
      function setMaximizedModule(moduleKey) {
        const normalized = typeof moduleKey === 'string' ? moduleKey.trim() : '';
        const hasValidSlot = normalized && moduleSlots[normalized];
        const currentPanel = normalized ? document.getElementById(normalized + '-view') : null;
        const isAlreadyMaximized = currentPanel instanceof HTMLElement && currentPanel.getAttribute('data-maximized') === 'true';
        const shouldMaximize = !!hasValidSlot && !isAlreadyMaximized;
        if (moduleGridNode instanceof HTMLElement) {
          moduleGridNode.setAttribute('data-maximized', shouldMaximize ? 'true' : 'false');
        }
        modulePanelNodes.forEach(function (panel) {
          if (panel instanceof HTMLElement) {
            panel.setAttribute('data-maximized', 'false');
          }
        });
        if (shouldMaximize && currentPanel instanceof HTMLElement) {
          currentPanel.setAttribute('data-maximized', 'true');
        }
        moduleGridCells.forEach(function (cell) {
          const slotIndex = Number(cell.getAttribute('data-slot-index'));
          const targetSlot = shouldMaximize ? Number(moduleSlots[normalized]) : null;
          const isTarget = shouldMaximize && slotIndex === targetSlot;
          cell.classList.toggle('is-maximized-slot', !!isTarget);
          cell.classList.toggle('is-hidden-slot', !!shouldMaximize && !isTarget);
        });
        return shouldMaximize;
      }
      function openModule(selectedModule) {
        if (moduleEnabledState[selectedModule] === false) {
          return setResult('‚ö†Ô∏è Modul ist deaktiviert. Bitte zuerst im Modul-Starter aktivieren.');
        }
        const sourceMeta = getModuleSourceMeta(selectedModule);
        if (typeof selectedModule !== 'string' || !sourceMeta) {
          setDebugDetails('Modulstart fehlgeschlagen', 'Bitte zuerst ein Modul ausw√§hlen und dann erneut ‚ÄûModul √∂ffnen‚Äú dr√ºcken.');
          appendDebugLog('‚ö†Ô∏è Modulstart abgebrochen: Keine g√ºltige Auswahl oder fehlende Datenquelle.');
          setModuleStatus('‚ö†Ô∏è Kein Modul gestartet: Bitte ein Modul ausw√§hlen.');
          return setResult('‚ö†Ô∏è Modul konnte nicht ge√∂ffnet werden. Bitte Auswahl und Datenquelle pr√ºfen.');
        }
        const statusText = '‚úÖ Modul aktiv: ' + sourceMeta.label + '. Datenquelle: ' + sourceMeta.dataSource + '.';
        const debugTitle = 'Modul gewechselt zu ' + sourceMeta.label;
        const debugStep = sourceMeta.detail + ' N√§chster Schritt: ' + sourceMeta.nextStep;
        setModuleStatus(statusText);
        renderModulePreview(selectedModule);
        switchActiveModulePanel(selectedModule);
        setActiveNavigation(selectedModule);
        setPluginStatus(selectedModule);
        renderModuleSidebarOptions(selectedModule, sourceMeta);
        if (inspectorDetailsNode) { inspectorDetailsNode.textContent = 'Details: ' + sourceMeta.label + ' ist aktiv. Status: Bereit.'; }
        if (inspectorHelpNode) { inspectorHelpNode.textContent = 'Hilfe: ' + sourceMeta.nextStep; }
        if (inspectorMetaNode) { inspectorMetaNode.textContent = 'Meta: Quelle ' + sourceMeta.dataSource + ', letzter Wechsel: ' + getTimeStamp() + '.'; }
        setDebugDetails(debugTitle, debugStep);
        appendDebugLog('‚úÖ Modul geladen: ' + sourceMeta.label + ' | Datenquelle: ' + sourceMeta.dataSource + ' (' + getTimeStamp() + ').');
        updateSyncStatus('‚úÖ Modul bereit: ' + sourceMeta.label + ' (' + getTimeStamp() + ')');
        return setResult('‚úÖ Modul ge√∂ffnet: ' + sourceMeta.label + '. Datenquelle: ' + sourceMeta.dataSource + '.');
      }
      function applyTheme(themeValue) {
        const allowed = ['balanced', 'high-contrast', 'light', 'dark'];
        if (typeof themeValue !== 'string' || !allowed.includes(themeValue)) {
          setResult('‚ö†Ô∏è Ung√ºltiges Theme. Erlaubt sind: balanced, high-contrast, light, dark.');
          return false;
        }
        const helperTextByTheme = {
          balanced: 'Aktives Theme: balanced. Ruhige Farben mit klarer Lesbarkeit.',
          'high-contrast': 'Aktives Theme: high-contrast. Empfohlen f√ºr maximalen Kontrast.',
          light: 'Aktives Theme: light. Bitte Fokusrahmen gut sichtbar pr√ºfen.',
          dark: 'Aktives Theme: dark. Bitte Helligkeit und Lesbarkeit kurz pr√ºfen.'
        };
        html.setAttribute('data-theme', themeValue);
        if (themeStatusNode) {
          themeStatusNode.textContent = helperTextByTheme[themeValue] || 'Aktives Theme ge√§ndert.';
        }
        setDebugDetails('Theme ge√§ndert', 'Pr√ºfen Sie kurz Lesbarkeit, Fokusrahmen und Symboltexte im gew√§hlten Theme.');
        appendDebugLog('‚ÑπÔ∏è Theme aktiv: ' + themeValue + ' (' + getTimeStamp() + ').');
        setResult('‚úÖ Theme wurde gesetzt: ' + themeValue + '.');
        return true;
      }
      function setCardState(node, stateValue, plainText) {
        const allowed = ['ready', 'loading', 'error'];
        if (!(node instanceof HTMLElement) || typeof plainText !== 'string' || !allowed.includes(stateValue)) {
          return false;
        }
        node.setAttribute('data-state', stateValue);
        node.textContent = 'Status: ' + plainText;
        return true;
      }
      function readFontScalePreference() {
        if (!(window.localStorage && typeof window.localStorage.getItem === 'function')) {
          return 'm';
        }
        const saved = window.localStorage.getItem(FONT_SCALE_STORAGE_KEY);
        const allowed = ['s', 'm', 'l', 'xl'];
        return typeof saved === 'string' && allowed.includes(saved) ? saved : 'm';
      }
      function applyFontScale(scaleValue) {
        const allowed = { s: '0.94', m: '1', l: '1.1', xl: '1.2' };
        if (typeof scaleValue !== 'string' || !Object.prototype.hasOwnProperty.call(allowed, scaleValue)) {
          setResult('‚ö†Ô∏è Ung√ºltige Textgr√∂√üe. Bitte S, M, L oder XL w√§hlen.');
          return false;
        }
        html.style.fontSize = allowed[scaleValue] + 'rem';
        if (fontScaleSelector) {
          fontScaleSelector.value = scaleValue;
        }
        if (fontScaleStatusNode) {
          const labels = { s: 'S (kompakt)', m: 'M (standard)', l: 'L (gr√∂√üer)', xl: 'XL (sehr gro√ü)' };
          fontScaleStatusNode.textContent = 'Textgr√∂√üe: ' + labels[scaleValue] + '.';
        }
        if (window.localStorage && typeof window.localStorage.setItem === 'function') {
          window.localStorage.setItem(FONT_SCALE_STORAGE_KEY, scaleValue);
        }
        return true;
      }
      function readBackupPreference() {
        if (!(window.localStorage && typeof window.localStorage.getItem === 'function')) {
          return true;
        }
        const rawValue = window.localStorage.getItem(BACKUP_STORAGE_KEY);
        if (rawValue === null) {
          return true;
        }
        if (rawValue !== 'true' && rawValue !== 'false') {
          appendDebugLog('‚ö†Ô∏è Backup-Einstellung war ung√ºltig. N√§chster Schritt: Einstellung wird automatisch auf Aktiv gesetzt.');
          window.localStorage.setItem(BACKUP_STORAGE_KEY, 'true');
          return true;
        }
        return rawValue === 'true';
      }
      function applyBackupPreference(isEnabled, sourceLabel) {
        if (typeof isEnabled !== 'boolean') {
          setResult('‚ö†Ô∏è Backup-Einstellung ist ung√ºltig. Bitte erneut versuchen.');
          return false;
        }
        if (window.localStorage && typeof window.localStorage.setItem === 'function') {
          window.localStorage.setItem(BACKUP_STORAGE_KEY, String(isEnabled));
        }
        if (backupToggleNode) {
          backupToggleNode.checked = isEnabled;
        }
        if (backupStatusNode) {
          backupStatusNode.textContent = isEnabled ? 'Auto-Backup: Aktiv. √Ñnderungen werden zus√§tzlich gesichert.' : 'Auto-Backup: Inaktiv. N√§chster Schritt: Bitte manuell speichern oder Backup wieder aktivieren.';
        }
        updateFooterContext(getStoredProjectPath());
        const sourceText = typeof sourceLabel === 'string' && sourceLabel.trim().length > 0 ? sourceLabel.trim() : 'Unbekannt';
        appendDebugLog('‚ÑπÔ∏è Backup-Einstellung: ' + (isEnabled ? 'aktiv' : 'inaktiv') + ' (' + sourceText + ', ' + getTimeStamp() + ').');
        return true;
      }
      function saveLayoutProfile() {
        if (!(shellNode instanceof HTMLElement)) {
          return false;
        }
        const profile = {
          width: shellNode.style.width || '',
          margin: shellNode.style.margin || '',
          opacity: shellNode.style.opacity || ''
        };
        if (!(window.localStorage && typeof window.localStorage.setItem === 'function')) {
          setResult('‚ö†Ô∏è Layout kann hier nicht gespeichert werden.');
          return false;
        }
        window.localStorage.setItem(LAYOUT_STORAGE_KEY, JSON.stringify(profile));
        return true;
      }
      function restoreLayoutProfile() {
        if (!(shellNode instanceof HTMLElement) || !(window.localStorage && typeof window.localStorage.getItem === 'function')) {
          return false;
        }
        const raw = window.localStorage.getItem(LAYOUT_STORAGE_KEY);
        if (typeof raw !== 'string' || raw.trim().length === 0) {
          setResult('‚ö†Ô∏è Kein gespeichertes Layout gefunden. Bitte zuerst ‚ÄûLayout speichern‚Äú nutzen.');
          return false;
        }
        let profile;
        try {
          profile = JSON.parse(raw);
        } catch (error) {
          setResult('‚ö†Ô∏è Gespeichertes Layout ist besch√§digt. Bitte neu speichern.');
          return false;
        }
        if (!profile || typeof profile !== 'object') {
          setResult('‚ö†Ô∏è Layoutdaten ung√ºltig. Bitte neu speichern.');
          return false;
        }
        shellNode.style.width = typeof profile.width === 'string' ? profile.width : '';
        shellNode.style.margin = typeof profile.margin === 'string' ? profile.margin : '';
        shellNode.style.opacity = typeof profile.opacity === 'string' ? profile.opacity : '';
        return true;
      }
      function executeAction(actionValue) {
        const known = ['save', 'retry', 'repair', 'log', 'error', 'close-dialog', 'open-module', 'project-setup', 'project-save', 'project-close', 'open-shortcuts', 'close-shortcuts', 'project-switch', 'project-switch-recent', 'copy-log', 'switch-mode', 'export-all-data', 'window-hide', 'window-maximize', 'window-reset', 'window-detach', 'layout-save', 'layout-restore', 'gms-add', 'gms-random', 'gms-copy-random', 'gms-copy-history', 'gms-clear-history', 'gms-export', 'gms-import-demo', 'gms-profile-switch', 'gms-profile-create', 'gms-entry-delete', 'gms-entry-rename', 'gms-entry-pick', 'todo-add', 'todo-toggle', 'todo-delete', 'template-add', 'template-update', 'template-delete', 'quick-archive-save', 'quick-archive-new-mask', 'module-toggle'];
        if (typeof actionValue !== 'string' || !known.includes(actionValue)) {
          return setResult('‚ö†Ô∏è Unbekannte Aktion. Bitte pr√ºfen Sie den Button.');
        }
        if (actionValue.startsWith('gms-')) {
          return gmsPlugin.handleAction(actionValue);
        }
        if (actionValue === 'open-module') {
          const selectedValue = moduleSelector && typeof moduleSelector.value === 'string' ? moduleSelector.value.trim() : '';
          return openModule(selectedValue);
        }
        if (actionValue === 'project-setup') {
          if (projectDialog && typeof projectDialog.showModal === 'function') {
            projectDialog.showModal();
            if (projectPathInput) {
              projectPathInput.value = getStoredProjectPath();
              projectPathInput.focus();
            }
            return setResult('‚ÑπÔ∏è Projekt-Routine ge√∂ffnet. Bitte Pfad pr√ºfen und speichern.');
          }
          return setResult('‚ö†Ô∏è Projekt-Routine kann in diesem Browser nicht als Dialog ge√∂ffnet werden.');
        }
        if (actionValue === 'project-save') {
          const userPath = projectPathInput ? projectPathInput.value : '';
          return saveProjectPath(userPath);
        }
        if (actionValue === 'project-close') {
          if (projectDialog && typeof projectDialog.close === 'function') {
            projectDialog.close();
          }
          return setResult('‚ÑπÔ∏è Projekt-Routine geschlossen. Sie k√∂nnen sp√§ter fortsetzen.');
        }
        if (actionValue === 'open-shortcuts') { return openShortcutOverlay(); }
        if (actionValue === 'close-shortcuts') { return closeShortcutOverlay(); }
        if (actionValue === 'project-switch') { return applyProjectSwitch(); }
        if (actionValue === 'project-switch-recent') {
          return setResult('‚ÑπÔ∏è Bitte einen Eintrag aus der Liste direkt anklicken.');
        }
        if (actionValue === 'copy-log') { return copyLogToClipboard(); }
        if (actionValue === 'export-all-data') {
          const archive = readTemplateArchiveState();
          const exportData = {
            exported_at: new Date().toISOString(),
            project_path: getStoredProjectPath(),
            recent_projects: readRecentProjectList(),
            template_archive: archive.templates,
            gms_profile: gmsPlugin && typeof gmsPlugin.exportPayload === 'function' ? gmsPlugin.exportPayload() : null,
            todo_list: Array.isArray(window.__todoState) ? window.__todoState : []
          };
          const payload = JSON.stringify(exportData, null, 2);
          if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(payload);
            appendDebugLog('‚úÖ Gesamt-Daten-Export erstellt und kopiert (' + getTimeStamp() + ').');
            return setResult('‚úÖ Gesamt-Daten-Export kopiert. N√§chster Schritt: In Datei sichern.');
          }
          return setResult('‚ö†Ô∏è Export erstellt, aber Kopieren ist im Browser blockiert. Bitte manuell sichern.');
        }
        if (actionValue === 'switch-mode') { return toggleMode(); }
        if (actionValue === 'window-hide') {
          if (!activeModuleKey || !moduleSlots[activeModuleKey]) {
            return setResult('‚ö†Ô∏è Kein aktives Untermodul im Grid. Bitte zuerst ein Modul √∂ffnen.');
          }
          const panel = document.getElementById(activeModuleKey + '-view');
          const slotIndex = moduleSlots[activeModuleKey];
          const slotNode = moduleGridCells.find(function (cell) { return Number(cell.getAttribute('data-slot-index')) === slotIndex; });
          if (panel instanceof HTMLElement) {
            panel.classList.remove('active');
            moduleGridNode.appendChild(panel);
          }
          if (slotNode instanceof HTMLElement) {
            slotNode.innerHTML = '<div class="grid-slot-label">Feld ' + slotIndex + ' (frei)</div>';
          }
          delete moduleSlots[activeModuleKey];
          setMaximizedModule('');
          activeModuleKey = '';
          return setResult('‚úÖ Untermodul aus dem Grid ausgeblendet.');
        }
        if (actionValue === 'window-maximize') {
          if (!activeModuleKey || !moduleSlots[activeModuleKey]) {
            return setResult('‚ö†Ô∏è Kein aktives Untermodul im Grid. Bitte zuerst ein Modul √∂ffnen.');
          }
          setMaximizedModule(activeModuleKey);
          return setResult('‚úÖ Maximiert/Wiederhergestellt abgeschlossen. Untermodul wurde dynamisch auf Bildschirmgr√∂√üe angepasst.');
        }
        if (actionValue === 'window-reset') {
          modulePanelNodes.forEach(function (panel) {
            panel.style.transform = '';
            panel.style.borderWidth = '';
          });
          setMaximizedModule('');
          return setResult('‚úÖ Grid-Sicht wiederhergestellt.');
        }
        if (actionValue === 'layout-save') {
          if (saveLayoutProfile()) {
            return setResult('‚úÖ Layout gespeichert. N√§chster Schritt: Bei Bedarf ‚ÄûGespeichertes Layout laden‚Äú nutzen.');
          }
          return setResult('‚ö†Ô∏è Layout konnte nicht gespeichert werden.');
        }
        if (actionValue === 'layout-restore') {
          if (restoreLayoutProfile()) {
            return setResult('‚úÖ Gespeichertes Layout geladen.');
          }
          return false;
        }
        if (actionValue === 'window-detach') {
          const selected = activeModuleKey || (moduleSelector && typeof moduleSelector.value === 'string' ? moduleSelector.value.trim() : '');
          const sourceMeta = getModuleSourceMeta(selected);
          if (!sourceMeta) {
            return setResult('‚ö†Ô∏è Erst ein Modul w√§hlen und √∂ffnen, dann Einzelfenster starten.');
          }
          const windowId = 'module_' + selected;
          const featureString = 'width=760,height=580,resizable=yes,scrollbars=yes';
          const detached = window.open('', windowId, featureString);
          if (!detached) {
            return setResult('‚ö†Ô∏è Einzelfenster blockiert. Bitte Pop-up erlauben und erneut versuchen.');
          }
          detachedWindows[windowId] = detached;
          detached.document.title = 'Einzelfenster: ' + sourceMeta.label;
          detached.document.body.textContent = '';
          const mainNode = detached.document.createElement('main');
          mainNode.style.fontFamily = 'Arial, sans-serif';
          mainNode.style.padding = '1rem';
          const titleNode = detached.document.createElement('h1');
          titleNode.textContent = sourceMeta.label;
          const sourceNode = detached.document.createElement('p');
          sourceNode.textContent = 'Datenquelle: ' + sourceMeta.dataSource;
          const detailNode = detached.document.createElement('p');
          detailNode.textContent = sourceMeta.detail;
          const nextStepNode = detached.document.createElement('p');
          nextStepNode.textContent = 'N√§chster Schritt: ' + sourceMeta.nextStep;
          mainNode.appendChild(titleNode);
          mainNode.appendChild(sourceNode);
          mainNode.appendChild(detailNode);
          mainNode.appendChild(nextStepNode);
          detached.document.body.appendChild(mainNode);
          return setResult('‚úÖ Einzelfenster ge√∂ffnet f√ºr ' + sourceMeta.label + '.');
        }
        if (actionValue === 'template-add' || actionValue === 'template-update' || actionValue === 'template-delete') {
          const titleNode = document.getElementById('template-title-input');
          const categoryNode = document.getElementById('template-category-input');
          const contentNode = document.getElementById('template-content-input');
          const feedbackNode = document.getElementById('template-result');
          const archive = readTemplateArchiveState();
          const selectedIndex = Number.isInteger(archive.selectedIndex) ? archive.selectedIndex : -1;
          const title = titleNode && typeof titleNode.value === 'string' ? titleNode.value.trim() : '';
          const category = categoryNode && typeof categoryNode.value === 'string' ? categoryNode.value.trim() : '';
          const content = contentNode && typeof contentNode.value === 'string' ? contentNode.value.trim() : '';
          if (actionValue !== 'template-delete' && (title.length < 2 || content.length < 2)) {
            if (feedbackNode) {
              feedbackNode.textContent = '‚ö†Ô∏è Bitte Titel und Textinhalt mit mindestens 2 Zeichen eintragen.';
            }
            return true;
          }
          if (actionValue === 'template-add') {
            archive.templates.push({ title: title.slice(0, 80), category: category.slice(0, 40), content: content });
            archive.selectedIndex = archive.templates.length - 1;
          }
          if (actionValue === 'template-update') {
            if (selectedIndex < 0 || !archive.templates[selectedIndex]) {
              if (feedbackNode) { feedbackNode.textContent = '‚ö†Ô∏è Bitte zuerst ein Template √ºber einen Button ausw√§hlen.'; }
              return true;
            }
            archive.templates[selectedIndex] = { title: title.slice(0, 80), category: category.slice(0, 40), content: content };
          }
          if (actionValue === 'template-delete') {
            if (selectedIndex < 0 || !archive.templates[selectedIndex]) {
              if (feedbackNode) { feedbackNode.textContent = '‚ö†Ô∏è Bitte zuerst ein Template f√ºr das L√∂schen ausw√§hlen.'; }
              return true;
            }
            archive.templates.splice(selectedIndex, 1);
            archive.selectedIndex = -1;
          }
          if (!writeTemplateArchiveState(archive)) {
            if (feedbackNode) { feedbackNode.textContent = '‚ö†Ô∏è Speichern fehlgeschlagen. Bitte erneut versuchen.'; }
            return true;
          }
          if (titleNode && actionValue !== 'template-update') { titleNode.value = ''; }
          if (categoryNode && actionValue !== 'template-update') { categoryNode.value = ''; }
          if (contentNode && actionValue !== 'template-update') { contentNode.value = ''; }
          renderTemplateArchive();
          appendDebugLog('‚úÖ Template-Archiv aktualisiert: Aktion ' + actionValue + ' (' + getTimeStamp() + ').');
          if (feedbackNode) { feedbackNode.textContent = '‚úÖ Aktion abgeschlossen: ' + actionValue + '.'; }
          return true;
        }
        if (actionValue === 'todo-add' || actionValue === 'todo-toggle' || actionValue === 'todo-delete') {
          const todoInput = document.getElementById('todo-input');
          const todoDate = document.getElementById('todo-date');
          const todoList = document.getElementById('todo-list');
          const todoResult = document.getElementById('todo-result');
          if (!(todoList instanceof HTMLElement) || !(todoResult instanceof HTMLElement)) {
            return setResult('‚ö†Ô∏è To-Do-Modul nicht bereit. Bitte neu laden.');
          }
          if (!window.__todoItems) {
            window.__todoItems = [];
            window.__todoSelected = -1;
          }
          if (actionValue === 'todo-add') {
            const text = todoInput && typeof todoInput.value === 'string' ? todoInput.value.trim() : '';
            const due = todoDate && typeof todoDate.value === 'string' ? todoDate.value : '';
            if (!text) {
              todoResult.textContent = '‚ö†Ô∏è Bitte zuerst eine Aufgabe eingeben.';
              return true;
            }
            window.__todoItems.push({ text: text, due: due, done: false });
            if (todoInput) { todoInput.value = ''; }
            todoResult.textContent = '‚úÖ To-Do hinzugef√ºgt.';
          }
          if (actionValue === 'todo-toggle') {
            if (window.__todoSelected < 0 || !window.__todoItems[window.__todoSelected]) {
              todoResult.textContent = '‚ö†Ô∏è Bitte zuerst eine Aufgabe ausw√§hlen.';
              return true;
            }
            const item = window.__todoItems[window.__todoSelected];
            item.done = !item.done;
            todoResult.textContent = item.done ? '‚úÖ Aufgabe als erledigt markiert.' : '‚ÑπÔ∏è Aufgabe wieder offen.';
          }
          if (actionValue === 'todo-delete') {
            if (window.__todoSelected < 0 || !window.__todoItems[window.__todoSelected]) {
              todoResult.textContent = '‚ö†Ô∏è Bitte zuerst eine Aufgabe ausw√§hlen.';
              return true;
            }
            window.__todoItems.splice(window.__todoSelected, 1);
            window.__todoSelected = -1;
            todoResult.textContent = '‚úÖ Aufgabe entfernt.';
          }
          todoList.innerHTML = '';
          window.__todoItems.forEach(function (item, index) {
            const li = document.createElement('li');
            li.className = 'drag-item';
            li.setAttribute('data-todo-index', String(index));
            li.setAttribute('aria-selected', window.__todoSelected === index ? 'true' : 'false');
            li.textContent = (item.done ? '‚úÖ ' : '‚¨ú ') + item.text + (item.due ? ' (f√§llig: ' + item.due + ')' : '');
            todoList.appendChild(li);
          });
          return true;
        }

        if (actionValue === 'module-toggle') {
          return setResult('‚ÑπÔ∏è Modul-Umschaltung wird √ºber den Modul-Button gesteuert.');
        }
        if (actionValue === 'quick-archive-save' || actionValue === 'quick-archive-new-mask') {
          const titleNode = document.getElementById('quick-archive-title-input');
          const pathNode = document.getElementById('quick-archive-path-input');
          const textNode = document.getElementById('quick-archive-text-input');
          const resultNodeLocal = document.getElementById('quick-archive-result');
          const state = readQuickArchiveState();
          const title = titleNode && typeof titleNode.value === 'string' ? titleNode.value.trim() : '';
          const normalizedTitle = normalizeArchiveTitle(title || 'Eingabe Fachtermini');
          const pathValue = pathNode && typeof pathNode.value === 'string' && pathNode.value.trim().length > 0 ? pathNode.value.trim() : quickArchiveFallbackPath;
          if (actionValue === 'quick-archive-new-mask') {
            if (!normalizedTitle) {
              if (resultNodeLocal) { resultNodeLocal.textContent = '‚ö†Ô∏è Bitte erst einen Titel eingeben.'; }
              return true;
            }
            if (!state.masks[normalizedTitle]) {
              state.masks[normalizedTitle] = { title: title || 'Eingabe Fachtermini', path: pathValue, entries: [] };
            }
            state.selectedMask = normalizedTitle;
            writeQuickArchiveState(state);
            renderQuickArchive();
            if (resultNodeLocal) { resultNodeLocal.textContent = '‚úÖ Neue Maske angelegt: ' + (title || 'Eingabe Fachtermini') + '.'; }
            return true;
          }
          const textValue = textNode && typeof textNode.value === 'string' ? textNode.value.trim() : '';
          if (textValue.length < 2) {
            if (resultNodeLocal) { resultNodeLocal.textContent = '‚ö†Ô∏è Bitte mindestens 2 Zeichen eingeben.'; }
            return true;
          }
          if (!state.masks[normalizedTitle]) {
            state.masks[normalizedTitle] = { title: title || 'Eingabe Fachtermini', path: pathValue, entries: [] };
          }
          state.selectedMask = normalizedTitle;
          state.masks[normalizedTitle].title = title || 'Eingabe Fachtermini';
          state.masks[normalizedTitle].path = pathValue;
          state.masks[normalizedTitle].entries.push({ text: textValue, time: getTimeStamp() });
          writeQuickArchiveState(state);
          if (textNode) { textNode.value = ''; }
          renderQuickArchive();
          if (resultNodeLocal) { resultNodeLocal.textContent = '‚úÖ Eintrag gespeichert in ' + (title || 'Eingabe Fachtermini') + ' (' + normalizedTitle + '.txt).'; }
          return true;
        }

        if (actionValue === 'save') {
          const message = '‚úÖ Gespeichert um ' + getTimeStamp() + '.';
          updateSyncStatus('‚úÖ Alle √Ñnderungen gespeichert (' + getTimeStamp() + ')');
      setCardState(projectCardStateNode, 'ready', 'Bereit');
          setDebugDetails('Speichern abgeschlossen', 'Sie k√∂nnen jetzt sicher weiterarbeiten oder mit Alt+L das Protokoll √∂ffnen.');
          return setResult(message);
        }
        if (actionValue === 'retry') {
          updateSyncStatus('‚úÖ Aktion erneut bereit (' + getTimeStamp() + ')');
          setDebugDetails('Erneut versuchen vorbereitet', 'F√ºhren Sie die gew√ºnschte Aktion jetzt erneut aus.');
          return setResult('‚û°Ô∏è Erneut versuchen wurde vorbereitet. Aktion jetzt wiederholen.');
        }
        if (actionValue === 'repair') {
          setDebugDetails('Reparatur empfohlen', 'F√ºhren Sie ./start.sh --repair aus und pr√ºfen Sie danach den Statusbericht.');
          return setResult('‚û°Ô∏è Reparaturhinweis: Starten Sie ./start.sh --repair');
        }
        if (actionValue === 'log') {
          setDebugDetails('Protokollhilfe ge√∂ffnet', '√ñffnen Sie logs/start.log und suchen Sie nach der letzten ‚ùå-Meldung.');
          return setResult('‚û°Ô∏è Protokollhinweis: √ñffnen Sie logs/start.log');
        }
        if (actionValue === 'error') {
          setCardState(debugCardStateNode, 'error', 'Fehlerhinweis aktiv');
          if (dialog && typeof dialog.showModal === 'function') {
            lastDialogTrigger = document.activeElement instanceof HTMLElement ? document.activeElement : null;
            dialog.showModal();
            const firstDialogButton = getDialogFocusableElements()[0];
            if (firstDialogButton && typeof firstDialogButton.focus === 'function') {
              firstDialogButton.focus();
            }
            setDebugDetails('Fehlerdialog ge√∂ffnet', 'W√§hlen Sie im Dialog zuerst ‚ÄûErneut versuchen‚Äú und pr√ºfen Sie danach das Protokoll.');
            return setResult('‚ùå Fehlerdialog ge√∂ffnet. Bitte n√§chsten Schritt w√§hlen.');
          }
          setDebugDetails('Fehlerdialog fehlgeschlagen', 'Browser aktualisieren und Aktion erneut ausf√ºhren.');
          return setResult('‚ö†Ô∏è Fehlerdialog konnte nicht ge√∂ffnet werden. Browser pr√ºfen.');
        }
        if (actionValue === 'close-dialog') {
          if (dialog && typeof dialog.close === 'function') {
            dialog.close();
            restoreFocusAfterDialog();
            setDebugDetails('Fehlerdialog geschlossen', 'Sie k√∂nnen jetzt ohne Dialog weiterarbeiten.');
            return setResult('‚úÖ Fehlerdialog geschlossen.');
          }
          setDebugDetails('Dialog konnte nicht schlie√üen', 'Seite neu laden und Aktion wiederholen.');
          return setResult('‚ö†Ô∏è Dialog konnte nicht geschlossen werden.');
        }
        return false;
      }

      function detectGridByScreen() {
        const width = window.innerWidth || 1280;
        const height = window.innerHeight || 720;
        if (width < 900 || height < 620) {
          return { cols: 1, rows: 9 };
        }
        if (width < 1320 || height < 760) {
          return { cols: 2, rows: 5 };
        }
        return { cols: 3, rows: 3 };
      }
      function applyDynamicGridByScreen() {
        if (!(moduleGridNode instanceof HTMLElement)) {
          return false;
        }
        const layout = detectGridByScreen();
        moduleGridNode.style.setProperty('--grid-cols', String(layout.cols));
        moduleGridNode.style.setProperty('--grid-rows', String(layout.rows));
        return true;
      }
      function normalizeArchiveTitle(rawValue) {
        const source = typeof rawValue === 'string' ? rawValue.trim() : '';
        if (!source) {
          return '';
        }
        return source.toLowerCase().replace(/[^a-z0-9√§√∂√º√ü\-_\s]/gi, '').replace(/\s+/g, '_').slice(0, 60);
      }
      function readQuickArchiveState() {
        const fallback = {
          selectedMask: 'eingabe_fachtermini',
          masks: {
            eingabe_fachtermini: { title: 'Eingabe Fachtermini', path: quickArchiveFallbackPath, entries: [] }
          }
        };
        const raw = window.localStorage.getItem(QUICK_ARCHIVE_STORAGE_KEY);
        if (typeof raw !== 'string' || raw.trim().length === 0) {
          return fallback;
        }
        try {
          const parsed = JSON.parse(raw);
          if (!parsed || typeof parsed !== 'object' || !parsed.masks || typeof parsed.masks !== 'object') {
            return fallback;
          }
          return parsed;
        } catch (error) {
          return fallback;
        }
      }
      function writeQuickArchiveState(state) {
        if (!state || typeof state !== 'object' || !state.masks || typeof state.masks !== 'object') {
          return false;
        }
        window.localStorage.setItem(QUICK_ARCHIVE_STORAGE_KEY, JSON.stringify(state));
        return true;
      }
      function renderQuickArchive() {
        const state = readQuickArchiveState();
        const maskListNode = document.getElementById('quick-archive-mask-list');
        const historyNode = document.getElementById('quick-archive-history');
        const titleInput = document.getElementById('quick-archive-title-input');
        const pathInput = document.getElementById('quick-archive-path-input');
        if (!(maskListNode instanceof HTMLElement) || !(historyNode instanceof HTMLElement)) {
          return false;
        }
        maskListNode.innerHTML = '';
        Object.keys(state.masks).forEach(function (key) {
          const item = state.masks[key];
          const button = document.createElement('button');
          button.type = 'button';
          button.className = 'recent-projects-button';
          button.setAttribute('data-quick-archive-mask', key);
          button.textContent = (state.selectedMask === key ? '‚úÖ ' : 'üìÅ ') + item.title;
          maskListNode.appendChild(button);
        });
        const selected = state.masks[state.selectedMask] || state.masks[Object.keys(state.masks)[0]];
        if (titleInput && selected) { titleInput.value = selected.title || ''; }
        if (pathInput && selected) { pathInput.value = selected.path || ''; }
        historyNode.innerHTML = '';
        const entries = selected && Array.isArray(selected.entries) ? selected.entries.slice().reverse() : [];
        entries.forEach(function (entry) {
          const li = document.createElement('li');
          li.textContent = '[' + entry.time + '] ' + entry.text;
          historyNode.appendChild(li);
        });
        return true;
      }
      function toggleModuleEnabled(moduleKey, explicitState) {
        const key = typeof moduleKey === 'string' ? moduleKey.trim() : '';
        if (!key) {
          return false;
        }
        moduleEnabledState[key] = typeof explicitState === 'boolean' ? explicitState : !moduleEnabledState[key];
        window.localStorage.setItem(MODULE_TOGGLE_STORAGE_KEY, JSON.stringify(moduleEnabledState));
        const toggleNode = moduleToggleNodes.find(function (node) { return node.getAttribute('data-module-toggle') === key; });
        if (toggleNode instanceof HTMLElement) {
          const isEnabled = !!moduleEnabledState[key];
          toggleNode.setAttribute('data-enabled', isEnabled ? 'true' : 'false');
          const labels = {
            'gms-suite': 'Genres-Archiv + Zufall + Liste',
            'debug-dev': 'Debugging & Entwickleroptionen',
            'template-archive': 'Template-Archiv',
            'quick-archive': 'Schnell-Speicher-Archiv'
          };
          toggleNode.textContent = (isEnabled ? 'Aktiv: ' : 'Deaktiviert: ') + (labels[key] || key);
        }
        if (!moduleEnabledState[key] && activeModuleKey === key) {
          executeAction('window-hide');
        }
        return true;
      }
      function initModuleToggleState() {
        let stored = {};
        try {
          stored = JSON.parse(window.localStorage.getItem(MODULE_TOGGLE_STORAGE_KEY) || '{}');
        } catch (error) {
          stored = {};
        }
        ['gms-suite', 'debug-dev', 'template-archive', 'quick-archive'].forEach(function (key) {
          toggleModuleEnabled(key, stored[key] !== false);
        });
      }

      function renderShortcutList(filterValue) {
        if (!shortcutListNode || !shortcutFilterStatusNode) {
          return false;
        }
        const normalized = typeof filterValue === 'string' ? filterValue.trim().toLowerCase() : '';
        const visibleItems = shortcutEntries.filter(function (entry) {
          const rowText = (entry.key + ' ' + entry.title + ' ' + entry.detail).toLowerCase();
          return normalized.length === 0 ? true : rowText.includes(normalized);
        });
        shortcutListNode.innerHTML = '';
        visibleItems.forEach(function (entry) {
          const li = document.createElement('li');
          li.textContent = entry.key + ' ‚Äì ' + entry.title + ': ' + entry.detail;
          shortcutListNode.appendChild(li);
        });
        if (!visibleItems.length) {
          const li = document.createElement('li');
          li.textContent = 'Kein Treffer. N√§chster Schritt: Anderen Suchbegriff testen.';
          shortcutListNode.appendChild(li);
        }
        shortcutFilterStatusNode.textContent = String(visibleItems.length) + ' Eintr√§ge sichtbar.';
        return true;
      }
      function openShortcutOverlay() {
        if (!shortcutOverlay || typeof shortcutOverlay.showModal !== 'function') {
          return setResult('‚ö†Ô∏è Shortcut-√úbersicht nicht verf√ºgbar. Bitte Seite neu laden.');
        }
        renderShortcutList('');
        shortcutOverlay.showModal();
        if (shortcutFilterInput) {
          shortcutFilterInput.value = '';
          shortcutFilterInput.focus();
        }
        return setResult('‚ÑπÔ∏è Shortcut-√úbersicht ge√∂ffnet.');
      }
      function closeShortcutOverlay() {
        if (!shortcutOverlay || !shortcutOverlay.open) {
          return false;
        }
        shortcutOverlay.close();
        return setResult('‚ÑπÔ∏è Shortcut-√úbersicht geschlossen.');
      }
      function applyProjectSwitch() {
        if (!projectSwitchInput || typeof projectSwitchInput.value !== 'string') {
          return setResult('‚ö†Ô∏è Projektwechsel nicht m√∂glich. Bitte Eingabe pr√ºfen.');
        }
        const candidate = projectSwitchInput.value.trim();
        if (!validateProjectPath(candidate)) {
          return setResult('‚ö†Ô∏è Ung√ºltiger Projektpfad. N√§chster Schritt: Absoluten Pfad eingeben und erneut versuchen.');
        }
        persistProjectPath(candidate, 'Steuerleiste');
        if (projectBreadcrumbNode) {
          projectBreadcrumbNode.textContent = 'Projektpfad: ' + candidate;
        }
        return setResult('‚úÖ Projektpfad gewechselt: ' + candidate + '.');
      }
      function normalizeShortcutKey(event) {
        if (!event || typeof event.key !== 'string') {
          return '';
        }
        return event.key.trim().toLowerCase();
      }
      function executeShortcut(event) {
        if (!event) {
          return false;
        }
        if (event.key === 'F1' || event.key === '?') {
          event.preventDefault();
          return openShortcutOverlay();
        }
        if (event.altKey !== true) {
          return false;
        }
        const shortcutMap = {
          s: 'save',
          r: 'retry',
          p: 'repair',
          l: 'log',
          o: 'open-module'
        };
        const shortcutKey = normalizeShortcutKey(event);
        const actionFromShortcut = shortcutMap[shortcutKey];
        if (typeof actionFromShortcut !== 'string') {
          return false;
        }
        event.preventDefault();
        return executeAction(actionFromShortcut);
      }
      if (themeSelector) {
        themeSelector.addEventListener('change', function (event) {
          const value = event.target && typeof event.target.value === 'string' ? event.target.value : '';
          applyTheme(value);
        });
      }
      if (fontScaleSelector) {
        fontScaleSelector.addEventListener('change', function (event) {
          const value = event.target && typeof event.target.value === 'string' ? event.target.value.trim().toLowerCase() : '';
          applyFontScale(value);
        });
      }
      if (backupToggleNode) {
        backupToggleNode.addEventListener('change', function (event) {
          const enabled = Boolean(event.target && event.target.checked);
          if (applyBackupPreference(enabled, 'Bedienfeld')) {
            setResult(enabled ? '‚úÖ Auto-Backup aktiviert.' : '‚ÑπÔ∏è Auto-Backup deaktiviert. Bitte bei √Ñnderungen manuell speichern.');
          }
        });
      }
      if (shortcutFilterInput) {
        shortcutFilterInput.addEventListener('input', function (event) {
          const value = event && event.target && typeof event.target.value === 'string' ? event.target.value : '';
          renderShortcutList(value);
        });
      }
      if (globalSearchInput) {
        globalSearchInput.addEventListener('input', function (event) {
          if (!globalSearchStatusNode) {
            return;
          }
          const value = event && event.target && typeof event.target.value === 'string' ? event.target.value.trim() : '';
          if (!value) {
            globalSearchStatusNode.textContent = 'Suche bereit: Bitte Begriff eingeben.';
            return;
          }
          globalSearchStatusNode.textContent = 'Suche aktiv: "' + value + '". N√§chster Schritt: Passendes Modul √∂ffnen.';
        });
      }
      if (moduleSelector) {
        moduleSelector.addEventListener('change', function (event) {
          const target = event.target;
          const selectedValue = target && typeof target.value === 'string' ? target.value.trim() : '';
          renderModulePreview(selectedValue);
        });
      }
      document.addEventListener('click', function (event) {
        const target = event.target;
        if (!(target instanceof HTMLElement)) {
          return;
        }
        const clickableNode = target.closest('[data-action], [data-module-nav], [data-todo-index], [data-template-index]');
        if (!(clickableNode instanceof HTMLElement)) {
          return;
        }
        const pickedIndex = clickableNode.getAttribute('data-entry-index');
        if (clickableNode.getAttribute('data-action') === 'gms-entry-pick') {
          gmsPlugin.setState((function () {
            const snap = gmsPlugin.getState();
            snap.selectedEntryIndex = Number(pickedIndex);
            return snap;
          })());
        }
        const moduleTarget = clickableNode.getAttribute('data-module-nav');
        if (typeof moduleTarget === 'string' && moduleTarget.length > 0 && moduleSelector) {
          moduleSelector.value = moduleTarget;
          openModule(moduleTarget);
          return;
        }
        if (clickableNode.hasAttribute('data-module-toggle')) {
          const moduleKey = clickableNode.getAttribute('data-module-toggle');
          toggleModuleEnabled(moduleKey || '');
          setResult('‚úÖ Modulstatus ge√§ndert.');
          return;
        }
        if (clickableNode.hasAttribute('data-quick-archive-mask')) {
          const maskKey = clickableNode.getAttribute('data-quick-archive-mask');
          const state = readQuickArchiveState();
          if (maskKey && state.masks[maskKey]) {
            state.selectedMask = maskKey;
            writeQuickArchiveState(state);
            renderQuickArchive();
            setResult('‚úÖ Maske geladen: ' + state.masks[maskKey].title + '.');
          }
          return;
        }
        if (clickableNode.hasAttribute('data-template-index')) {
          const templateIndex = Number(clickableNode.getAttribute('data-template-index'));
          const archive = readTemplateArchiveState();
          if (!Number.isInteger(templateIndex) || templateIndex < 0 || !archive.templates[templateIndex]) {
            setResult('‚ö†Ô∏è Template nicht gefunden. Bitte Liste aktualisieren.');
            return;
          }
          archive.selectedIndex = templateIndex;
          writeTemplateArchiveState(archive);
          const selected = archive.templates[templateIndex];
          const titleNode = document.getElementById('template-title-input');
          const categoryNode = document.getElementById('template-category-input');
          const contentNode = document.getElementById('template-content-input');
          if (titleNode) { titleNode.value = selected.title; }
          if (categoryNode) { categoryNode.value = selected.category; }
          if (contentNode) { contentNode.value = selected.content; }
          renderTemplateArchive();
          appendDebugLog('‚ÑπÔ∏è Template genutzt: ' + selected.title + ' (' + getTimeStamp() + ').');
          if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(selected.content);
            setResult('‚úÖ Template kopiert: ' + selected.title + '.');
          } else {
            setResult('‚ö†Ô∏è Template ausgew√§hlt. Kopieren im Browser nicht erlaubt.');
          }
          return;
        }
        if (clickableNode.hasAttribute('data-todo-index')) {
          window.__todoSelected = Number(clickableNode.getAttribute('data-todo-index'));
          const todoList = document.getElementById('todo-list');
          if (todoList) {
            Array.from(todoList.children).forEach(function (child, idx) {
              child.setAttribute('aria-selected', window.__todoSelected === idx ? 'true' : 'false');
            });
          }
          return;
        }
        const action = clickableNode.getAttribute('data-action');
        if (typeof action !== 'string' || action.length === 0) {
          return;
        }
        if (action === 'project-switch-recent') {
          const selectedPath = clickableNode.getAttribute('data-project-path');
          if (!validateProjectPath(selectedPath)) {
            setResult('‚ö†Ô∏è Letzter Projektpfad ist ung√ºltig. N√§chster Schritt: Manuell im Feld eingeben.');
            renderRecentProjectList();
            return;
          }
          persistProjectPath(selectedPath, 'Zuletzt genutzt');
          setResult('‚úÖ Projektpfad aus ‚ÄûZuletzt genutzt‚Äú aktiviert: ' + selectedPath + '.');
          return;
        }
        executeAction(action);
      });
      document.addEventListener('keydown', function (event) {
        executeShortcut(event);
        keepDialogFocusInside(event);
        if (event.key === 'Enter' && event.target instanceof HTMLElement) {
          if (['gms-genre-input', 'gms-mood-input', 'gms-style-input'].includes(event.target.id)) {
            event.preventDefault();
            executeAction('gms-add');
          }
        }
      });
      window.addEventListener('resize', function () { applyDynamicGridByScreen(); });
      document.addEventListener('change', function (event) {
        const target = event.target;
        if (!(target instanceof HTMLElement)) {
          return;
        }
      });
      document.addEventListener('dragstart', function (event) {
        const target = event.target;
        if (!(target instanceof HTMLElement) || !target.classList.contains('drag-item')) {
          return;
        }
        event.dataTransfer.setData('text/plain', target.getAttribute('data-entry-index') || '-1');
      });
      document.addEventListener('dragover', function (event) {
        const target = event.target;
        if (target instanceof HTMLElement && target.closest('.drag-item')) {
          event.preventDefault();
        }
      });
      document.addEventListener('drop', function (event) {
        const target = event.target;
        if (!(target instanceof HTMLElement)) {
          return;
        }
        const dropItem = target.closest('.drag-item');
        if (!dropItem || !event.dataTransfer) {
          return;
        }
        event.preventDefault();
        const fromIndex = Number(event.dataTransfer.getData('text/plain'));
        const toIndex = Number(dropItem.getAttribute('data-entry-index'));
        const state = gmsPlugin.getState();
        const categoryNode = document.getElementById('gms-category');
        const category = categoryNode ? categoryNode.value : '';
        const profile = state.profiles[state.currentProfile];
        if (!profile || !Array.isArray(profile[category]) || Number.isNaN(fromIndex) || Number.isNaN(toIndex) || fromIndex === toIndex) {
          return;
        }
        const moved = profile[category].splice(fromIndex, 1)[0];
        profile[category].splice(toIndex, 0, moved);
        state.selectedEntryIndex = toIndex;
        gmsPlugin.setState(state);
        setResult('‚úÖ Reihenfolge aktualisiert (Drag&Drop).');
      });
      applyTheme(getThemePreference());
      applyFontScale(readFontScalePreference());
      applyBackupPreference(readBackupPreference(), 'Start');
      if (themeSelector) {
        themeSelector.value = html.getAttribute('data-theme') || 'high-contrast';
      }
      updateProjectStatus(getStoredProjectPath());
      updateFooterContext(getStoredProjectPath());
      if (projectBreadcrumbNode) {
        projectBreadcrumbNode.textContent = 'Projektpfad: ' + getStoredProjectPath();
      }
      if (projectSwitchInput) {
        projectSwitchInput.value = getStoredProjectPath();
      }
      if (projectPathInput) {
        projectPathInput.value = getStoredProjectPath();
      }
      persistProjectPath(getStoredProjectPath(), 'Start');
      renderRecentProjectList();
      const initialProjectPath = getStoredProjectPath();
      if (projectDialog && typeof projectDialog.showModal === 'function' && !validateProjectPath(initialProjectPath)) {
        projectDialog.showModal();
      }
      gmsPlugin.mount();
      setCardState(moduleCardStateNode, 'ready', 'Bereit');
      setCardState(debugCardStateNode, 'ready', 'Bereit');
      setActiveNavigation('dashboard');
      setPluginStatus('dashboard');
      renderModuleSidebarOptions('dashboard', getModuleSourceMeta('dashboard'));
      renderSidebarModuleHints();
      renderTemplateArchive();
      renderQuickArchive();
      initModuleToggleState();
      applyDynamicGridByScreen();
      renderModulePreview('dashboard');
      updateSyncStatus('‚úÖ Alle √Ñnderungen gespeichert (' + getTimeStamp() + ')');
      setCardState(projectCardStateNode, 'ready', 'Bereit');
      setDebugDetails('Startzustand aktiv', 'W√§hlen Sie ein Modul oder √∂ffnen Sie bei Bedarf den Fehlerdialog.');
      appendDebugLog('‚ÑπÔ∏è Startzustand aktiv (' + getTimeStamp() + ').');
    })();
  </script>
</body>
</html>
